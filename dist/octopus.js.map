{"version":3,"sources":["node_modules/browser-pack/_prelude.js","components/namespace.js","components/rpcCommand.js","components/rpcEndpoint.js","components/rpcTransport.js","components/stockTransports.js","node_modules/debug-pest/index.js","octopus.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/RA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"octopus.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","(function () {\n\n\t/* ------\n\t\n\t\tCode below is adapted from the debug library, duly licensed as below.\n\n\t\t(The MIT License)\n\n\t\tCopyright (c) 2014 TJ Holowaychuk <tj@vision-media.ca>\n\n\t\tPermission is hereby granted, free of charge, to any person obtaining a copy of this software\n\t\tand associated documentation files (the 'Software'), to deal in the Software without restriction,\n\t\tincluding without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense,\n\t\tand/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so,\n\t\tsubject to the following conditions:\n\n\t\tThe above copyright notice and this permission notice shall be included in all copies or substantial\n\t\tportions of the Software.\n\n\t\tTHE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT\n\t\tLIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n\t\tIN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n\t\tWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n\t\tSOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n\t------ */\n\n\tvar Namespace = function (namespaces) {\n\n\t\tthis.names = [];\n\t\tthis.skips = [];\n\n\t\tvar i;\n\t\tvar split = (typeof namespaces === 'string' ? namespaces : '').split(/[\\s,]+/);\n\t\tvar len = split.length;\n\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tif (!split[i]) continue; // ignore empty strings\n\t\t\tnamespaces = split[i].replace(/\\*/g, '.*?');\n\t\t\tif (namespaces[0] === '-') {\n\t\t\t\tthis.skips.push(new RegExp('^' + namespaces.substr(1) + '$'));\n\t\t\t} else {\n\t\t\t\tthis.names.push(new RegExp('^' + namespaces + '$'));\n\t\t\t}\n\t\t}\n\n\n\t\treturn this;\n\t};\n\n\n\tNamespace.prototype.test = function (value) {\n\t\tvar i, len;\n\n\t\tfor (i = 0, len = this.skips.length; i < len; i++) {\n\t\t\tif (!this.skips[i].test(value))\n\t\t\t\treturn false;\n\t\t}\n\n\t\tfor (i = 0, len = this.names.length; i < len; i++) {\n\t\t\tif (this.names[i].test(value))\n\t\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t};\n\n\n\n\tmodule.exports = Namespace;\n\n})();\n","(function () {\n\n\tconst Namespace = require('./namespace.js');\n\n\n\n\t/* ----------------------------------------------------------- */\n\n\n\tconst MESSAGETYPES = {\n\t\trequest: 'RQ',\n\t\tresponseAccept: 'RA',\n\t\tresponseFail: 'RF',\n\t\tresponseAcceptError: 'RAE',\n\t\tresponseFailError: 'RFE'\n\t};\n\n\n\tvar rpcCommand = function (name, endpoint, options) {\n\t\toptions = options || {};\n\t\t// console.log('Creating rpc command [%s] for endpoint [%s][%s]',name, endpoint.label, endpoint.dir);\n\t\tthis.name = name;\n\t\tthis.endpoint = endpoint;\n\t\tthis.requestHandlers = [];\n\t\tthis.responseHandlers = {};\n\t\tthis.onProvideFn = null;\n\t\tthis.endpoint.commands[name] = this;\n\n\t\tthis.logger = options.logger.child('CMD:'+this.name);\n\t\tthis.sendLogger = this.logger.child('send');\n\t\tthis.recvLogger = this.logger.child('recv');\n\t\tthis.logger.enabled && this.logger.log('Created new command as ', name);\n\n\t\tthis.MESSAGETYPES = MESSAGETYPES;\n\t\treturn this;\n\t};\n\n\n\trpcCommand.prototype.autoID = function () {\n\t\treturn Math.random().toString().substr(8) + '-' + Date.now();\n\t};\n\n\trpcCommand.prototype.sendToID = function(tid, msg, mode){\n\t\tvar _self = this;\n\t\tvar tName = _self.endpoint.transports[tid].tName;\n\t\tmsg.source = _self.endpoint.label;\n\t\t_self.sendLogger.enabled && _self.sendLogger.log('Sending on transport [%s][%s], mode = %s,  msg =', tid,tName,mode,msg);\n\n\t\tif (!mode || mode != 'respond') {\n\n\t\t\treturn new Promise((res, rej) => {\n\n\t\t\t\tvar sent = false;\n\n\t\t\t\t// handler function\n\t\t\t\tvar handler = function (respData, msgType) {\n\t\t\t\t\t_self.sendLogger.enabled && _self.sendLogger.log('\\n\\nResponse handler called with respData & msgTypes as \\n',respData, msgType);\n\n\t\t\t\t\tdelete _self.responseHandlers[tid][msg.msgID];\n\n\t\t\t\t\tswitch (msgType) {\n\n\t\t\t\t\tcase MESSAGETYPES.responseAccept:\n\t\t\t\t\t\tres({\n\t\t\t\t\t\t\tsent: sent,\n\t\t\t\t\t\t\tstatus: true,\n\t\t\t\t\t\t\ttransport: tName,\n\t\t\t\t\t\t\tcommand: _self.name,\n\t\t\t\t\t\t\tresponse: respData\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase MESSAGETYPES.responseFail:\n\t\t\t\t\t\tres({\n\t\t\t\t\t\t\tsent: sent,\n\t\t\t\t\t\t\tstatus: false,\n\t\t\t\t\t\t\ttransport: tName,\n\t\t\t\t\t\t\tcommand: _self.name,\n\t\t\t\t\t\t\tresponse: respData\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t};\n\n\n\t\t\t\tif (!_self.responseHandlers[tid])\n\t\t\t\t\t_self.responseHandlers[tid] = {};\n\n\t\t\t\t_self.responseHandlers[tid][msg.msgID] = handler;\n\n\n\t\t\t\tvar container = {\n\t\t\t\t\trpc_msg: {},\n\t\t\t\t\trpc_dir: _self.endpoint.dir\n\t\t\t\t};\n\t\t\t\tcontainer.rpc_msg[_self.name] = msg;\n\n\t\t\t\t_self.sendLogger.enabled && _self.sendLogger.log('\\n\\n\\nSending %s to [%s] as \\n',mode =='respond'?'response':'request', tName, container);\n\t\t\t\tPromise.resolve(_self.endpoint.transports[tid].send(container))\n\t\t\t\t\t.then((s) => sent = true)\n\t\t\t\t\t.catch((e) => {\n\t\t\t\t\t\tsent = false;\n\t\t\t\t\t\thandler(e, MESSAGETYPES.responseFail);\n\t\t\t\t\t});\n\n\t\t\t});\n\t\t}\n\t\telse{\n\n\t\t\tvar container = {\n\t\t\t\trpc_msg: {},\n\t\t\t\trpc_dir: _self.endpoint.dir\n\t\t\t};\n\t\t\tcontainer.rpc_msg[_self.name] = msg;\n\n\t\t\t_self.sendLogger.enabled && _self.sendLogger.log('\\n\\n\\nSending %s to [%s] as \\n',mode =='respond'?'response':'request', tName, container);\n\t\t\treturn Promise.resolve(_self.endpoint.transports[tid].send(container));\n\t\t}\n\t};\n\n\trpcCommand.prototype.call = function (namespace, data, mode) {\n\t\tvar _self = this;\n\t\tvar tName;\n\t\tnamespace = new Namespace(namespace);\n\t\tvar tasks = [];\n\n\t\tvar msg = {\n\t\t\tmsgID: _self.autoID(),\n\t\t\tmsgType: MESSAGETYPES.request,\n\t\t\treqData: data,\n\t\t};\n\n\t\tObject.keys(_self.endpoint.transports)\n\t\t\t.forEach(function(tid){\n\t\t\t\t_self.sendLogger.enabled && _self.sendLogger.log('Scanning for namespace on transport [%s] as \\n', tid);\n\n\t\t\t\ttName = _self.endpoint.transports[tid].tName;\n\t\t\t\tif (_self.endpoint.transports[tid].initialised === true && namespace.test(tName)) {\n\t\t\t\t\t_self.sendLogger.enabled && _self.sendLogger.log('Transport [%s] is valid. Attempting to send', tid);\n\t\t\t\t\ttasks.push(_self.sendToID(tid, msg, mode));\n\t\t\t\t}\n\t\t\t});\n\n\t\tif (tasks.length > 0)\n\t\t\treturn Promise.all(tasks);\n\t\telse\n\t\t\treturn Promise.resolve([{\n\t\t\t\tsent: false,\n\t\t\t\tstatus: false,\n\t\t\t\ttransport: '',\n\t\t\t\tcommand: _self.name,\n\t\t\t\tresponse: 'no transports added'\n\t\t\t}]);\n\t};\n\n\t// rpcCommand.prototype.call = function (namespaceString, data) {\n\t// \tvar _self = this;\n\t//\n\t// \tvar msg = {\n\t// \t\tmsgID: _self.autoID(),\n\t// \t\tmsgType: MESSAGETYPES.request,\n\t// \t\treqData: data,\n\t// \t};\n\t//\n\t//\n\t// \t_self.sendLogger.enabled && _self.sendLogger.log('Requesting RPC with msg = ', msg);\n\t// \treturn _self.send(namespaceString, msg);\n\t//\n\t// };\n\n\n\trpcCommand.prototype.recieve = function (msg, transport) {\n\t\tvar _self = this;\n\t\tvar tName = transport.tName, tid = transport.id;\n\n\t\t_self.recvLogger.enabled && _self.recvLogger.log('\\n\\n\\nCommand [%s] Data recvd on [%s][%s] as \\n',_self.name, _self.endpoint.label,_self.endpoint.dir,tName, msg);\n\n\t\tswitch (msg.msgType) {\n\t\tcase MESSAGETYPES.responseAccept:\n\t\tcase MESSAGETYPES.responseFail:\n\t\t\t// console.log('\\n\\n\\nResponse recvd on [%s] from [%s] as\\n ',tName, msg.rtName, msg);\n\t\t\tif (_self.responseHandlers[tid] && _self.responseHandlers[tid][msg.respID]) {\n\t\t\t\t// console.log('handler found. Responding !');\n\t\t\t\t_self.responseHandlers[tid][msg.respID](msg.respData, msg.msgType);\n\t\t\t} else {\n\t\t\t\t// console.log('handler not found');\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase MESSAGETYPES.request:\n\t\t\t// console .log('\\n\\nCommand[%s] Request recvd on [%s] as\\n ',_self.name, tName,msg);\n\n\t\t\tif (_self.requestHandlers.length > 0) {\n\t\t\t\t// console.log('\\n[%s]Request handlers found\\n ',_self.requestHandlers.length);\n\n\t\t\t\tvar chain = Promise.resolve();\n\t\t\t\tvar reqData = msg.reqData;\n\n\t\t\t\t_self.requestHandlers.forEach((h) => {\n\t\t\t\t\t/* Each handler is called with (v,p,l,s) as follows\n\t\t\t\t\t\tv\t= reqData \t- data sent by caller,\n\t\t\t\t\t\tp\t= prev\t\t- response got from the prevhandler's execution for this call,\n\t\t\t\t\t\tl\t= tName \t\t- name of current transport (TODO - buggy, points to local transport name)\n\t\t\t\t\t\ts \t= msg.tName \t- name of the calling transport (this was the actual usecase for tName ?)\n\t\t\t\t\t*/\n\t\t\t\t\tchain = chain.then((prev) => h(msg.reqData, prev, tName, msg.tName));\n\t\t\t\t});\n\t\t\t\treturn chain\n\t\t\t\t\t.then((respData) => {\n\t\t\t\t\t\t// console.log('\\nRequest handlers SUCCESS\\n Results are',respData);\n\n\t\t\t\t\t\tmsg.respID = msg.msgID;\n\t\t\t\t\t\tmsg.rtName = tName;\n\t\t\t\t\t\tmsg.msgID = _self.autoID();\n\t\t\t\t\t\tmsg.msgType = MESSAGETYPES.responseAccept;\n\t\t\t\t\t\tmsg.respData = respData;\n\t\t\t\t\t\tdelete msg.reqData;\n\t\t\t\t\t\treturn _self.sendToID(tid, msg, 'respond');\n\t\t\t\t\t})\n\t\t\t\t\t.catch((e) => {\n\t\t\t\t\t\t// console.log('\\nRequest handlers FAILED\\n Results are',e);\n\n\t\t\t\t\t\tmsg.respID = msg.msgID;\n\t\t\t\t\t\tmsg.rtName = tName;\n\t\t\t\t\t\tmsg.msgID = _self.autoID();\n\t\t\t\t\t\tmsg.msgType = MESSAGETYPES.responseFail;\n\t\t\t\t\t\tmsg.respData = e;\n\t\t\t\t\t\tdelete msg.reqData;\n\t\t\t\t\t\treturn _self.sendToID(tid, msg, 'respond');\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => _self.onProvideFn ? _self.onProvideFn(reqData, msg.respData, tName, msg) : null)\n\t\t\t\t\t.catch((e) => {\n\t\t\t\t\t\tconsole.error('Unexpected Error while executing onProvide function - ', e);\n\t\t\t\t\t});\n\n\t\t\t} else {\n\t\t\t\t// _self.recvLogger.enabled && _self.recvLogger.error('ERROR - No requestHandlers for command[%s] on [%s][%s] -  tName, msg - ', _self.name, _self.endpoint.label, _self.endpoint.dir, tName, msg);\n\t\t\t\tmsg.respID = msg.msgID;\n\t\t\t\tmsg.rtName = tName;\n\t\t\t\tmsg.msgID = _self.autoID();\n\t\t\t\tmsg.msgType = MESSAGETYPES.responseFail;\n\t\t\t\tmsg.respData = 'no providers';\n\t\t\t\tdelete msg.reqData;\n\t\t\t\treturn _self.sendToID(tid, msg, 'respond');\n\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t};\n\n\trpcCommand.prototype.provide = function (fn) {\n\t\tif (typeof fn == \"function\")\n\t\t\tthis.requestHandlers.push(fn);\n\t\telse {\n\t\t\tthrow new Error('Param passed to \"provide\" is not a function');\n\t\t}\n\t};\n\n\trpcCommand.prototype.unProvide = function (fn) {\n\t\tvar index = this.requestHandlers.findIndex((x) => x === fn);\n\t\tif (index > -1)\n\t\t\tthis.requestHandlers.splice(handlerIndex, 1);\n\t\treturn this;\n\t};\n\n\t/*\n\t\tExecutes passed fn when provide response is successfully recieved by remote.\n\t\t\tAssuming transport send() function returns a promise on successfull\n\t\t\ttransfer of response message\n\t*/\n\trpcCommand.prototype.onProvide = function (fn) {\n\t\tif (typeof fn == \"function\")\n\t\t\tthis.onProvideFn = fn;\n\t\telse {\n\t\t\tthrow new Error('Param passed to \"onProvideFn\" is not a function');\n\t\t}\n\t};\n\n\n\n\t/* ----------------------------------------------------------- */\n\n\n\tmodule.exports = rpcCommand;\n\n})();\n","(function () {\n\n\tconst Namespace = require('./namespace.js');\n\tconst rpcStockTransports = require('./stockTransports.js');\n\tconst rpcTransport = require('./rpcTransport.js');\n\tconst rpcCommand = require('./rpcCommand.js');\n\t/* ----------------------------------------------------------- */\n\n\n\tvar rpcEndpoint = function (l, dir, options) {\n\t\toptions = options || {};\n\t\tthis.logger = options.logger.child(dir == 'i'?'EP:in':'EP:out');\n\n\n\t\tthis.transports = {};\n\t\tthis.label = l;\n\t\tthis.dir = dir;\n\t\tthis.commands = {};\n\t\tthis.transportTypes = rpcStockTransports;\n\n\t\tthis.logger.enabled && this.logger.log('Created new endpoint as [%s][%s]', l,dir);\n\n\t\treturn this;\n\t};\n\n\trpcEndpoint.prototype.pluginTransports = function (tColl) {\n\t\tthis.transportTypes = Object.assign(this.transportTypes, tColl);\n\t};\n\n\trpcEndpoint.prototype.over = function (socket, type) {\n\t\treturn new rpcTransport(type, socket, this, {logger:this.logger});\n\t};\n\trpcEndpoint.prototype.remove = function (socket) {\n\t\tvar _self = this;\n\t\tObject.keys(_self.transports).forEach((tid)=>{\n\t\t\tif(_self.transports[tid].socket === socket)\n\t\t\t\tdelete _self.transports[tid];\n\t\t});\n\t};\n\n\trpcEndpoint.prototype.rename = function (namespace) {\n\t\tvar _self = this;\n\t\tnamespace = new Namespace(namespace);\n\t\treturn {\n\t\t\tas: (newName) => {\n\t\t\t\t_self.label = newName;\n\t\t\t\tObject.keys(_self.transports).forEach((tName) => {\n\t\t\t\t\tif (namespace.test(tName)) {\n\t\t\t\t\t\t_self.transports[tName].as(newName);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn this;\n\t\t\t}\n\t\t}\n\t};\n\n\trpcEndpoint.prototype.displayString = function () {\n\t\tvar _self = this;\n\t\tvar logString = 'key\\t\\t\\tname\\t\\t\\ttype:id\\t\\t\\tinitalised\\n';\n\t\tObject.keys(_self.transports).forEach((tKey) => {\n\t\t\tlogString+=`${tKey}\\t\\t${_self.transports[tKey].tName}\\t\\t${_self.transports[tKey].type +':'+_self.transports[tKey].id}\\t\\t${_self.transports[tKey].initialised}\\n`;\n\t\t});\n\t\treturn logString;\n\t};\n\n\trpcEndpoint.prototype.command = function (name) {\n\t\treturn new rpcCommand(name, this, {logger:this.logger});\n\t};\n\n\n\t/* ----------------------------------------------------------- */\n\n\n\tmodule.exports = rpcEndpoint;\n\n})();\n","(function () {\n\tvar idCount = 0;\n\tvar autoID = function(){\n\t\treturn 'T'+ (++idCount);\n\t};\n\n\tvar rpcTransport = function (type, socket, endpoint, options) {\n\t\t// console.log('Creating rpc transport [%s] for endpoint [%s][%s]',type, endpoint.label, endpoint.dir);\n\t\toptions = options || {};\n\t\tvar _self = this;\n\n\t\t_self.id = autoID();\n\t\t_self.logger = options.logger.child('T:'+type+':'+_self.id);\n\n\t\t_self.endpoint = endpoint;\n\t\t_self.type = type;\n\t\t_self.socket = socket;\t// Also used for matching & removal, besides internal socket access.\n\t\t_self.tName = 'nonname';\n\t\t_self.initialised = false;\n\t\t_self.nameClock = 0;\n\t\t_self.dirFlip = {\n\t\t\ti: 'o',\n\t\t\to: 'i'\n\t\t};\n\n\t\t// Add trasport type specific methods to self\n\t\tObject.assign(_self, _self.endpoint.transportTypes[type](type, socket));\n\n\t\t_self.initPromise = new Promise((res,rej)=>{\n\t\t\t_self.onRecv((data) => {\n\t\t\t\t// console.log('[onRecv] Data recvd on [%s][%s]',_self.tName,_self.endpoint.dir, data);\n\t\t\t\tif (data.rpc_dir == _self.dirFlip[_self.endpoint.dir]) {\n\t\t\t\t\t// console.log('[onRecv] Data accepted on [%s][%s]',_self.tName,_self.endpoint.dir, data);\n\n\t\t\t\t\tif (data.rpc_tName_change) {\n\t\t\t\t\t\t/*\n\t\t\t\t\t\t\tNOTE - Implementing \"Latest & last write wins\" consensus policy :\n\t\t\t\t\t\t\t\tWHY ? - Required to solve disputes when both(or more) endpoints request a name change at the same time.\n\t\t\t\t\t\t\t\tWithout this, a simultaneous request causes each one to sends his name change over while implementing the other's name change request.\n\t\t\t\t\t\t\t\t \tconsequence - a name swap, instead of consensus on a single name value.\n\t\t\t\t\t\t*/\n\t\t\t\t\t\tif (data.rpc_tName_change.force || data.rpc_tName_change.clock >= _self.nameClock) {\n\t\t\t\t\t\t\t_self.logger.enabled && _self.logger.log('[%s, clock %s] [%s] Changing name of transport [%s][%s] to [%s] at clock =', _self.endpoint.label, _self.nameClock, data.rpc_tName_change.force ? 'forced' : '', _self.tName,_self.id, data.rpc_tName_change.tName, data.rpc_tName_change.clock);\n\t\t\t\t\t\t\t// delete _self.endpoint.transports[_self.tName];\n\t\t\t\t\t\t\t_self.tName = data.rpc_tName_change.tName;\n\t\t\t\t\t\t\t_self.nameClock = data.rpc_tName_change.clock;\n\t\t\t\t\t\t\t// _self.endpoint.transports[_self.tName] = _self;\n\t\t\t\t\t\t\tif(!_self.initialised) {\n\t\t\t\t\t\t\t\t_self.initialised = true;\n\t\t\t\t\t\t\t\tres();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t_self.logger.enabled && _self.logger.log('[%s, clock %s] [%s] Rejecting name change of transport [%s][%s] as [%s] at clock =',_self.endpoint.label,_self.nameClock,data.rpc_tName_change.force?'forced':'', _self.tName,_self.id, data.rpc_tName_change.tName,data.rpc_tName_change.clock);\n\t\t\t\t\t\t\t_self.send({\n\t\t\t\t\t\t\t\trpc_tName_change: {\n\t\t\t\t\t\t\t\t\ttName: _self.tName,\n\t\t\t\t\t\t\t\t\tclock: _self.nameClock,\n\t\t\t\t\t\t\t\t\tforce: true\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\trpc_dir: _self.endpoint.dir\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data.rpc_msg) {\n\t\t\t\t\t\tObject.keys(data.rpc_msg).forEach((cKey) => {\n\t\t\t\t\t\t\tif (_self.endpoint.commands[cKey])\n\t\t\t\t\t\t\t\t_self.endpoint.commands[cKey].recieve(data.rpc_msg[cKey], _self);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t_self.as = function (tName) {\n\t\t\t\t// delete _self.endpoint.transports[_self.tName];\n\t\t\t\tvar prevName = _self.tName;\n\t\t\t\t_self.tName = tName;\n\t\t\t\t_self.nameClock++;\n\t\t\t\t_self.logger.enabled && _self.logger.log('[%s] Sending namechange of transport [%s][%s] to [%s] at clock =',_self.endpoint.label, prevName,tName,_self.id, _self.nameClock);\n\t\t\t\t_self.send({\n\t\t\t\t\trpc_tName_change: {\n\t\t\t\t\t\ttName: _self.tName,\n\t\t\t\t\t\tclock: _self.nameClock\n\t\t\t\t\t},\n\t\t\t\t\trpc_dir: _self.endpoint.dir\n\t\t\t\t});\n\t\t\t\t// _self.endpoint.transports[tName] = _self;\n\t\t\t\tif(!_self.initialised) {\n\t\t\t\t\t_self.initialised = true;\n\t\t\t\t\tres();\n\t\t\t\t}\n\t\t\t\treturn _self;\n\t\t\t};\n\t\t});\n\n\t\t_self.endpoint.transports[_self.id] = _self;\n\t\t_self.logger.enabled && _self.logger.log('Added transport [%s][%s] for endpoint [%s][%s]',type,_self.id, endpoint.label, endpoint.dir);\n\t\treturn _self;\n\t};\n\n\t/* ----------------------------------------------------------- */\n\n\n\tmodule.exports = rpcTransport;\n\n})();\n","(function () {\n\n\tvar transportTypes = {};\n\n\ttransportTypes['socketio'] = function (type, socket) {\n\t\treturn {\n\t\t\tsend: (data) => socket.send(JSON.stringify(data)),\n\t\t\tonRecv: (fn) => socket.on('message', (data) => fn(JSON.parse(data)))\n\t\t}\n\t};\n\ttransportTypes['websocket'] = function (type, socket) {\n\t\treturn {\n\t\t\tsend: (data) => {\n\t\t\t\treturn new Promise((res, rej) => {\n\t\t\t\t\tsocket.send(\n\t\t\t\t\t\tJSON.stringify(data),\n\t\t\t\t\t\t(e) => e ? rej(e) : res()\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t},\n\t\t\tonRecv: (fn) => socket.on('message', (data) => fn(JSON.parse(data)))\n\t\t}\n\t};\n\ttransportTypes['processLocal'] = function (type, socket) {\n\t\treturn {\n\t\t\tsend: (data) => socket.emit('message', JSON.stringify(data)),\n\t\t\tonRecv: (fn) => socket.on('message', (data) => fn(JSON.parse(data)))\n\t\t}\n\t};\n\ttransportTypes['nodeEELocal'] = function (type, socket) {\n\t\treturn {\n\t\t\tsend: (data) => socket.emit('message', JSON.stringify(data)),\n\t\t\tonRecv: (fn) => socket.on('message', (data) => fn(JSON.parse(data)))\n\t\t}\n\t};\n\ttransportTypes['processRemote'] = function (type, socket) {\n\t\treturn {\n\t\t\tsend: (data) => socket.send(JSON.stringify(data)),\n\t\t\tsend: (data) => {\n\t\t\t\treturn new Promise((res, rej) => {\n\t\t\t\t\tvar s = socket.send(\n\t\t\t\t\t\tJSON.stringify(data),\n\t\t\t\t\t\t(e) => e instanceof Error ? rej(e) : (s === true? res(s):rej(s))\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t},\n\t\t\tonRecv: (fn) => socket.on('message', (data) => fn(JSON.parse(data)))\n\t\t}\n\t};\n\ttransportTypes['nodeEERemote'] = function (type, socket) {\n\t\treturn {\n\t\t\tsend: (data) => socket.send('message', JSON.stringify(data)),\n\t\t\tonRecv: (fn) => socket.on('message', (data) => fn(JSON.parse(data)))\n\t\t}\n\t};\n\n\tmodule.exports = transportTypes;\n\n})();\n","module.exports = function(debug){\n\n\tvar logger = function (suffix) {\n\t\tthis.enabled = false;\n\t\tthis.prefix = suffix || '';\n\n\t\tif(typeof debug == 'function'){\n\t\t\tthis.log = debug(`logs:` + this.prefix);\n\t\t\tthis.warn = debug(`warnings:` + this.prefix);\n\t\t\tthis.error = debug(`errors:` + this.prefix);\n\t\t\tthis.enabled = true;\n\t\t}\n\t\telse{\n\t\t\tthis.log = ()=>{};\n\t\t\tthis.warn = ()=>{};\n\t\t\tthis.error = ()=>{};\n\t\t\tthis.enabled = false;\n\t\t}\n\t};\n\n\tlogger.prototype.child = function (suffix) {\n\t\treturn new logger(this.prefix + ':' + suffix);\n\t};\n\n\treturn logger;\n};\n","module.exports = function (debug) {\n\n\tconst Namespace = require('./components/namespace.js');\n\tconst rpcEndpoint = require('./components/rpcEndpoint.js');\n\tconst debugr = require('debug-pest')(debug);\n\tvar appLogger = new debugr('octopus');\n\n\t/* ----------------------------------------------------------- */\n\n\tvar rpcs = {};\n\n\tvar rpc = function (name, options) {\n\t\toptions = options || {};\n\n\n\t\tif (options.create === true) {\n\t\t\tthis.name = name;\n\t\t\tthis.commands = {};\n\t\t\tthis.logger = appLogger.child(this.name);\n\n\t\t\tthis.incoming = new rpcEndpoint(name, 'i', { logger: this.logger});\n\t\t\tthis.outgoing = new rpcEndpoint(name, 'o', { logger: this.logger});\n\n\t\t\tthis.logger.enabled && this.logger.log('Created new Octopus RPC as ', this.name);\n\t\t\treturn this;\n\t\t}\n\n\t\tif (!rpcs[name]) {\n\t\t\toptions.create = true;\n\t\t\trpcs[name] = new rpc(name, options);\n\t\t}\n\n\n\t\treturn rpcs[name];\n\n\t};\n\trpc.prototype.displayTransports = function () {\n\t\t// console.log('\\n\\n\\n------ Transports for [%s] are:\\n', this.name);\n\t\t// console.log('incoming:\\n');\n\t\t// this.incoming.displayTransports();\n\t\t// console.log('\\n\\noutgoing:\\n');\n\t\t// this.outgoing.displayTransports();\n\t\t// console.log('\\n--------------------------\\n\\n');\n\n\t\tvar logString = `\n\n-------------------- TRANSPORTS for [${this.name}] are : ---------------------------\n\nIncoming (provides):\n\n`;\n\n\t\tlogString += this.incoming.displayString();\n\t\tlogString +=`\\n\\n-------------\\nOutgoing (calls):\\n\\n`;\n\t\tlogString += this.outgoing.displayString();\n\t\tlogString +='\\n\\n------------------------------------------------------------------------------------\\n\\n';\n\n\t\tconsole.log(logString);\n\t};\n\n\trpc.prototype.over = function (socket, type) {\n\t\tvar tasks = [];\n\t\ttasks.push(this.incoming.over(socket, type)\n\t\t\t.as(this.name)\n\t\t\t.initPromise);\n\t\ttasks.push(this.outgoing.over(socket, type)\n\t\t\t.initPromise);\n\t\treturn Promise.all(tasks);\n\t};\n\trpc.prototype.remove = function (socket) {\n\t\tthis.incoming.remove(socket);\n\t\tthis.outgoing.remove(socket);\n\t};\n\n\trpc.prototype.pluginTransports = function (tObj) {\n\t\tthis.incoming.pluginTransports(tObj);\n\t\tthis.outgoing.pluginTransports(tObj);\n\t};\n\trpc.prototype.command = function (name) {\n\t\tvar _self = this;\n\t\tif (!_self.commands[name]) {\n\t\t\tvar iC = _self.incoming.command(name);\n\t\t\tvar oC = _self.outgoing.command(name);\n\t\t\t_self.MESSAGETYPES = iC.MESSAGETYPES || oC.MESSAGETYPES;\n\n\t\t\t_self.commands[name] = {\n\t\t\t\tprovide: function (fn) {\n\t\t\t\t\tiC.provide(fn);\n\t\t\t\t\treturn _self.commands[name];\n\t\t\t\t},\n\t\t\t\tunProvide: function (fn) {\n\t\t\t\t\tiC.unProvide(fn);\n\t\t\t\t\treturn _self.commands[name];\n\t\t\t\t},\n\t\t\t\tonProvide: function (fn) {\n\t\t\t\t\tiC.onProvide(fn);\n\t\t\t\t\treturn _self.commands[name];\n\t\t\t\t},\n\t\t\t\tcall: function (filter, data) {\n\t\t\t\t\t// _self.displayTransports();\n\t\t\t\t\treturn oC.call(filter, data);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t\treturn this.commands[name];\n\t};\n\trpc.prototype.renameTo = function (newName) {\n\t\tthis.incoming.rename(this.name)\n\t\t\t.as(newName);\n\t\tthis.name = newName;\n\t\t// this.outgoing.label = newName;\n\t\treturn this;\n\t};\n\n\n\t/* ----------------  Result parsing & Resolving to Promise resolve/reject -----------*/\n\n\trpc.prototype.parseByStatus = function (res) {\n\t\tvar valids = [],\n\t\t\tinvalids = [],\n\t\t\tcheck;\n\t\tfor (var i = 0; i < res.length; i++) {\n\t\t\tcheck = res[i];\n\t\t\tif (check.sent === true && check.status === true)\n\t\t\t\tvalids.push(check);\n\t\t\telse\n\t\t\t\tinvalids.push(check);\n\t\t}\n\t\treturn {\n\t\t\tvalids: valids,\n\t\t\tinvalids: invalids\n\t\t};\n\t};\n\n\trpc.prototype.resolve = function (p) {\n\t\tif (p.sent === true && p.status === true)\n\t\t\treturn Promise.resolve(p.response);\n\t\telse\n\t\t\treturn Promise.reject(p.response);\n\t};\n\trpc.prototype.resolveAll = function (p) {\n\n\t\tfor (var i = 0; i < p.length; i++) {\n\t\t\tif (p[i].sent === false || p[i].status === false)\n\t\t\t\treturn Promise.reject(p);\n\t\t}\n\n\t\treturn Promise.resolve(p);\n\t};\n\trpc.prototype.resolveAtLeastOne = function (p) {\n\n\t\tfor (var i = 0; i < p.length; i++) {\n\t\t\tif (p[i].sent === true && p[i].status === true)\n\t\t\t\treturn Promise.resolve(p);\n\t\t}\n\n\t\treturn Promise.reject(p);\n\t};\n\n\n\n\n\treturn rpc;\n\n};\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJjb21wb25lbnRzL25hbWVzcGFjZS5qcyIsImNvbXBvbmVudHMvcnBjQ29tbWFuZC5qcyIsImNvbXBvbmVudHMvcnBjRW5kcG9pbnQuanMiLCJjb21wb25lbnRzL3JwY1RyYW5zcG9ydC5qcyIsImNvbXBvbmVudHMvc3RvY2tUcmFuc3BvcnRzLmpzIiwibm9kZV9tb2R1bGVzL2RlYnVnLXBlc3QvaW5kZXguanMiLCJvY3RvcHVzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiKGZ1bmN0aW9uICgpIHtcblxuXHQvKiAtLS0tLS1cblx0XG5cdFx0Q29kZSBiZWxvdyBpcyBhZGFwdGVkIGZyb20gdGhlIGRlYnVnIGxpYnJhcnksIGR1bHkgbGljZW5zZWQgYXMgYmVsb3cuXG5cblx0XHQoVGhlIE1JVCBMaWNlbnNlKVxuXG5cdFx0Q29weXJpZ2h0IChjKSAyMDE0IFRKIEhvbG93YXljaHVrIDx0akB2aXNpb24tbWVkaWEuY2E+XG5cblx0XHRQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5IG9mIHRoaXMgc29mdHdhcmVcblx0XHRhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgJ1NvZnR3YXJlJyksIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sXG5cdFx0aW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSxcblx0XHRhbmQvb3Igc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLFxuXHRcdHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuXG5cdFx0VGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbFxuXHRcdHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cblxuXHRcdFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAnQVMgSVMnLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UXG5cdFx0TElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuXG5cdFx0SU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIgTElBQklMSVRZLFxuXHRcdFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRVxuXHRcdFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLlxuXG5cdC0tLS0tLSAqL1xuXG5cdHZhciBOYW1lc3BhY2UgPSBmdW5jdGlvbiAobmFtZXNwYWNlcykge1xuXG5cdFx0dGhpcy5uYW1lcyA9IFtdO1xuXHRcdHRoaXMuc2tpcHMgPSBbXTtcblxuXHRcdHZhciBpO1xuXHRcdHZhciBzcGxpdCA9ICh0eXBlb2YgbmFtZXNwYWNlcyA9PT0gJ3N0cmluZycgPyBuYW1lc3BhY2VzIDogJycpLnNwbGl0KC9bXFxzLF0rLyk7XG5cdFx0dmFyIGxlbiA9IHNwbGl0Lmxlbmd0aDtcblxuXHRcdGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykge1xuXHRcdFx0aWYgKCFzcGxpdFtpXSkgY29udGludWU7IC8vIGlnbm9yZSBlbXB0eSBzdHJpbmdzXG5cdFx0XHRuYW1lc3BhY2VzID0gc3BsaXRbaV0ucmVwbGFjZSgvXFwqL2csICcuKj8nKTtcblx0XHRcdGlmIChuYW1lc3BhY2VzWzBdID09PSAnLScpIHtcblx0XHRcdFx0dGhpcy5za2lwcy5wdXNoKG5ldyBSZWdFeHAoJ14nICsgbmFtZXNwYWNlcy5zdWJzdHIoMSkgKyAnJCcpKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMubmFtZXMucHVzaChuZXcgUmVnRXhwKCdeJyArIG5hbWVzcGFjZXMgKyAnJCcpKTtcblx0XHRcdH1cblx0XHR9XG5cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9O1xuXG5cblx0TmFtZXNwYWNlLnByb3RvdHlwZS50ZXN0ID0gZnVuY3Rpb24gKHZhbHVlKSB7XG5cdFx0dmFyIGksIGxlbjtcblxuXHRcdGZvciAoaSA9IDAsIGxlbiA9IHRoaXMuc2tpcHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcblx0XHRcdGlmICghdGhpcy5za2lwc1tpXS50ZXN0KHZhbHVlKSlcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdGZvciAoaSA9IDAsIGxlbiA9IHRoaXMubmFtZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcblx0XHRcdGlmICh0aGlzLm5hbWVzW2ldLnRlc3QodmFsdWUpKVxuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH07XG5cblxuXG5cdG1vZHVsZS5leHBvcnRzID0gTmFtZXNwYWNlO1xuXG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcblxuXHRjb25zdCBOYW1lc3BhY2UgPSByZXF1aXJlKCcuL25hbWVzcGFjZS5qcycpO1xuXG5cblxuXHQvKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5cblx0Y29uc3QgTUVTU0FHRVRZUEVTID0ge1xuXHRcdHJlcXVlc3Q6ICdSUScsXG5cdFx0cmVzcG9uc2VBY2NlcHQ6ICdSQScsXG5cdFx0cmVzcG9uc2VGYWlsOiAnUkYnLFxuXHRcdHJlc3BvbnNlQWNjZXB0RXJyb3I6ICdSQUUnLFxuXHRcdHJlc3BvbnNlRmFpbEVycm9yOiAnUkZFJ1xuXHR9O1xuXG5cblx0dmFyIHJwY0NvbW1hbmQgPSBmdW5jdGlvbiAobmFtZSwgZW5kcG9pbnQsIG9wdGlvbnMpIHtcblx0XHRvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblx0XHQvLyBjb25zb2xlLmxvZygnQ3JlYXRpbmcgcnBjIGNvbW1hbmQgWyVzXSBmb3IgZW5kcG9pbnQgWyVzXVslc10nLG5hbWUsIGVuZHBvaW50LmxhYmVsLCBlbmRwb2ludC5kaXIpO1xuXHRcdHRoaXMubmFtZSA9IG5hbWU7XG5cdFx0dGhpcy5lbmRwb2ludCA9IGVuZHBvaW50O1xuXHRcdHRoaXMucmVxdWVzdEhhbmRsZXJzID0gW107XG5cdFx0dGhpcy5yZXNwb25zZUhhbmRsZXJzID0ge307XG5cdFx0dGhpcy5vblByb3ZpZGVGbiA9IG51bGw7XG5cdFx0dGhpcy5lbmRwb2ludC5jb21tYW5kc1tuYW1lXSA9IHRoaXM7XG5cblx0XHR0aGlzLmxvZ2dlciA9IG9wdGlvbnMubG9nZ2VyLmNoaWxkKCdDTUQ6Jyt0aGlzLm5hbWUpO1xuXHRcdHRoaXMuc2VuZExvZ2dlciA9IHRoaXMubG9nZ2VyLmNoaWxkKCdzZW5kJyk7XG5cdFx0dGhpcy5yZWN2TG9nZ2VyID0gdGhpcy5sb2dnZXIuY2hpbGQoJ3JlY3YnKTtcblx0XHR0aGlzLmxvZ2dlci5lbmFibGVkICYmIHRoaXMubG9nZ2VyLmxvZygnQ3JlYXRlZCBuZXcgY29tbWFuZCBhcyAnLCBuYW1lKTtcblxuXHRcdHRoaXMuTUVTU0FHRVRZUEVTID0gTUVTU0FHRVRZUEVTO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9O1xuXG5cblx0cnBjQ29tbWFuZC5wcm90b3R5cGUuYXV0b0lEID0gZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKCkuc3Vic3RyKDgpICsgJy0nICsgRGF0ZS5ub3coKTtcblx0fTtcblxuXHRycGNDb21tYW5kLnByb3RvdHlwZS5zZW5kVG9JRCA9IGZ1bmN0aW9uKHRpZCwgbXNnLCBtb2RlKXtcblx0XHR2YXIgX3NlbGYgPSB0aGlzO1xuXHRcdHZhciB0TmFtZSA9IF9zZWxmLmVuZHBvaW50LnRyYW5zcG9ydHNbdGlkXS50TmFtZTtcblx0XHRtc2cuc291cmNlID0gX3NlbGYuZW5kcG9pbnQubGFiZWw7XG5cdFx0X3NlbGYuc2VuZExvZ2dlci5lbmFibGVkICYmIF9zZWxmLnNlbmRMb2dnZXIubG9nKCdTZW5kaW5nIG9uIHRyYW5zcG9ydCBbJXNdWyVzXSwgbW9kZSA9ICVzLCAgbXNnID0nLCB0aWQsdE5hbWUsbW9kZSxtc2cpO1xuXG5cdFx0aWYgKCFtb2RlIHx8IG1vZGUgIT0gJ3Jlc3BvbmQnKSB7XG5cblx0XHRcdHJldHVybiBuZXcgUHJvbWlzZSgocmVzLCByZWopID0+IHtcblxuXHRcdFx0XHR2YXIgc2VudCA9IGZhbHNlO1xuXG5cdFx0XHRcdC8vIGhhbmRsZXIgZnVuY3Rpb25cblx0XHRcdFx0dmFyIGhhbmRsZXIgPSBmdW5jdGlvbiAocmVzcERhdGEsIG1zZ1R5cGUpIHtcblx0XHRcdFx0XHRfc2VsZi5zZW5kTG9nZ2VyLmVuYWJsZWQgJiYgX3NlbGYuc2VuZExvZ2dlci5sb2coJ1xcblxcblJlc3BvbnNlIGhhbmRsZXIgY2FsbGVkIHdpdGggcmVzcERhdGEgJiBtc2dUeXBlcyBhcyBcXG4nLHJlc3BEYXRhLCBtc2dUeXBlKTtcblxuXHRcdFx0XHRcdGRlbGV0ZSBfc2VsZi5yZXNwb25zZUhhbmRsZXJzW3RpZF1bbXNnLm1zZ0lEXTtcblxuXHRcdFx0XHRcdHN3aXRjaCAobXNnVHlwZSkge1xuXG5cdFx0XHRcdFx0Y2FzZSBNRVNTQUdFVFlQRVMucmVzcG9uc2VBY2NlcHQ6XG5cdFx0XHRcdFx0XHRyZXMoe1xuXHRcdFx0XHRcdFx0XHRzZW50OiBzZW50LFxuXHRcdFx0XHRcdFx0XHRzdGF0dXM6IHRydWUsXG5cdFx0XHRcdFx0XHRcdHRyYW5zcG9ydDogdE5hbWUsXG5cdFx0XHRcdFx0XHRcdGNvbW1hbmQ6IF9zZWxmLm5hbWUsXG5cdFx0XHRcdFx0XHRcdHJlc3BvbnNlOiByZXNwRGF0YVxuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGNhc2UgTUVTU0FHRVRZUEVTLnJlc3BvbnNlRmFpbDpcblx0XHRcdFx0XHRcdHJlcyh7XG5cdFx0XHRcdFx0XHRcdHNlbnQ6IHNlbnQsXG5cdFx0XHRcdFx0XHRcdHN0YXR1czogZmFsc2UsXG5cdFx0XHRcdFx0XHRcdHRyYW5zcG9ydDogdE5hbWUsXG5cdFx0XHRcdFx0XHRcdGNvbW1hbmQ6IF9zZWxmLm5hbWUsXG5cdFx0XHRcdFx0XHRcdHJlc3BvbnNlOiByZXNwRGF0YVxuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fTtcblxuXG5cdFx0XHRcdGlmICghX3NlbGYucmVzcG9uc2VIYW5kbGVyc1t0aWRdKVxuXHRcdFx0XHRcdF9zZWxmLnJlc3BvbnNlSGFuZGxlcnNbdGlkXSA9IHt9O1xuXG5cdFx0XHRcdF9zZWxmLnJlc3BvbnNlSGFuZGxlcnNbdGlkXVttc2cubXNnSURdID0gaGFuZGxlcjtcblxuXG5cdFx0XHRcdHZhciBjb250YWluZXIgPSB7XG5cdFx0XHRcdFx0cnBjX21zZzoge30sXG5cdFx0XHRcdFx0cnBjX2RpcjogX3NlbGYuZW5kcG9pbnQuZGlyXG5cdFx0XHRcdH07XG5cdFx0XHRcdGNvbnRhaW5lci5ycGNfbXNnW19zZWxmLm5hbWVdID0gbXNnO1xuXG5cdFx0XHRcdF9zZWxmLnNlbmRMb2dnZXIuZW5hYmxlZCAmJiBfc2VsZi5zZW5kTG9nZ2VyLmxvZygnXFxuXFxuXFxuU2VuZGluZyAlcyB0byBbJXNdIGFzIFxcbicsbW9kZSA9PSdyZXNwb25kJz8ncmVzcG9uc2UnOidyZXF1ZXN0JywgdE5hbWUsIGNvbnRhaW5lcik7XG5cdFx0XHRcdFByb21pc2UucmVzb2x2ZShfc2VsZi5lbmRwb2ludC50cmFuc3BvcnRzW3RpZF0uc2VuZChjb250YWluZXIpKVxuXHRcdFx0XHRcdC50aGVuKChzKSA9PiBzZW50ID0gdHJ1ZSlcblx0XHRcdFx0XHQuY2F0Y2goKGUpID0+IHtcblx0XHRcdFx0XHRcdHNlbnQgPSBmYWxzZTtcblx0XHRcdFx0XHRcdGhhbmRsZXIoZSwgTUVTU0FHRVRZUEVTLnJlc3BvbnNlRmFpbCk7XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdH0pO1xuXHRcdH1cblx0XHRlbHNle1xuXG5cdFx0XHR2YXIgY29udGFpbmVyID0ge1xuXHRcdFx0XHRycGNfbXNnOiB7fSxcblx0XHRcdFx0cnBjX2RpcjogX3NlbGYuZW5kcG9pbnQuZGlyXG5cdFx0XHR9O1xuXHRcdFx0Y29udGFpbmVyLnJwY19tc2dbX3NlbGYubmFtZV0gPSBtc2c7XG5cblx0XHRcdF9zZWxmLnNlbmRMb2dnZXIuZW5hYmxlZCAmJiBfc2VsZi5zZW5kTG9nZ2VyLmxvZygnXFxuXFxuXFxuU2VuZGluZyAlcyB0byBbJXNdIGFzIFxcbicsbW9kZSA9PSdyZXNwb25kJz8ncmVzcG9uc2UnOidyZXF1ZXN0JywgdE5hbWUsIGNvbnRhaW5lcik7XG5cdFx0XHRyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKF9zZWxmLmVuZHBvaW50LnRyYW5zcG9ydHNbdGlkXS5zZW5kKGNvbnRhaW5lcikpO1xuXHRcdH1cblx0fTtcblxuXHRycGNDb21tYW5kLnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKG5hbWVzcGFjZSwgZGF0YSwgbW9kZSkge1xuXHRcdHZhciBfc2VsZiA9IHRoaXM7XG5cdFx0dmFyIHROYW1lO1xuXHRcdG5hbWVzcGFjZSA9IG5ldyBOYW1lc3BhY2UobmFtZXNwYWNlKTtcblx0XHR2YXIgdGFza3MgPSBbXTtcblxuXHRcdHZhciBtc2cgPSB7XG5cdFx0XHRtc2dJRDogX3NlbGYuYXV0b0lEKCksXG5cdFx0XHRtc2dUeXBlOiBNRVNTQUdFVFlQRVMucmVxdWVzdCxcblx0XHRcdHJlcURhdGE6IGRhdGEsXG5cdFx0fTtcblxuXHRcdE9iamVjdC5rZXlzKF9zZWxmLmVuZHBvaW50LnRyYW5zcG9ydHMpXG5cdFx0XHQuZm9yRWFjaChmdW5jdGlvbih0aWQpe1xuXHRcdFx0XHRfc2VsZi5zZW5kTG9nZ2VyLmVuYWJsZWQgJiYgX3NlbGYuc2VuZExvZ2dlci5sb2coJ1NjYW5uaW5nIGZvciBuYW1lc3BhY2Ugb24gdHJhbnNwb3J0IFslc10gYXMgXFxuJywgdGlkKTtcblxuXHRcdFx0XHR0TmFtZSA9IF9zZWxmLmVuZHBvaW50LnRyYW5zcG9ydHNbdGlkXS50TmFtZTtcblx0XHRcdFx0aWYgKF9zZWxmLmVuZHBvaW50LnRyYW5zcG9ydHNbdGlkXS5pbml0aWFsaXNlZCA9PT0gdHJ1ZSAmJiBuYW1lc3BhY2UudGVzdCh0TmFtZSkpIHtcblx0XHRcdFx0XHRfc2VsZi5zZW5kTG9nZ2VyLmVuYWJsZWQgJiYgX3NlbGYuc2VuZExvZ2dlci5sb2coJ1RyYW5zcG9ydCBbJXNdIGlzIHZhbGlkLiBBdHRlbXB0aW5nIHRvIHNlbmQnLCB0aWQpO1xuXHRcdFx0XHRcdHRhc2tzLnB1c2goX3NlbGYuc2VuZFRvSUQodGlkLCBtc2csIG1vZGUpKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRpZiAodGFza3MubGVuZ3RoID4gMClcblx0XHRcdHJldHVybiBQcm9taXNlLmFsbCh0YXNrcyk7XG5cdFx0ZWxzZVxuXHRcdFx0cmV0dXJuIFByb21pc2UucmVzb2x2ZShbe1xuXHRcdFx0XHRzZW50OiBmYWxzZSxcblx0XHRcdFx0c3RhdHVzOiBmYWxzZSxcblx0XHRcdFx0dHJhbnNwb3J0OiAnJyxcblx0XHRcdFx0Y29tbWFuZDogX3NlbGYubmFtZSxcblx0XHRcdFx0cmVzcG9uc2U6ICdubyB0cmFuc3BvcnRzIGFkZGVkJ1xuXHRcdFx0fV0pO1xuXHR9O1xuXG5cdC8vIHJwY0NvbW1hbmQucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiAobmFtZXNwYWNlU3RyaW5nLCBkYXRhKSB7XG5cdC8vIFx0dmFyIF9zZWxmID0gdGhpcztcblx0Ly9cblx0Ly8gXHR2YXIgbXNnID0ge1xuXHQvLyBcdFx0bXNnSUQ6IF9zZWxmLmF1dG9JRCgpLFxuXHQvLyBcdFx0bXNnVHlwZTogTUVTU0FHRVRZUEVTLnJlcXVlc3QsXG5cdC8vIFx0XHRyZXFEYXRhOiBkYXRhLFxuXHQvLyBcdH07XG5cdC8vXG5cdC8vXG5cdC8vIFx0X3NlbGYuc2VuZExvZ2dlci5lbmFibGVkICYmIF9zZWxmLnNlbmRMb2dnZXIubG9nKCdSZXF1ZXN0aW5nIFJQQyB3aXRoIG1zZyA9ICcsIG1zZyk7XG5cdC8vIFx0cmV0dXJuIF9zZWxmLnNlbmQobmFtZXNwYWNlU3RyaW5nLCBtc2cpO1xuXHQvL1xuXHQvLyB9O1xuXG5cblx0cnBjQ29tbWFuZC5wcm90b3R5cGUucmVjaWV2ZSA9IGZ1bmN0aW9uIChtc2csIHRyYW5zcG9ydCkge1xuXHRcdHZhciBfc2VsZiA9IHRoaXM7XG5cdFx0dmFyIHROYW1lID0gdHJhbnNwb3J0LnROYW1lLCB0aWQgPSB0cmFuc3BvcnQuaWQ7XG5cblx0XHRfc2VsZi5yZWN2TG9nZ2VyLmVuYWJsZWQgJiYgX3NlbGYucmVjdkxvZ2dlci5sb2coJ1xcblxcblxcbkNvbW1hbmQgWyVzXSBEYXRhIHJlY3ZkIG9uIFslc11bJXNdIGFzIFxcbicsX3NlbGYubmFtZSwgX3NlbGYuZW5kcG9pbnQubGFiZWwsX3NlbGYuZW5kcG9pbnQuZGlyLHROYW1lLCBtc2cpO1xuXG5cdFx0c3dpdGNoIChtc2cubXNnVHlwZSkge1xuXHRcdGNhc2UgTUVTU0FHRVRZUEVTLnJlc3BvbnNlQWNjZXB0OlxuXHRcdGNhc2UgTUVTU0FHRVRZUEVTLnJlc3BvbnNlRmFpbDpcblx0XHRcdC8vIGNvbnNvbGUubG9nKCdcXG5cXG5cXG5SZXNwb25zZSByZWN2ZCBvbiBbJXNdIGZyb20gWyVzXSBhc1xcbiAnLHROYW1lLCBtc2cucnROYW1lLCBtc2cpO1xuXHRcdFx0aWYgKF9zZWxmLnJlc3BvbnNlSGFuZGxlcnNbdGlkXSAmJiBfc2VsZi5yZXNwb25zZUhhbmRsZXJzW3RpZF1bbXNnLnJlc3BJRF0pIHtcblx0XHRcdFx0Ly8gY29uc29sZS5sb2coJ2hhbmRsZXIgZm91bmQuIFJlc3BvbmRpbmcgIScpO1xuXHRcdFx0XHRfc2VsZi5yZXNwb25zZUhhbmRsZXJzW3RpZF1bbXNnLnJlc3BJRF0obXNnLnJlc3BEYXRhLCBtc2cubXNnVHlwZSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBjb25zb2xlLmxvZygnaGFuZGxlciBub3QgZm91bmQnKTtcblx0XHRcdH1cblx0XHRcdGJyZWFrO1xuXG5cdFx0Y2FzZSBNRVNTQUdFVFlQRVMucmVxdWVzdDpcblx0XHRcdC8vIGNvbnNvbGUgLmxvZygnXFxuXFxuQ29tbWFuZFslc10gUmVxdWVzdCByZWN2ZCBvbiBbJXNdIGFzXFxuICcsX3NlbGYubmFtZSwgdE5hbWUsbXNnKTtcblxuXHRcdFx0aWYgKF9zZWxmLnJlcXVlc3RIYW5kbGVycy5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdC8vIGNvbnNvbGUubG9nKCdcXG5bJXNdUmVxdWVzdCBoYW5kbGVycyBmb3VuZFxcbiAnLF9zZWxmLnJlcXVlc3RIYW5kbGVycy5sZW5ndGgpO1xuXG5cdFx0XHRcdHZhciBjaGFpbiA9IFByb21pc2UucmVzb2x2ZSgpO1xuXHRcdFx0XHR2YXIgcmVxRGF0YSA9IG1zZy5yZXFEYXRhO1xuXG5cdFx0XHRcdF9zZWxmLnJlcXVlc3RIYW5kbGVycy5mb3JFYWNoKChoKSA9PiB7XG5cdFx0XHRcdFx0LyogRWFjaCBoYW5kbGVyIGlzIGNhbGxlZCB3aXRoICh2LHAsbCxzKSBhcyBmb2xsb3dzXG5cdFx0XHRcdFx0XHR2XHQ9IHJlcURhdGEgXHQtIGRhdGEgc2VudCBieSBjYWxsZXIsXG5cdFx0XHRcdFx0XHRwXHQ9IHByZXZcdFx0LSByZXNwb25zZSBnb3QgZnJvbSB0aGUgcHJldmhhbmRsZXIncyBleGVjdXRpb24gZm9yIHRoaXMgY2FsbCxcblx0XHRcdFx0XHRcdGxcdD0gdE5hbWUgXHRcdC0gbmFtZSBvZiBjdXJyZW50IHRyYW5zcG9ydCAoVE9ETyAtIGJ1Z2d5LCBwb2ludHMgdG8gbG9jYWwgdHJhbnNwb3J0IG5hbWUpXG5cdFx0XHRcdFx0XHRzIFx0PSBtc2cudE5hbWUgXHQtIG5hbWUgb2YgdGhlIGNhbGxpbmcgdHJhbnNwb3J0ICh0aGlzIHdhcyB0aGUgYWN0dWFsIHVzZWNhc2UgZm9yIHROYW1lID8pXG5cdFx0XHRcdFx0Ki9cblx0XHRcdFx0XHRjaGFpbiA9IGNoYWluLnRoZW4oKHByZXYpID0+IGgobXNnLnJlcURhdGEsIHByZXYsIHROYW1lLCBtc2cudE5hbWUpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHRcdHJldHVybiBjaGFpblxuXHRcdFx0XHRcdC50aGVuKChyZXNwRGF0YSkgPT4ge1xuXHRcdFx0XHRcdFx0Ly8gY29uc29sZS5sb2coJ1xcblJlcXVlc3QgaGFuZGxlcnMgU1VDQ0VTU1xcbiBSZXN1bHRzIGFyZScscmVzcERhdGEpO1xuXG5cdFx0XHRcdFx0XHRtc2cucmVzcElEID0gbXNnLm1zZ0lEO1xuXHRcdFx0XHRcdFx0bXNnLnJ0TmFtZSA9IHROYW1lO1xuXHRcdFx0XHRcdFx0bXNnLm1zZ0lEID0gX3NlbGYuYXV0b0lEKCk7XG5cdFx0XHRcdFx0XHRtc2cubXNnVHlwZSA9IE1FU1NBR0VUWVBFUy5yZXNwb25zZUFjY2VwdDtcblx0XHRcdFx0XHRcdG1zZy5yZXNwRGF0YSA9IHJlc3BEYXRhO1xuXHRcdFx0XHRcdFx0ZGVsZXRlIG1zZy5yZXFEYXRhO1xuXHRcdFx0XHRcdFx0cmV0dXJuIF9zZWxmLnNlbmRUb0lEKHRpZCwgbXNnLCAncmVzcG9uZCcpO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0LmNhdGNoKChlKSA9PiB7XG5cdFx0XHRcdFx0XHQvLyBjb25zb2xlLmxvZygnXFxuUmVxdWVzdCBoYW5kbGVycyBGQUlMRURcXG4gUmVzdWx0cyBhcmUnLGUpO1xuXG5cdFx0XHRcdFx0XHRtc2cucmVzcElEID0gbXNnLm1zZ0lEO1xuXHRcdFx0XHRcdFx0bXNnLnJ0TmFtZSA9IHROYW1lO1xuXHRcdFx0XHRcdFx0bXNnLm1zZ0lEID0gX3NlbGYuYXV0b0lEKCk7XG5cdFx0XHRcdFx0XHRtc2cubXNnVHlwZSA9IE1FU1NBR0VUWVBFUy5yZXNwb25zZUZhaWw7XG5cdFx0XHRcdFx0XHRtc2cucmVzcERhdGEgPSBlO1xuXHRcdFx0XHRcdFx0ZGVsZXRlIG1zZy5yZXFEYXRhO1xuXHRcdFx0XHRcdFx0cmV0dXJuIF9zZWxmLnNlbmRUb0lEKHRpZCwgbXNnLCAncmVzcG9uZCcpO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0LnRoZW4oKCkgPT4gX3NlbGYub25Qcm92aWRlRm4gPyBfc2VsZi5vblByb3ZpZGVGbihyZXFEYXRhLCBtc2cucmVzcERhdGEsIHROYW1lLCBtc2cpIDogbnVsbClcblx0XHRcdFx0XHQuY2F0Y2goKGUpID0+IHtcblx0XHRcdFx0XHRcdGNvbnNvbGUuZXJyb3IoJ1VuZXhwZWN0ZWQgRXJyb3Igd2hpbGUgZXhlY3V0aW5nIG9uUHJvdmlkZSBmdW5jdGlvbiAtICcsIGUpO1xuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBfc2VsZi5yZWN2TG9nZ2VyLmVuYWJsZWQgJiYgX3NlbGYucmVjdkxvZ2dlci5lcnJvcignRVJST1IgLSBObyByZXF1ZXN0SGFuZGxlcnMgZm9yIGNvbW1hbmRbJXNdIG9uIFslc11bJXNdIC0gIHROYW1lLCBtc2cgLSAnLCBfc2VsZi5uYW1lLCBfc2VsZi5lbmRwb2ludC5sYWJlbCwgX3NlbGYuZW5kcG9pbnQuZGlyLCB0TmFtZSwgbXNnKTtcblx0XHRcdFx0bXNnLnJlc3BJRCA9IG1zZy5tc2dJRDtcblx0XHRcdFx0bXNnLnJ0TmFtZSA9IHROYW1lO1xuXHRcdFx0XHRtc2cubXNnSUQgPSBfc2VsZi5hdXRvSUQoKTtcblx0XHRcdFx0bXNnLm1zZ1R5cGUgPSBNRVNTQUdFVFlQRVMucmVzcG9uc2VGYWlsO1xuXHRcdFx0XHRtc2cucmVzcERhdGEgPSAnbm8gcHJvdmlkZXJzJztcblx0XHRcdFx0ZGVsZXRlIG1zZy5yZXFEYXRhO1xuXHRcdFx0XHRyZXR1cm4gX3NlbGYuc2VuZFRvSUQodGlkLCBtc2csICdyZXNwb25kJyk7XG5cblx0XHRcdH1cblx0XHRcdGJyZWFrO1xuXHRcdH1cblx0fTtcblxuXHRycGNDb21tYW5kLnByb3RvdHlwZS5wcm92aWRlID0gZnVuY3Rpb24gKGZuKSB7XG5cdFx0aWYgKHR5cGVvZiBmbiA9PSBcImZ1bmN0aW9uXCIpXG5cdFx0XHR0aGlzLnJlcXVlc3RIYW5kbGVycy5wdXNoKGZuKTtcblx0XHRlbHNlIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcignUGFyYW0gcGFzc2VkIHRvIFwicHJvdmlkZVwiIGlzIG5vdCBhIGZ1bmN0aW9uJyk7XG5cdFx0fVxuXHR9O1xuXG5cdHJwY0NvbW1hbmQucHJvdG90eXBlLnVuUHJvdmlkZSA9IGZ1bmN0aW9uIChmbikge1xuXHRcdHZhciBpbmRleCA9IHRoaXMucmVxdWVzdEhhbmRsZXJzLmZpbmRJbmRleCgoeCkgPT4geCA9PT0gZm4pO1xuXHRcdGlmIChpbmRleCA+IC0xKVxuXHRcdFx0dGhpcy5yZXF1ZXN0SGFuZGxlcnMuc3BsaWNlKGhhbmRsZXJJbmRleCwgMSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH07XG5cblx0Lypcblx0XHRFeGVjdXRlcyBwYXNzZWQgZm4gd2hlbiBwcm92aWRlIHJlc3BvbnNlIGlzIHN1Y2Nlc3NmdWxseSByZWNpZXZlZCBieSByZW1vdGUuXG5cdFx0XHRBc3N1bWluZyB0cmFuc3BvcnQgc2VuZCgpIGZ1bmN0aW9uIHJldHVybnMgYSBwcm9taXNlIG9uIHN1Y2Nlc3NmdWxsXG5cdFx0XHR0cmFuc2ZlciBvZiByZXNwb25zZSBtZXNzYWdlXG5cdCovXG5cdHJwY0NvbW1hbmQucHJvdG90eXBlLm9uUHJvdmlkZSA9IGZ1bmN0aW9uIChmbikge1xuXHRcdGlmICh0eXBlb2YgZm4gPT0gXCJmdW5jdGlvblwiKVxuXHRcdFx0dGhpcy5vblByb3ZpZGVGbiA9IGZuO1xuXHRcdGVsc2Uge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCdQYXJhbSBwYXNzZWQgdG8gXCJvblByb3ZpZGVGblwiIGlzIG5vdCBhIGZ1bmN0aW9uJyk7XG5cdFx0fVxuXHR9O1xuXG5cblxuXHQvKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5cblx0bW9kdWxlLmV4cG9ydHMgPSBycGNDb21tYW5kO1xuXG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcblxuXHRjb25zdCBOYW1lc3BhY2UgPSByZXF1aXJlKCcuL25hbWVzcGFjZS5qcycpO1xuXHRjb25zdCBycGNTdG9ja1RyYW5zcG9ydHMgPSByZXF1aXJlKCcuL3N0b2NrVHJhbnNwb3J0cy5qcycpO1xuXHRjb25zdCBycGNUcmFuc3BvcnQgPSByZXF1aXJlKCcuL3JwY1RyYW5zcG9ydC5qcycpO1xuXHRjb25zdCBycGNDb21tYW5kID0gcmVxdWlyZSgnLi9ycGNDb21tYW5kLmpzJyk7XG5cdC8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cblxuXHR2YXIgcnBjRW5kcG9pbnQgPSBmdW5jdGlvbiAobCwgZGlyLCBvcHRpb25zKSB7XG5cdFx0b3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG5cdFx0dGhpcy5sb2dnZXIgPSBvcHRpb25zLmxvZ2dlci5jaGlsZChkaXIgPT0gJ2knPydFUDppbic6J0VQOm91dCcpO1xuXG5cblx0XHR0aGlzLnRyYW5zcG9ydHMgPSB7fTtcblx0XHR0aGlzLmxhYmVsID0gbDtcblx0XHR0aGlzLmRpciA9IGRpcjtcblx0XHR0aGlzLmNvbW1hbmRzID0ge307XG5cdFx0dGhpcy50cmFuc3BvcnRUeXBlcyA9IHJwY1N0b2NrVHJhbnNwb3J0cztcblxuXHRcdHRoaXMubG9nZ2VyLmVuYWJsZWQgJiYgdGhpcy5sb2dnZXIubG9nKCdDcmVhdGVkIG5ldyBlbmRwb2ludCBhcyBbJXNdWyVzXScsIGwsZGlyKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9O1xuXG5cdHJwY0VuZHBvaW50LnByb3RvdHlwZS5wbHVnaW5UcmFuc3BvcnRzID0gZnVuY3Rpb24gKHRDb2xsKSB7XG5cdFx0dGhpcy50cmFuc3BvcnRUeXBlcyA9IE9iamVjdC5hc3NpZ24odGhpcy50cmFuc3BvcnRUeXBlcywgdENvbGwpO1xuXHR9O1xuXG5cdHJwY0VuZHBvaW50LnByb3RvdHlwZS5vdmVyID0gZnVuY3Rpb24gKHNvY2tldCwgdHlwZSkge1xuXHRcdHJldHVybiBuZXcgcnBjVHJhbnNwb3J0KHR5cGUsIHNvY2tldCwgdGhpcywge2xvZ2dlcjp0aGlzLmxvZ2dlcn0pO1xuXHR9O1xuXHRycGNFbmRwb2ludC5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gKHNvY2tldCkge1xuXHRcdHZhciBfc2VsZiA9IHRoaXM7XG5cdFx0T2JqZWN0LmtleXMoX3NlbGYudHJhbnNwb3J0cykuZm9yRWFjaCgodGlkKT0+e1xuXHRcdFx0aWYoX3NlbGYudHJhbnNwb3J0c1t0aWRdLnNvY2tldCA9PT0gc29ja2V0KVxuXHRcdFx0XHRkZWxldGUgX3NlbGYudHJhbnNwb3J0c1t0aWRdO1xuXHRcdH0pO1xuXHR9O1xuXG5cdHJwY0VuZHBvaW50LnByb3RvdHlwZS5yZW5hbWUgPSBmdW5jdGlvbiAobmFtZXNwYWNlKSB7XG5cdFx0dmFyIF9zZWxmID0gdGhpcztcblx0XHRuYW1lc3BhY2UgPSBuZXcgTmFtZXNwYWNlKG5hbWVzcGFjZSk7XG5cdFx0cmV0dXJuIHtcblx0XHRcdGFzOiAobmV3TmFtZSkgPT4ge1xuXHRcdFx0XHRfc2VsZi5sYWJlbCA9IG5ld05hbWU7XG5cdFx0XHRcdE9iamVjdC5rZXlzKF9zZWxmLnRyYW5zcG9ydHMpLmZvckVhY2goKHROYW1lKSA9PiB7XG5cdFx0XHRcdFx0aWYgKG5hbWVzcGFjZS50ZXN0KHROYW1lKSkge1xuXHRcdFx0XHRcdFx0X3NlbGYudHJhbnNwb3J0c1t0TmFtZV0uYXMobmV3TmFtZSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdHJwY0VuZHBvaW50LnByb3RvdHlwZS5kaXNwbGF5U3RyaW5nID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBfc2VsZiA9IHRoaXM7XG5cdFx0dmFyIGxvZ1N0cmluZyA9ICdrZXlcXHRcXHRcXHRuYW1lXFx0XFx0XFx0dHlwZTppZFxcdFxcdFxcdGluaXRhbGlzZWRcXG4nO1xuXHRcdE9iamVjdC5rZXlzKF9zZWxmLnRyYW5zcG9ydHMpLmZvckVhY2goKHRLZXkpID0+IHtcblx0XHRcdGxvZ1N0cmluZys9YCR7dEtleX1cXHRcXHQke19zZWxmLnRyYW5zcG9ydHNbdEtleV0udE5hbWV9XFx0XFx0JHtfc2VsZi50cmFuc3BvcnRzW3RLZXldLnR5cGUgKyc6Jytfc2VsZi50cmFuc3BvcnRzW3RLZXldLmlkfVxcdFxcdCR7X3NlbGYudHJhbnNwb3J0c1t0S2V5XS5pbml0aWFsaXNlZH1cXG5gO1xuXHRcdH0pO1xuXHRcdHJldHVybiBsb2dTdHJpbmc7XG5cdH07XG5cblx0cnBjRW5kcG9pbnQucHJvdG90eXBlLmNvbW1hbmQgPSBmdW5jdGlvbiAobmFtZSkge1xuXHRcdHJldHVybiBuZXcgcnBjQ29tbWFuZChuYW1lLCB0aGlzLCB7bG9nZ2VyOnRoaXMubG9nZ2VyfSk7XG5cdH07XG5cblxuXHQvKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5cblx0bW9kdWxlLmV4cG9ydHMgPSBycGNFbmRwb2ludDtcblxufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG5cdHZhciBpZENvdW50ID0gMDtcblx0dmFyIGF1dG9JRCA9IGZ1bmN0aW9uKCl7XG5cdFx0cmV0dXJuICdUJysgKCsraWRDb3VudCk7XG5cdH07XG5cblx0dmFyIHJwY1RyYW5zcG9ydCA9IGZ1bmN0aW9uICh0eXBlLCBzb2NrZXQsIGVuZHBvaW50LCBvcHRpb25zKSB7XG5cdFx0Ly8gY29uc29sZS5sb2coJ0NyZWF0aW5nIHJwYyB0cmFuc3BvcnQgWyVzXSBmb3IgZW5kcG9pbnQgWyVzXVslc10nLHR5cGUsIGVuZHBvaW50LmxhYmVsLCBlbmRwb2ludC5kaXIpO1xuXHRcdG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXHRcdHZhciBfc2VsZiA9IHRoaXM7XG5cblx0XHRfc2VsZi5pZCA9IGF1dG9JRCgpO1xuXHRcdF9zZWxmLmxvZ2dlciA9IG9wdGlvbnMubG9nZ2VyLmNoaWxkKCdUOicrdHlwZSsnOicrX3NlbGYuaWQpO1xuXG5cdFx0X3NlbGYuZW5kcG9pbnQgPSBlbmRwb2ludDtcblx0XHRfc2VsZi50eXBlID0gdHlwZTtcblx0XHRfc2VsZi5zb2NrZXQgPSBzb2NrZXQ7XHQvLyBBbHNvIHVzZWQgZm9yIG1hdGNoaW5nICYgcmVtb3ZhbCwgYmVzaWRlcyBpbnRlcm5hbCBzb2NrZXQgYWNjZXNzLlxuXHRcdF9zZWxmLnROYW1lID0gJ25vbm5hbWUnO1xuXHRcdF9zZWxmLmluaXRpYWxpc2VkID0gZmFsc2U7XG5cdFx0X3NlbGYubmFtZUNsb2NrID0gMDtcblx0XHRfc2VsZi5kaXJGbGlwID0ge1xuXHRcdFx0aTogJ28nLFxuXHRcdFx0bzogJ2knXG5cdFx0fTtcblxuXHRcdC8vIEFkZCB0cmFzcG9ydCB0eXBlIHNwZWNpZmljIG1ldGhvZHMgdG8gc2VsZlxuXHRcdE9iamVjdC5hc3NpZ24oX3NlbGYsIF9zZWxmLmVuZHBvaW50LnRyYW5zcG9ydFR5cGVzW3R5cGVdKHR5cGUsIHNvY2tldCkpO1xuXG5cdFx0X3NlbGYuaW5pdFByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzLHJlaik9Pntcblx0XHRcdF9zZWxmLm9uUmVjdigoZGF0YSkgPT4ge1xuXHRcdFx0XHQvLyBjb25zb2xlLmxvZygnW29uUmVjdl0gRGF0YSByZWN2ZCBvbiBbJXNdWyVzXScsX3NlbGYudE5hbWUsX3NlbGYuZW5kcG9pbnQuZGlyLCBkYXRhKTtcblx0XHRcdFx0aWYgKGRhdGEucnBjX2RpciA9PSBfc2VsZi5kaXJGbGlwW19zZWxmLmVuZHBvaW50LmRpcl0pIHtcblx0XHRcdFx0XHQvLyBjb25zb2xlLmxvZygnW29uUmVjdl0gRGF0YSBhY2NlcHRlZCBvbiBbJXNdWyVzXScsX3NlbGYudE5hbWUsX3NlbGYuZW5kcG9pbnQuZGlyLCBkYXRhKTtcblxuXHRcdFx0XHRcdGlmIChkYXRhLnJwY190TmFtZV9jaGFuZ2UpIHtcblx0XHRcdFx0XHRcdC8qXG5cdFx0XHRcdFx0XHRcdE5PVEUgLSBJbXBsZW1lbnRpbmcgXCJMYXRlc3QgJiBsYXN0IHdyaXRlIHdpbnNcIiBjb25zZW5zdXMgcG9saWN5IDpcblx0XHRcdFx0XHRcdFx0XHRXSFkgPyAtIFJlcXVpcmVkIHRvIHNvbHZlIGRpc3B1dGVzIHdoZW4gYm90aChvciBtb3JlKSBlbmRwb2ludHMgcmVxdWVzdCBhIG5hbWUgY2hhbmdlIGF0IHRoZSBzYW1lIHRpbWUuXG5cdFx0XHRcdFx0XHRcdFx0V2l0aG91dCB0aGlzLCBhIHNpbXVsdGFuZW91cyByZXF1ZXN0IGNhdXNlcyBlYWNoIG9uZSB0byBzZW5kcyBoaXMgbmFtZSBjaGFuZ2Ugb3ZlciB3aGlsZSBpbXBsZW1lbnRpbmcgdGhlIG90aGVyJ3MgbmFtZSBjaGFuZ2UgcmVxdWVzdC5cblx0XHRcdFx0XHRcdFx0XHQgXHRjb25zZXF1ZW5jZSAtIGEgbmFtZSBzd2FwLCBpbnN0ZWFkIG9mIGNvbnNlbnN1cyBvbiBhIHNpbmdsZSBuYW1lIHZhbHVlLlxuXHRcdFx0XHRcdFx0Ki9cblx0XHRcdFx0XHRcdGlmIChkYXRhLnJwY190TmFtZV9jaGFuZ2UuZm9yY2UgfHwgZGF0YS5ycGNfdE5hbWVfY2hhbmdlLmNsb2NrID49IF9zZWxmLm5hbWVDbG9jaykge1xuXHRcdFx0XHRcdFx0XHRfc2VsZi5sb2dnZXIuZW5hYmxlZCAmJiBfc2VsZi5sb2dnZXIubG9nKCdbJXMsIGNsb2NrICVzXSBbJXNdIENoYW5naW5nIG5hbWUgb2YgdHJhbnNwb3J0IFslc11bJXNdIHRvIFslc10gYXQgY2xvY2sgPScsIF9zZWxmLmVuZHBvaW50LmxhYmVsLCBfc2VsZi5uYW1lQ2xvY2ssIGRhdGEucnBjX3ROYW1lX2NoYW5nZS5mb3JjZSA/ICdmb3JjZWQnIDogJycsIF9zZWxmLnROYW1lLF9zZWxmLmlkLCBkYXRhLnJwY190TmFtZV9jaGFuZ2UudE5hbWUsIGRhdGEucnBjX3ROYW1lX2NoYW5nZS5jbG9jayk7XG5cdFx0XHRcdFx0XHRcdC8vIGRlbGV0ZSBfc2VsZi5lbmRwb2ludC50cmFuc3BvcnRzW19zZWxmLnROYW1lXTtcblx0XHRcdFx0XHRcdFx0X3NlbGYudE5hbWUgPSBkYXRhLnJwY190TmFtZV9jaGFuZ2UudE5hbWU7XG5cdFx0XHRcdFx0XHRcdF9zZWxmLm5hbWVDbG9jayA9IGRhdGEucnBjX3ROYW1lX2NoYW5nZS5jbG9jaztcblx0XHRcdFx0XHRcdFx0Ly8gX3NlbGYuZW5kcG9pbnQudHJhbnNwb3J0c1tfc2VsZi50TmFtZV0gPSBfc2VsZjtcblx0XHRcdFx0XHRcdFx0aWYoIV9zZWxmLmluaXRpYWxpc2VkKSB7XG5cdFx0XHRcdFx0XHRcdFx0X3NlbGYuaW5pdGlhbGlzZWQgPSB0cnVlO1xuXHRcdFx0XHRcdFx0XHRcdHJlcygpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRfc2VsZi5sb2dnZXIuZW5hYmxlZCAmJiBfc2VsZi5sb2dnZXIubG9nKCdbJXMsIGNsb2NrICVzXSBbJXNdIFJlamVjdGluZyBuYW1lIGNoYW5nZSBvZiB0cmFuc3BvcnQgWyVzXVslc10gYXMgWyVzXSBhdCBjbG9jayA9Jyxfc2VsZi5lbmRwb2ludC5sYWJlbCxfc2VsZi5uYW1lQ2xvY2ssZGF0YS5ycGNfdE5hbWVfY2hhbmdlLmZvcmNlPydmb3JjZWQnOicnLCBfc2VsZi50TmFtZSxfc2VsZi5pZCwgZGF0YS5ycGNfdE5hbWVfY2hhbmdlLnROYW1lLGRhdGEucnBjX3ROYW1lX2NoYW5nZS5jbG9jayk7XG5cdFx0XHRcdFx0XHRcdF9zZWxmLnNlbmQoe1xuXHRcdFx0XHRcdFx0XHRcdHJwY190TmFtZV9jaGFuZ2U6IHtcblx0XHRcdFx0XHRcdFx0XHRcdHROYW1lOiBfc2VsZi50TmFtZSxcblx0XHRcdFx0XHRcdFx0XHRcdGNsb2NrOiBfc2VsZi5uYW1lQ2xvY2ssXG5cdFx0XHRcdFx0XHRcdFx0XHRmb3JjZTogdHJ1ZVxuXHRcdFx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0XHRcdFx0cnBjX2RpcjogX3NlbGYuZW5kcG9pbnQuZGlyXG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChkYXRhLnJwY19tc2cpIHtcblx0XHRcdFx0XHRcdE9iamVjdC5rZXlzKGRhdGEucnBjX21zZykuZm9yRWFjaCgoY0tleSkgPT4ge1xuXHRcdFx0XHRcdFx0XHRpZiAoX3NlbGYuZW5kcG9pbnQuY29tbWFuZHNbY0tleV0pXG5cdFx0XHRcdFx0XHRcdFx0X3NlbGYuZW5kcG9pbnQuY29tbWFuZHNbY0tleV0ucmVjaWV2ZShkYXRhLnJwY19tc2dbY0tleV0sIF9zZWxmKTtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdF9zZWxmLmFzID0gZnVuY3Rpb24gKHROYW1lKSB7XG5cdFx0XHRcdC8vIGRlbGV0ZSBfc2VsZi5lbmRwb2ludC50cmFuc3BvcnRzW19zZWxmLnROYW1lXTtcblx0XHRcdFx0dmFyIHByZXZOYW1lID0gX3NlbGYudE5hbWU7XG5cdFx0XHRcdF9zZWxmLnROYW1lID0gdE5hbWU7XG5cdFx0XHRcdF9zZWxmLm5hbWVDbG9jaysrO1xuXHRcdFx0XHRfc2VsZi5sb2dnZXIuZW5hYmxlZCAmJiBfc2VsZi5sb2dnZXIubG9nKCdbJXNdIFNlbmRpbmcgbmFtZWNoYW5nZSBvZiB0cmFuc3BvcnQgWyVzXVslc10gdG8gWyVzXSBhdCBjbG9jayA9Jyxfc2VsZi5lbmRwb2ludC5sYWJlbCwgcHJldk5hbWUsdE5hbWUsX3NlbGYuaWQsIF9zZWxmLm5hbWVDbG9jayk7XG5cdFx0XHRcdF9zZWxmLnNlbmQoe1xuXHRcdFx0XHRcdHJwY190TmFtZV9jaGFuZ2U6IHtcblx0XHRcdFx0XHRcdHROYW1lOiBfc2VsZi50TmFtZSxcblx0XHRcdFx0XHRcdGNsb2NrOiBfc2VsZi5uYW1lQ2xvY2tcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdHJwY19kaXI6IF9zZWxmLmVuZHBvaW50LmRpclxuXHRcdFx0XHR9KTtcblx0XHRcdFx0Ly8gX3NlbGYuZW5kcG9pbnQudHJhbnNwb3J0c1t0TmFtZV0gPSBfc2VsZjtcblx0XHRcdFx0aWYoIV9zZWxmLmluaXRpYWxpc2VkKSB7XG5cdFx0XHRcdFx0X3NlbGYuaW5pdGlhbGlzZWQgPSB0cnVlO1xuXHRcdFx0XHRcdHJlcygpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiBfc2VsZjtcblx0XHRcdH07XG5cdFx0fSk7XG5cblx0XHRfc2VsZi5lbmRwb2ludC50cmFuc3BvcnRzW19zZWxmLmlkXSA9IF9zZWxmO1xuXHRcdF9zZWxmLmxvZ2dlci5lbmFibGVkICYmIF9zZWxmLmxvZ2dlci5sb2coJ0FkZGVkIHRyYW5zcG9ydCBbJXNdWyVzXSBmb3IgZW5kcG9pbnQgWyVzXVslc10nLHR5cGUsX3NlbGYuaWQsIGVuZHBvaW50LmxhYmVsLCBlbmRwb2ludC5kaXIpO1xuXHRcdHJldHVybiBfc2VsZjtcblx0fTtcblxuXHQvKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5cblx0bW9kdWxlLmV4cG9ydHMgPSBycGNUcmFuc3BvcnQ7XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuXG5cdHZhciB0cmFuc3BvcnRUeXBlcyA9IHt9O1xuXG5cdHRyYW5zcG9ydFR5cGVzWydzb2NrZXRpbyddID0gZnVuY3Rpb24gKHR5cGUsIHNvY2tldCkge1xuXHRcdHJldHVybiB7XG5cdFx0XHRzZW5kOiAoZGF0YSkgPT4gc29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkoZGF0YSkpLFxuXHRcdFx0b25SZWN2OiAoZm4pID0+IHNvY2tldC5vbignbWVzc2FnZScsIChkYXRhKSA9PiBmbihKU09OLnBhcnNlKGRhdGEpKSlcblx0XHR9XG5cdH07XG5cdHRyYW5zcG9ydFR5cGVzWyd3ZWJzb2NrZXQnXSA9IGZ1bmN0aW9uICh0eXBlLCBzb2NrZXQpIHtcblx0XHRyZXR1cm4ge1xuXHRcdFx0c2VuZDogKGRhdGEpID0+IHtcblx0XHRcdFx0cmV0dXJuIG5ldyBQcm9taXNlKChyZXMsIHJlaikgPT4ge1xuXHRcdFx0XHRcdHNvY2tldC5zZW5kKFxuXHRcdFx0XHRcdFx0SlNPTi5zdHJpbmdpZnkoZGF0YSksXG5cdFx0XHRcdFx0XHQoZSkgPT4gZSA/IHJlaihlKSA6IHJlcygpXG5cdFx0XHRcdFx0KTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9LFxuXHRcdFx0b25SZWN2OiAoZm4pID0+IHNvY2tldC5vbignbWVzc2FnZScsIChkYXRhKSA9PiBmbihKU09OLnBhcnNlKGRhdGEpKSlcblx0XHR9XG5cdH07XG5cdHRyYW5zcG9ydFR5cGVzWydwcm9jZXNzTG9jYWwnXSA9IGZ1bmN0aW9uICh0eXBlLCBzb2NrZXQpIHtcblx0XHRyZXR1cm4ge1xuXHRcdFx0c2VuZDogKGRhdGEpID0+IHNvY2tldC5lbWl0KCdtZXNzYWdlJywgSlNPTi5zdHJpbmdpZnkoZGF0YSkpLFxuXHRcdFx0b25SZWN2OiAoZm4pID0+IHNvY2tldC5vbignbWVzc2FnZScsIChkYXRhKSA9PiBmbihKU09OLnBhcnNlKGRhdGEpKSlcblx0XHR9XG5cdH07XG5cdHRyYW5zcG9ydFR5cGVzWydub2RlRUVMb2NhbCddID0gZnVuY3Rpb24gKHR5cGUsIHNvY2tldCkge1xuXHRcdHJldHVybiB7XG5cdFx0XHRzZW5kOiAoZGF0YSkgPT4gc29ja2V0LmVtaXQoJ21lc3NhZ2UnLCBKU09OLnN0cmluZ2lmeShkYXRhKSksXG5cdFx0XHRvblJlY3Y6IChmbikgPT4gc29ja2V0Lm9uKCdtZXNzYWdlJywgKGRhdGEpID0+IGZuKEpTT04ucGFyc2UoZGF0YSkpKVxuXHRcdH1cblx0fTtcblx0dHJhbnNwb3J0VHlwZXNbJ3Byb2Nlc3NSZW1vdGUnXSA9IGZ1bmN0aW9uICh0eXBlLCBzb2NrZXQpIHtcblx0XHRyZXR1cm4ge1xuXHRcdFx0c2VuZDogKGRhdGEpID0+IHNvY2tldC5zZW5kKEpTT04uc3RyaW5naWZ5KGRhdGEpKSxcblx0XHRcdHNlbmQ6IChkYXRhKSA9PiB7XG5cdFx0XHRcdHJldHVybiBuZXcgUHJvbWlzZSgocmVzLCByZWopID0+IHtcblx0XHRcdFx0XHR2YXIgcyA9IHNvY2tldC5zZW5kKFxuXHRcdFx0XHRcdFx0SlNPTi5zdHJpbmdpZnkoZGF0YSksXG5cdFx0XHRcdFx0XHQoZSkgPT4gZSBpbnN0YW5jZW9mIEVycm9yID8gcmVqKGUpIDogKHMgPT09IHRydWU/IHJlcyhzKTpyZWoocykpXG5cdFx0XHRcdFx0KTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9LFxuXHRcdFx0b25SZWN2OiAoZm4pID0+IHNvY2tldC5vbignbWVzc2FnZScsIChkYXRhKSA9PiBmbihKU09OLnBhcnNlKGRhdGEpKSlcblx0XHR9XG5cdH07XG5cdHRyYW5zcG9ydFR5cGVzWydub2RlRUVSZW1vdGUnXSA9IGZ1bmN0aW9uICh0eXBlLCBzb2NrZXQpIHtcblx0XHRyZXR1cm4ge1xuXHRcdFx0c2VuZDogKGRhdGEpID0+IHNvY2tldC5zZW5kKCdtZXNzYWdlJywgSlNPTi5zdHJpbmdpZnkoZGF0YSkpLFxuXHRcdFx0b25SZWN2OiAoZm4pID0+IHNvY2tldC5vbignbWVzc2FnZScsIChkYXRhKSA9PiBmbihKU09OLnBhcnNlKGRhdGEpKSlcblx0XHR9XG5cdH07XG5cblx0bW9kdWxlLmV4cG9ydHMgPSB0cmFuc3BvcnRUeXBlcztcblxufSkoKTtcbiIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZGVidWcpe1xuXG5cdHZhciBsb2dnZXIgPSBmdW5jdGlvbiAoc3VmZml4KSB7XG5cdFx0dGhpcy5lbmFibGVkID0gZmFsc2U7XG5cdFx0dGhpcy5wcmVmaXggPSBzdWZmaXggfHwgJyc7XG5cblx0XHRpZih0eXBlb2YgZGVidWcgPT0gJ2Z1bmN0aW9uJyl7XG5cdFx0XHR0aGlzLmxvZyA9IGRlYnVnKGBsb2dzOmAgKyB0aGlzLnByZWZpeCk7XG5cdFx0XHR0aGlzLndhcm4gPSBkZWJ1Zyhgd2FybmluZ3M6YCArIHRoaXMucHJlZml4KTtcblx0XHRcdHRoaXMuZXJyb3IgPSBkZWJ1ZyhgZXJyb3JzOmAgKyB0aGlzLnByZWZpeCk7XG5cdFx0XHR0aGlzLmVuYWJsZWQgPSB0cnVlO1xuXHRcdH1cblx0XHRlbHNle1xuXHRcdFx0dGhpcy5sb2cgPSAoKT0+e307XG5cdFx0XHR0aGlzLndhcm4gPSAoKT0+e307XG5cdFx0XHR0aGlzLmVycm9yID0gKCk9Pnt9O1xuXHRcdFx0dGhpcy5lbmFibGVkID0gZmFsc2U7XG5cdFx0fVxuXHR9O1xuXG5cdGxvZ2dlci5wcm90b3R5cGUuY2hpbGQgPSBmdW5jdGlvbiAoc3VmZml4KSB7XG5cdFx0cmV0dXJuIG5ldyBsb2dnZXIodGhpcy5wcmVmaXggKyAnOicgKyBzdWZmaXgpO1xuXHR9O1xuXG5cdHJldHVybiBsb2dnZXI7XG59O1xuIiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoZGVidWcpIHtcblxuXHRjb25zdCBOYW1lc3BhY2UgPSByZXF1aXJlKCcuL2NvbXBvbmVudHMvbmFtZXNwYWNlLmpzJyk7XG5cdGNvbnN0IHJwY0VuZHBvaW50ID0gcmVxdWlyZSgnLi9jb21wb25lbnRzL3JwY0VuZHBvaW50LmpzJyk7XG5cdGNvbnN0IGRlYnVnciA9IHJlcXVpcmUoJ2RlYnVnLXBlc3QnKShkZWJ1Zyk7XG5cdHZhciBhcHBMb2dnZXIgPSBuZXcgZGVidWdyKCdvY3RvcHVzJyk7XG5cblx0LyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuXHR2YXIgcnBjcyA9IHt9O1xuXG5cdHZhciBycGMgPSBmdW5jdGlvbiAobmFtZSwgb3B0aW9ucykge1xuXHRcdG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXG5cblx0XHRpZiAob3B0aW9ucy5jcmVhdGUgPT09IHRydWUpIHtcblx0XHRcdHRoaXMubmFtZSA9IG5hbWU7XG5cdFx0XHR0aGlzLmNvbW1hbmRzID0ge307XG5cdFx0XHR0aGlzLmxvZ2dlciA9IGFwcExvZ2dlci5jaGlsZCh0aGlzLm5hbWUpO1xuXG5cdFx0XHR0aGlzLmluY29taW5nID0gbmV3IHJwY0VuZHBvaW50KG5hbWUsICdpJywgeyBsb2dnZXI6IHRoaXMubG9nZ2VyfSk7XG5cdFx0XHR0aGlzLm91dGdvaW5nID0gbmV3IHJwY0VuZHBvaW50KG5hbWUsICdvJywgeyBsb2dnZXI6IHRoaXMubG9nZ2VyfSk7XG5cblx0XHRcdHRoaXMubG9nZ2VyLmVuYWJsZWQgJiYgdGhpcy5sb2dnZXIubG9nKCdDcmVhdGVkIG5ldyBPY3RvcHVzIFJQQyBhcyAnLCB0aGlzLm5hbWUpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0aWYgKCFycGNzW25hbWVdKSB7XG5cdFx0XHRvcHRpb25zLmNyZWF0ZSA9IHRydWU7XG5cdFx0XHRycGNzW25hbWVdID0gbmV3IHJwYyhuYW1lLCBvcHRpb25zKTtcblx0XHR9XG5cblxuXHRcdHJldHVybiBycGNzW25hbWVdO1xuXG5cdH07XG5cdHJwYy5wcm90b3R5cGUuZGlzcGxheVRyYW5zcG9ydHMgPSBmdW5jdGlvbiAoKSB7XG5cdFx0Ly8gY29uc29sZS5sb2coJ1xcblxcblxcbi0tLS0tLSBUcmFuc3BvcnRzIGZvciBbJXNdIGFyZTpcXG4nLCB0aGlzLm5hbWUpO1xuXHRcdC8vIGNvbnNvbGUubG9nKCdpbmNvbWluZzpcXG4nKTtcblx0XHQvLyB0aGlzLmluY29taW5nLmRpc3BsYXlUcmFuc3BvcnRzKCk7XG5cdFx0Ly8gY29uc29sZS5sb2coJ1xcblxcbm91dGdvaW5nOlxcbicpO1xuXHRcdC8vIHRoaXMub3V0Z29pbmcuZGlzcGxheVRyYW5zcG9ydHMoKTtcblx0XHQvLyBjb25zb2xlLmxvZygnXFxuLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cXG5cXG4nKTtcblxuXHRcdHZhciBsb2dTdHJpbmcgPSBgXG5cbi0tLS0tLS0tLS0tLS0tLS0tLS0tIFRSQU5TUE9SVFMgZm9yIFske3RoaXMubmFtZX1dIGFyZSA6IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5JbmNvbWluZyAocHJvdmlkZXMpOlxuXG5gO1xuXG5cdFx0bG9nU3RyaW5nICs9IHRoaXMuaW5jb21pbmcuZGlzcGxheVN0cmluZygpO1xuXHRcdGxvZ1N0cmluZyArPWBcXG5cXG4tLS0tLS0tLS0tLS0tXFxuT3V0Z29pbmcgKGNhbGxzKTpcXG5cXG5gO1xuXHRcdGxvZ1N0cmluZyArPSB0aGlzLm91dGdvaW5nLmRpc3BsYXlTdHJpbmcoKTtcblx0XHRsb2dTdHJpbmcgKz0nXFxuXFxuLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXFxuXFxuJztcblxuXHRcdGNvbnNvbGUubG9nKGxvZ1N0cmluZyk7XG5cdH07XG5cblx0cnBjLnByb3RvdHlwZS5vdmVyID0gZnVuY3Rpb24gKHNvY2tldCwgdHlwZSkge1xuXHRcdHZhciB0YXNrcyA9IFtdO1xuXHRcdHRhc2tzLnB1c2godGhpcy5pbmNvbWluZy5vdmVyKHNvY2tldCwgdHlwZSlcblx0XHRcdC5hcyh0aGlzLm5hbWUpXG5cdFx0XHQuaW5pdFByb21pc2UpO1xuXHRcdHRhc2tzLnB1c2godGhpcy5vdXRnb2luZy5vdmVyKHNvY2tldCwgdHlwZSlcblx0XHRcdC5pbml0UHJvbWlzZSk7XG5cdFx0cmV0dXJuIFByb21pc2UuYWxsKHRhc2tzKTtcblx0fTtcblx0cnBjLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbiAoc29ja2V0KSB7XG5cdFx0dGhpcy5pbmNvbWluZy5yZW1vdmUoc29ja2V0KTtcblx0XHR0aGlzLm91dGdvaW5nLnJlbW92ZShzb2NrZXQpO1xuXHR9O1xuXG5cdHJwYy5wcm90b3R5cGUucGx1Z2luVHJhbnNwb3J0cyA9IGZ1bmN0aW9uICh0T2JqKSB7XG5cdFx0dGhpcy5pbmNvbWluZy5wbHVnaW5UcmFuc3BvcnRzKHRPYmopO1xuXHRcdHRoaXMub3V0Z29pbmcucGx1Z2luVHJhbnNwb3J0cyh0T2JqKTtcblx0fTtcblx0cnBjLnByb3RvdHlwZS5jb21tYW5kID0gZnVuY3Rpb24gKG5hbWUpIHtcblx0XHR2YXIgX3NlbGYgPSB0aGlzO1xuXHRcdGlmICghX3NlbGYuY29tbWFuZHNbbmFtZV0pIHtcblx0XHRcdHZhciBpQyA9IF9zZWxmLmluY29taW5nLmNvbW1hbmQobmFtZSk7XG5cdFx0XHR2YXIgb0MgPSBfc2VsZi5vdXRnb2luZy5jb21tYW5kKG5hbWUpO1xuXHRcdFx0X3NlbGYuTUVTU0FHRVRZUEVTID0gaUMuTUVTU0FHRVRZUEVTIHx8IG9DLk1FU1NBR0VUWVBFUztcblxuXHRcdFx0X3NlbGYuY29tbWFuZHNbbmFtZV0gPSB7XG5cdFx0XHRcdHByb3ZpZGU6IGZ1bmN0aW9uIChmbikge1xuXHRcdFx0XHRcdGlDLnByb3ZpZGUoZm4pO1xuXHRcdFx0XHRcdHJldHVybiBfc2VsZi5jb21tYW5kc1tuYW1lXTtcblx0XHRcdFx0fSxcblx0XHRcdFx0dW5Qcm92aWRlOiBmdW5jdGlvbiAoZm4pIHtcblx0XHRcdFx0XHRpQy51blByb3ZpZGUoZm4pO1xuXHRcdFx0XHRcdHJldHVybiBfc2VsZi5jb21tYW5kc1tuYW1lXTtcblx0XHRcdFx0fSxcblx0XHRcdFx0b25Qcm92aWRlOiBmdW5jdGlvbiAoZm4pIHtcblx0XHRcdFx0XHRpQy5vblByb3ZpZGUoZm4pO1xuXHRcdFx0XHRcdHJldHVybiBfc2VsZi5jb21tYW5kc1tuYW1lXTtcblx0XHRcdFx0fSxcblx0XHRcdFx0Y2FsbDogZnVuY3Rpb24gKGZpbHRlciwgZGF0YSkge1xuXHRcdFx0XHRcdC8vIF9zZWxmLmRpc3BsYXlUcmFuc3BvcnRzKCk7XG5cdFx0XHRcdFx0cmV0dXJuIG9DLmNhbGwoZmlsdGVyLCBkYXRhKTtcblx0XHRcdFx0fVxuXHRcdFx0fTtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMuY29tbWFuZHNbbmFtZV07XG5cdH07XG5cdHJwYy5wcm90b3R5cGUucmVuYW1lVG8gPSBmdW5jdGlvbiAobmV3TmFtZSkge1xuXHRcdHRoaXMuaW5jb21pbmcucmVuYW1lKHRoaXMubmFtZSlcblx0XHRcdC5hcyhuZXdOYW1lKTtcblx0XHR0aGlzLm5hbWUgPSBuZXdOYW1lO1xuXHRcdC8vIHRoaXMub3V0Z29pbmcubGFiZWwgPSBuZXdOYW1lO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9O1xuXG5cblx0LyogLS0tLS0tLS0tLS0tLS0tLSAgUmVzdWx0IHBhcnNpbmcgJiBSZXNvbHZpbmcgdG8gUHJvbWlzZSByZXNvbHZlL3JlamVjdCAtLS0tLS0tLS0tLSovXG5cblx0cnBjLnByb3RvdHlwZS5wYXJzZUJ5U3RhdHVzID0gZnVuY3Rpb24gKHJlcykge1xuXHRcdHZhciB2YWxpZHMgPSBbXSxcblx0XHRcdGludmFsaWRzID0gW10sXG5cdFx0XHRjaGVjaztcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHJlcy5sZW5ndGg7IGkrKykge1xuXHRcdFx0Y2hlY2sgPSByZXNbaV07XG5cdFx0XHRpZiAoY2hlY2suc2VudCA9PT0gdHJ1ZSAmJiBjaGVjay5zdGF0dXMgPT09IHRydWUpXG5cdFx0XHRcdHZhbGlkcy5wdXNoKGNoZWNrKTtcblx0XHRcdGVsc2Vcblx0XHRcdFx0aW52YWxpZHMucHVzaChjaGVjayk7XG5cdFx0fVxuXHRcdHJldHVybiB7XG5cdFx0XHR2YWxpZHM6IHZhbGlkcyxcblx0XHRcdGludmFsaWRzOiBpbnZhbGlkc1xuXHRcdH07XG5cdH07XG5cblx0cnBjLnByb3RvdHlwZS5yZXNvbHZlID0gZnVuY3Rpb24gKHApIHtcblx0XHRpZiAocC5zZW50ID09PSB0cnVlICYmIHAuc3RhdHVzID09PSB0cnVlKVxuXHRcdFx0cmV0dXJuIFByb21pc2UucmVzb2x2ZShwLnJlc3BvbnNlKTtcblx0XHRlbHNlXG5cdFx0XHRyZXR1cm4gUHJvbWlzZS5yZWplY3QocC5yZXNwb25zZSk7XG5cdH07XG5cdHJwYy5wcm90b3R5cGUucmVzb2x2ZUFsbCA9IGZ1bmN0aW9uIChwKSB7XG5cblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHAubGVuZ3RoOyBpKyspIHtcblx0XHRcdGlmIChwW2ldLnNlbnQgPT09IGZhbHNlIHx8IHBbaV0uc3RhdHVzID09PSBmYWxzZSlcblx0XHRcdFx0cmV0dXJuIFByb21pc2UucmVqZWN0KHApO1xuXHRcdH1cblxuXHRcdHJldHVybiBQcm9taXNlLnJlc29sdmUocCk7XG5cdH07XG5cdHJwYy5wcm90b3R5cGUucmVzb2x2ZUF0TGVhc3RPbmUgPSBmdW5jdGlvbiAocCkge1xuXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBwLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRpZiAocFtpXS5zZW50ID09PSB0cnVlICYmIHBbaV0uc3RhdHVzID09PSB0cnVlKVxuXHRcdFx0XHRyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHApO1xuXHRcdH1cblxuXHRcdHJldHVybiBQcm9taXNlLnJlamVjdChwKTtcblx0fTtcblxuXG5cblxuXHRyZXR1cm4gcnBjO1xuXG59O1xuIl19"}