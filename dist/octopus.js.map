{"version":3,"sources":["node_modules/browser-pack/_prelude.js","components/namespace.js","components/rpcCommand.js","components/rpcEndpoint.js","components/rpcTransport.js","components/stockTransports.js","node_modules/debug-pest/index.js","octopus.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/RA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"octopus.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","(function () {\n\n\t/* ------\n\t\n\t\tCode below is adapted from the debug library, duly licensed as below.\n\n\t\t(The MIT License)\n\n\t\tCopyright (c) 2014 TJ Holowaychuk <tj@vision-media.ca>\n\n\t\tPermission is hereby granted, free of charge, to any person obtaining a copy of this software\n\t\tand associated documentation files (the 'Software'), to deal in the Software without restriction,\n\t\tincluding without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense,\n\t\tand/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so,\n\t\tsubject to the following conditions:\n\n\t\tThe above copyright notice and this permission notice shall be included in all copies or substantial\n\t\tportions of the Software.\n\n\t\tTHE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT\n\t\tLIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n\t\tIN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n\t\tWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n\t\tSOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n\t------ */\n\n\tvar Namespace = function (namespaces) {\n\n\t\tthis.names = [];\n\t\tthis.skips = [];\n\n\t\tvar i;\n\t\tvar split = (typeof namespaces === 'string' ? namespaces : '').split(/[\\s,]+/);\n\t\tvar len = split.length;\n\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tif (!split[i]) continue; // ignore empty strings\n\t\t\tnamespaces = split[i].replace(/\\*/g, '.*?');\n\t\t\tif (namespaces[0] === '-') {\n\t\t\t\tthis.skips.push(new RegExp('^' + namespaces.substr(1) + '$'));\n\t\t\t} else {\n\t\t\t\tthis.names.push(new RegExp('^' + namespaces + '$'));\n\t\t\t}\n\t\t}\n\n\n\t\treturn this;\n\t};\n\n\n\tNamespace.prototype.test = function (value) {\n\t\tvar i, len;\n\n\t\tfor (i = 0, len = this.skips.length; i < len; i++) {\n\t\t\tif (!this.skips[i].test(value))\n\t\t\t\treturn false;\n\t\t}\n\n\t\tfor (i = 0, len = this.names.length; i < len; i++) {\n\t\t\tif (this.names[i].test(value))\n\t\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t};\n\n\n\n\tmodule.exports = Namespace;\n\n})();\n","(function () {\n\n\tconst Namespace = require('./namespace.js');\n\n\n\n\t/* ----------------------------------------------------------- */\n\n\n\tconst MESSAGETYPES = {\n\t\trequest: 'RQ',\n\t\tresponseAccept: 'RA',\n\t\tresponseFail: 'RF',\n\t\tresponseAcceptError: 'RAE',\n\t\tresponseFailError: 'RFE'\n\t};\n\n\n\tvar rpcCommand = function (name, endpoint, options) {\n\t\toptions = options || {};\n\t\t// console.log('Creating rpc command [%s] for endpoint [%s][%s]',name, endpoint.label, endpoint.dir);\n\t\tthis.name = name;\n\t\tthis.endpoint = endpoint;\n\t\tthis.requestHandlers = [];\n\t\tthis.responseHandlers = {};\n\t\tthis.onProvideFn = null;\n\t\tthis.endpoint.commands[name] = this;\n\n\t\tthis.logger = options.logger.child('CMD:'+this.name);\n\t\tthis.sendLogger = this.logger.child('send');\n\t\tthis.recvLogger = this.logger.child('recv');\n\t\tthis.logger.enabled && this.logger.log('Created new command as ', name);\n\n\t\tthis.MESSAGETYPES = MESSAGETYPES;\n\t\treturn this;\n\t};\n\n\n\trpcCommand.prototype.autoID = function () {\n\t\treturn Math.random().toString().substr(8) + '-' + Date.now();\n\t};\n\n\trpcCommand.prototype.sendToID = function(tid, msg, mode){\n\t\tvar _self = this;\n\t\tvar tName = _self.endpoint.transports[tid].tName;\n\t\tmsg.source = _self.endpoint.label;\n\t\t_self.sendLogger.enabled && _self.sendLogger.log('Sending on transport [%s][%s], mode = %s,  msg =', tid,tName,mode,msg);\n\n\t\tif (!mode || mode != 'respond') {\n\n\t\t\treturn new Promise((res, rej) => {\n\n\t\t\t\tvar sent = false;\n\n\t\t\t\t// handler function\n\t\t\t\tvar handler = function (respData, msgType) {\n\t\t\t\t\t_self.sendLogger.enabled && _self.sendLogger.log('\\n\\nResponse handler called with respData & msgTypes as \\n',respData, msgType);\n\n\t\t\t\t\tdelete _self.responseHandlers[tid][msg.msgID];\n\n\t\t\t\t\tswitch (msgType) {\n\n\t\t\t\t\tcase MESSAGETYPES.responseAccept:\n\t\t\t\t\t\tres({\n\t\t\t\t\t\t\tsent: sent,\n\t\t\t\t\t\t\tstatus: true,\n\t\t\t\t\t\t\ttransport: tName,\n\t\t\t\t\t\t\tcommand: _self.name,\n\t\t\t\t\t\t\tresponse: respData\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase MESSAGETYPES.responseFail:\n\t\t\t\t\t\tres({\n\t\t\t\t\t\t\tsent: sent,\n\t\t\t\t\t\t\tstatus: false,\n\t\t\t\t\t\t\ttransport: tName,\n\t\t\t\t\t\t\tcommand: _self.name,\n\t\t\t\t\t\t\tresponse: respData\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t};\n\n\n\t\t\t\tif (!_self.responseHandlers[tid])\n\t\t\t\t\t_self.responseHandlers[tid] = {};\n\n\t\t\t\t_self.responseHandlers[tid][msg.msgID] = handler;\n\n\n\t\t\t\tvar container = {\n\t\t\t\t\trpc_msg: {},\n\t\t\t\t\trpc_dir: _self.endpoint.dir\n\t\t\t\t};\n\t\t\t\tcontainer.rpc_msg[_self.name] = msg;\n\n\t\t\t\t_self.sendLogger.enabled && _self.sendLogger.log('\\n\\n\\nSending %s to [%s] as \\n',mode =='respond'?'response':'request', tName, container);\n\t\t\t\tPromise.resolve(_self.endpoint.transports[tid].send(container))\n\t\t\t\t\t.then((s) => sent = true)\n\t\t\t\t\t.catch((e) => {\n\t\t\t\t\t\tsent = false;\n\t\t\t\t\t\thandler(e, MESSAGETYPES.responseFail);\n\t\t\t\t\t});\n\n\t\t\t});\n\t\t}\n\t\telse{\n\n\t\t\tvar container = {\n\t\t\t\trpc_msg: {},\n\t\t\t\trpc_dir: _self.endpoint.dir\n\t\t\t};\n\t\t\tcontainer.rpc_msg[_self.name] = msg;\n\n\t\t\t_self.sendLogger.enabled && _self.sendLogger.log('\\n\\n\\nSending %s to [%s] as \\n',mode =='respond'?'response':'request', tName, container);\n\t\t\treturn Promise.resolve(_self.endpoint.transports[tid].send(container));\n\t\t}\n\t};\n\n\trpcCommand.prototype.call = function (namespace, data, mode) {\n\t\tvar _self = this;\n\t\tvar tName;\n\t\tnamespace = new Namespace(namespace);\n\t\tvar tasks = [];\n\n\t\tvar msg = {\n\t\t\tmsgID: _self.autoID(),\n\t\t\tmsgType: MESSAGETYPES.request,\n\t\t\treqData: data,\n\t\t};\n\n\t\tObject.keys(_self.endpoint.transports)\n\t\t\t.forEach(function(tid){\n\t\t\t\t_self.sendLogger.enabled && _self.sendLogger.log('Scanning for namespace on transport [%s] as \\n', tid);\n\n\t\t\t\ttName = _self.endpoint.transports[tid].tName;\n\t\t\t\tif (_self.endpoint.transports[tid].initialised === true && namespace.test(tName)) {\n\t\t\t\t\t_self.sendLogger.enabled && _self.sendLogger.log('Transport [%s] is valid. Attempting to send', tid);\n\t\t\t\t\ttasks.push(_self.sendToID(tid, msg, mode));\n\t\t\t\t}\n\t\t\t});\n\n\t\tif (tasks.length > 0)\n\t\t\treturn Promise.all(tasks);\n\t\telse\n\t\t\treturn Promise.resolve([{\n\t\t\t\tsent: false,\n\t\t\t\tstatus: false,\n\t\t\t\ttransport: '',\n\t\t\t\tcommand: _self.name,\n\t\t\t\tresponse: 'no transports added'\n\t\t\t}]);\n\t};\n\n\t// rpcCommand.prototype.call = function (namespaceString, data) {\n\t// \tvar _self = this;\n\t//\n\t// \tvar msg = {\n\t// \t\tmsgID: _self.autoID(),\n\t// \t\tmsgType: MESSAGETYPES.request,\n\t// \t\treqData: data,\n\t// \t};\n\t//\n\t//\n\t// \t_self.sendLogger.enabled && _self.sendLogger.log('Requesting RPC with msg = ', msg);\n\t// \treturn _self.send(namespaceString, msg);\n\t//\n\t// };\n\n\n\trpcCommand.prototype.recieve = function (msg, transport) {\n\t\tvar _self = this;\n\t\tvar tName = transport.tName, tid = transport.id;\n\n\t\t_self.recvLogger.enabled && _self.recvLogger.log('\\n\\n\\nCommand [%s] Data recvd on [%s][%s] as \\n',_self.name, _self.endpoint.label,_self.endpoint.dir,tName, msg);\n\n\t\tswitch (msg.msgType) {\n\t\tcase MESSAGETYPES.responseAccept:\n\t\tcase MESSAGETYPES.responseFail:\n\t\t\t// console.log('\\n\\n\\nResponse recvd on [%s] from [%s] as\\n ',tName, msg.rtName, msg);\n\t\t\tif (_self.responseHandlers[tid] && _self.responseHandlers[tid][msg.respID]) {\n\t\t\t\t// console.log('handler found. Responding !');\n\t\t\t\t_self.responseHandlers[tid][msg.respID](msg.respData, msg.msgType);\n\t\t\t} else {\n\t\t\t\t// console.log('handler not found');\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase MESSAGETYPES.request:\n\t\t\t// console .log('\\n\\nCommand[%s] Request recvd on [%s] as\\n ',_self.name, tName,msg);\n\n\t\t\tif (_self.requestHandlers.length > 0) {\n\t\t\t\t// console.log('\\n[%s]Request handlers found\\n ',_self.requestHandlers.length);\n\n\t\t\t\tvar chain = Promise.resolve();\n\t\t\t\tvar reqData = msg.reqData;\n\n\t\t\t\t_self.requestHandlers.forEach((h) => {\n\t\t\t\t\t/* Each handler is called with (v,p,l,s) as follows\n\t\t\t\t\t\tv\t= reqData \t- data sent by caller,\n\t\t\t\t\t\tp\t= prev\t\t- response got from the prevhandler's execution for this call,\n\t\t\t\t\t\tl\t= tName \t\t- name of current transport (TODO - buggy, points to local transport name)\n\t\t\t\t\t\ts \t= msg.tName \t- name of the calling transport (this was the actual usecase for tName ?)\n\t\t\t\t\t*/\n\t\t\t\t\tchain = chain.then((prev) => h(msg.reqData, prev, tName, msg.tName));\n\t\t\t\t});\n\t\t\t\treturn chain\n\t\t\t\t\t.then((respData) => {\n\t\t\t\t\t\t// console.log('\\nRequest handlers SUCCESS\\n Results are',respData);\n\n\t\t\t\t\t\tmsg.respID = msg.msgID;\n\t\t\t\t\t\tmsg.rtName = tName;\n\t\t\t\t\t\tmsg.msgID = _self.autoID();\n\t\t\t\t\t\tmsg.msgType = MESSAGETYPES.responseAccept;\n\t\t\t\t\t\tmsg.respData = respData;\n\t\t\t\t\t\tdelete msg.reqData;\n\t\t\t\t\t\treturn _self.sendToID(tid, msg, 'respond');\n\t\t\t\t\t})\n\t\t\t\t\t.catch((e) => {\n\t\t\t\t\t\t// console.log('\\nRequest handlers FAILED\\n Results are',e);\n\n\t\t\t\t\t\tmsg.respID = msg.msgID;\n\t\t\t\t\t\tmsg.rtName = tName;\n\t\t\t\t\t\tmsg.msgID = _self.autoID();\n\t\t\t\t\t\tmsg.msgType = MESSAGETYPES.responseFail;\n\t\t\t\t\t\tmsg.respData = e;\n\t\t\t\t\t\tdelete msg.reqData;\n\t\t\t\t\t\treturn _self.sendToID(tid, msg, 'respond');\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => _self.onProvideFn ? _self.onProvideFn(reqData, msg.respData, tName, msg) : null)\n\t\t\t\t\t.catch((e) => {\n\t\t\t\t\t\tconsole.error('Unexpected Error while executing onProvide function - ', e);\n\t\t\t\t\t});\n\n\t\t\t} else {\n\t\t\t\t// _self.recvLogger.enabled && _self.recvLogger.error('ERROR - No requestHandlers for command[%s] on [%s][%s] -  tName, msg - ', _self.name, _self.endpoint.label, _self.endpoint.dir, tName, msg);\n\t\t\t\tmsg.respID = msg.msgID;\n\t\t\t\tmsg.rtName = tName;\n\t\t\t\tmsg.msgID = _self.autoID();\n\t\t\t\tmsg.msgType = MESSAGETYPES.responseFail;\n\t\t\t\tmsg.respData = 'no providers';\n\t\t\t\tdelete msg.reqData;\n\t\t\t\treturn _self.sendToID(tid, msg, 'respond');\n\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t};\n\n\trpcCommand.prototype.provide = function (fn) {\n\t\tif (typeof fn == \"function\")\n\t\t\tthis.requestHandlers.push(fn);\n\t\telse {\n\t\t\tthrow new Error('Param passed to \"provide\" is not a function');\n\t\t}\n\t};\n\n\trpcCommand.prototype.unProvide = function (fn) {\n\t\tvar index = this.requestHandlers.findIndex((x) => x === fn);\n\t\tif (index > -1)\n\t\t\tthis.requestHandlers.splice(handlerIndex, 1);\n\t\treturn this;\n\t};\n\n\t/*\n\t\tExecutes passed fn when provide response is successfully recieved by remote.\n\t\t\tAssuming transport send() function returns a promise on successfull\n\t\t\ttransfer of response message\n\t*/\n\trpcCommand.prototype.onProvide = function (fn) {\n\t\tif (typeof fn == \"function\")\n\t\t\tthis.onProvideFn = fn;\n\t\telse {\n\t\t\tthrow new Error('Param passed to \"onProvideFn\" is not a function');\n\t\t}\n\t};\n\n\n\n\t/* ----------------------------------------------------------- */\n\n\n\tmodule.exports = rpcCommand;\n\n})();\n","(function () {\n\n\tconst Namespace = require('./namespace.js');\n\tconst rpcStockTransports = require('./stockTransports.js');\n\tconst rpcTransport = require('./rpcTransport.js');\n\tconst rpcCommand = require('./rpcCommand.js');\n\t/* ----------------------------------------------------------- */\n\n\n\tvar rpcEndpoint = function (l, dir, options) {\n\t\toptions = options || {};\n\t\tthis.logger = options.logger.child(dir == 'i'?'EP:in':'EP:out');\n\n\n\t\tthis.transports = {};\n\t\tthis.label = l;\n\t\tthis.dir = dir;\n\t\tthis.commands = {};\n\t\tthis.transportTypes = rpcStockTransports;\n\n\t\tthis.logger.enabled && this.logger.log('Created new endpoint as [%s][%s]', l,dir);\n\n\t\treturn this;\n\t};\n\n\trpcEndpoint.prototype.pluginTransports = function (tColl) {\n\t\tthis.transportTypes = Object.assign(transportTypes, tColl);\n\t};\n\n\trpcEndpoint.prototype.over = function (socket, type) {\n\t\treturn new rpcTransport(type, socket, this, {logger:this.logger});\n\t};\n\trpcEndpoint.prototype.remove = function (socket) {\n\t\tvar _self = this;\n\t\tObject.keys(_self.transports).forEach((tid)=>{\n\t\t\tif(_self.transports[tid].socket === socket)\n\t\t\t\tdelete _self.transports[tid];\n\t\t});\n\t};\n\n\trpcEndpoint.prototype.rename = function (namespace) {\n\t\tvar _self = this;\n\t\tnamespace = new Namespace(namespace);\n\t\treturn {\n\t\t\tas: (newName) => {\n\t\t\t\t_self.label = newName;\n\t\t\t\tObject.keys(_self.transports).forEach((tName) => {\n\t\t\t\t\tif (namespace.test(tName)) {\n\t\t\t\t\t\t_self.transports[tName].as(newName);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn this;\n\t\t\t}\n\t\t}\n\t};\n\n\trpcEndpoint.prototype.displayString = function () {\n\t\tvar _self = this;\n\t\tvar logString = 'key\\t\\t\\tname\\t\\t\\ttype:id\\t\\t\\tinitalised\\n';\n\t\tObject.keys(_self.transports).forEach((tKey) => {\n\t\t\tlogString+=`${tKey}\\t\\t${_self.transports[tKey].tName}\\t\\t${_self.transports[tKey].type +':'+_self.transports[tKey].id}\\t\\t${_self.transports[tKey].initialised}\\n`;\n\t\t});\n\t\treturn logString;\n\t};\n\n\trpcEndpoint.prototype.command = function (name) {\n\t\treturn new rpcCommand(name, this, {logger:this.logger});\n\t};\n\n\n\t/* ----------------------------------------------------------- */\n\n\n\tmodule.exports = rpcEndpoint;\n\n})();\n","(function () {\n\tvar idCount = 0;\n\tvar autoID = function(){\n\t\treturn 'T'+ (++idCount);\n\t};\n\n\tvar rpcTransport = function (type, socket, endpoint, options) {\n\t\t// console.log('Creating rpc transport [%s] for endpoint [%s][%s]',type, endpoint.label, endpoint.dir);\n\t\toptions = options || {};\n\t\tvar _self = this;\n\n\t\t_self.id = autoID();\n\t\t_self.logger = options.logger.child('T:'+type+':'+_self.id);\n\n\t\t_self.endpoint = endpoint;\n\t\t_self.type = type;\n\t\t_self.socket = socket;\t// Also used for matching & removal, besides internal socket access.\n\t\t_self.tName = 'nonname';\n\t\t_self.initialised = false;\n\t\t_self.nameClock = 0;\n\t\t_self.dirFlip = {\n\t\t\ti: 'o',\n\t\t\to: 'i'\n\t\t};\n\n\t\t// Add trasport type specific methods to self\n\t\tObject.assign(_self, _self.endpoint.transportTypes[type](type, socket));\n\n\t\t_self.initPromise = new Promise((res,rej)=>{\n\t\t\t_self.onRecv((data) => {\n\t\t\t\t// console.log('[onRecv] Data recvd on [%s][%s]',_self.tName,_self.endpoint.dir, data);\n\t\t\t\tif (data.rpc_dir == _self.dirFlip[_self.endpoint.dir]) {\n\t\t\t\t\t// console.log('[onRecv] Data accepted on [%s][%s]',_self.tName,_self.endpoint.dir, data);\n\n\t\t\t\t\tif (data.rpc_tName_change) {\n\t\t\t\t\t\t/*\n\t\t\t\t\t\t\tNOTE - Implementing \"Latest & last write wins\" consensus policy :\n\t\t\t\t\t\t\t\tWHY ? - Required to solve disputes when both(or more) endpoints request a name change at the same time.\n\t\t\t\t\t\t\t\tWithout this, a simultaneous request causes each one to sends his name change over while implementing the other's name change request.\n\t\t\t\t\t\t\t\t \tconsequence - a name swap, instead of consensus on a single name value.\n\t\t\t\t\t\t*/\n\t\t\t\t\t\tif (data.rpc_tName_change.force || data.rpc_tName_change.clock >= _self.nameClock) {\n\t\t\t\t\t\t\t_self.logger.enabled && _self.logger.log('[%s, clock %s] [%s] Changing name of transport [%s][%s] to [%s] at clock =', _self.endpoint.label, _self.nameClock, data.rpc_tName_change.force ? 'forced' : '', _self.tName,_self.id, data.rpc_tName_change.tName, data.rpc_tName_change.clock);\n\t\t\t\t\t\t\t// delete _self.endpoint.transports[_self.tName];\n\t\t\t\t\t\t\t_self.tName = data.rpc_tName_change.tName;\n\t\t\t\t\t\t\t_self.nameClock = data.rpc_tName_change.clock;\n\t\t\t\t\t\t\t// _self.endpoint.transports[_self.tName] = _self;\n\t\t\t\t\t\t\tif(!_self.initialised) {\n\t\t\t\t\t\t\t\t_self.initialised = true;\n\t\t\t\t\t\t\t\tres();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t_self.logger.enabled && _self.logger.log('[%s, clock %s] [%s] Rejecting name change of transport [%s][%s] as [%s] at clock =',_self.endpoint.label,_self.nameClock,data.rpc_tName_change.force?'forced':'', _self.tName,_self.id, data.rpc_tName_change.tName,data.rpc_tName_change.clock);\n\t\t\t\t\t\t\t_self.send({\n\t\t\t\t\t\t\t\trpc_tName_change: {\n\t\t\t\t\t\t\t\t\ttName: _self.tName,\n\t\t\t\t\t\t\t\t\tclock: _self.nameClock,\n\t\t\t\t\t\t\t\t\tforce: true\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\trpc_dir: _self.endpoint.dir\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data.rpc_msg) {\n\t\t\t\t\t\tObject.keys(data.rpc_msg).forEach((cKey) => {\n\t\t\t\t\t\t\tif (_self.endpoint.commands[cKey])\n\t\t\t\t\t\t\t\t_self.endpoint.commands[cKey].recieve(data.rpc_msg[cKey], _self);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t_self.as = function (tName) {\n\t\t\t\t// delete _self.endpoint.transports[_self.tName];\n\t\t\t\tvar prevName = _self.tName;\n\t\t\t\t_self.tName = tName;\n\t\t\t\t_self.nameClock++;\n\t\t\t\t_self.logger.enabled && _self.logger.log('[%s] Sending namechange of transport [%s][%s] to [%s] at clock =',_self.endpoint.label, prevName,tName,_self.id, _self.nameClock);\n\t\t\t\t_self.send({\n\t\t\t\t\trpc_tName_change: {\n\t\t\t\t\t\ttName: _self.tName,\n\t\t\t\t\t\tclock: _self.nameClock\n\t\t\t\t\t},\n\t\t\t\t\trpc_dir: _self.endpoint.dir\n\t\t\t\t});\n\t\t\t\t// _self.endpoint.transports[tName] = _self;\n\t\t\t\tif(!_self.initialised) {\n\t\t\t\t\t_self.initialised = true;\n\t\t\t\t\tres();\n\t\t\t\t}\n\t\t\t\treturn _self;\n\t\t\t};\n\t\t});\n\n\t\t_self.endpoint.transports[_self.id] = _self;\n\t\t_self.logger.enabled && _self.logger.log('Added transport [%s][%s] for endpoint [%s][%s]',type,_self.id, endpoint.label, endpoint.dir);\n\t\treturn _self;\n\t};\n\n\t/* ----------------------------------------------------------- */\n\n\n\tmodule.exports = rpcTransport;\n\n})();\n","(function () {\n\n\tvar transportTypes = {};\n\n\ttransportTypes['socketio'] = function (type, socket) {\n\t\treturn {\n\t\t\tsend: (data) => socket.send(JSON.stringify(data)),\n\t\t\tonRecv: (fn) => socket.on('message', (data) => fn(JSON.parse(data)))\n\t\t}\n\t};\n\ttransportTypes['websocket'] = function (type, socket) {\n\t\treturn {\n\t\t\tsend: (data) => {\n\t\t\t\treturn new Promise((res, rej) => {\n\t\t\t\t\tsocket.send(\n\t\t\t\t\t\tJSON.stringify(data),\n\t\t\t\t\t\t(e) => e ? rej(e) : res()\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t},\n\t\t\tonRecv: (fn) => socket.on('message', (data) => fn(JSON.parse(data)))\n\t\t}\n\t};\n\ttransportTypes['processLocal'] = function (type, socket) {\n\t\treturn {\n\t\t\tsend: (data) => socket.emit('message', JSON.stringify(data)),\n\t\t\tonRecv: (fn) => socket.on('message', (data) => fn(JSON.parse(data)))\n\t\t}\n\t};\n\ttransportTypes['nodeEELocal'] = function (type, socket) {\n\t\treturn {\n\t\t\tsend: (data) => socket.emit('message', JSON.stringify(data)),\n\t\t\tonRecv: (fn) => socket.on('message', (data) => fn(JSON.parse(data)))\n\t\t}\n\t};\n\ttransportTypes['processRemote'] = function (type, socket) {\n\t\treturn {\n\t\t\tsend: (data) => socket.send(JSON.stringify(data)),\n\t\t\tsend: (data) => {\n\t\t\t\treturn new Promise((res, rej) => {\n\t\t\t\t\tvar s = socket.send(\n\t\t\t\t\t\tJSON.stringify(data),\n\t\t\t\t\t\t(e) => e instanceof Error ? rej(e) : (s === true? res(s):rej(s))\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t},\n\t\t\tonRecv: (fn) => socket.on('message', (data) => fn(JSON.parse(data)))\n\t\t}\n\t};\n\ttransportTypes['nodeEERemote'] = function (type, socket) {\n\t\treturn {\n\t\t\tsend: (data) => socket.send('message', JSON.stringify(data)),\n\t\t\tonRecv: (fn) => socket.on('message', (data) => fn(JSON.parse(data)))\n\t\t}\n\t};\n\n\tmodule.exports = transportTypes;\n\n})();\n","module.exports = function(debug){\n\n\tvar logger = function (suffix) {\n\t\tthis.enabled = false;\n\t\tthis.prefix = suffix || '';\n\n\t\tif(typeof debug == 'function'){\n\t\t\tthis.log = debug(`logs:` + this.prefix);\n\t\t\tthis.warn = debug(`warnings:` + this.prefix);\n\t\t\tthis.error = debug(`errors:` + this.prefix);\n\t\t\tthis.enabled = true;\n\t\t}\n\t\telse{\n\t\t\tthis.log = ()=>{};\n\t\t\tthis.warn = ()=>{};\n\t\t\tthis.error = ()=>{};\n\t\t\tthis.enabled = false;\n\t\t}\n\t};\n\n\tlogger.prototype.child = function (suffix) {\n\t\treturn new logger(this.prefix + ':' + suffix);\n\t};\n\n\treturn logger;\n};\n","module.exports = function (debug) {\n\n\tconst Namespace = require('./components/namespace.js');\n\tconst rpcEndpoint = require('./components/rpcEndpoint.js');\n\tconst debugr = require('debug-pest')(debug);\n\tvar appLogger = new debugr('octopus');\n\n\t/* ----------------------------------------------------------- */\n\n\tvar rpcs = {};\n\n\tvar rpc = function (name, options) {\n\t\toptions = options || {};\n\n\n\t\tif (options.create === true) {\n\t\t\tthis.name = name;\n\t\t\tthis.commands = {};\n\t\t\tthis.logger = appLogger.child(this.name);\n\n\t\t\tthis.incoming = new rpcEndpoint(name, 'i', { logger: this.logger});\n\t\t\tthis.outgoing = new rpcEndpoint(name, 'o', { logger: this.logger});\n\n\t\t\tthis.logger.enabled && this.logger.log('Created new Octopus RPC as ', this.name);\n\t\t\treturn this;\n\t\t}\n\n\t\tif (!rpcs[name]) {\n\t\t\toptions.create = true;\n\t\t\trpcs[name] = new rpc(name, options);\n\t\t}\n\n\n\t\treturn rpcs[name];\n\n\t};\n\trpc.prototype.displayTransports = function () {\n\t\t// console.log('\\n\\n\\n------ Transports for [%s] are:\\n', this.name);\n\t\t// console.log('incoming:\\n');\n\t\t// this.incoming.displayTransports();\n\t\t// console.log('\\n\\noutgoing:\\n');\n\t\t// this.outgoing.displayTransports();\n\t\t// console.log('\\n--------------------------\\n\\n');\n\n\t\tvar logString = `\n\n-------------------- TRANSPORTS for [${this.name}] are : ---------------------------\n\nIncoming (provides):\n\n`;\n\n\t\tlogString += this.incoming.displayString();\n\t\tlogString +=`\\n\\n-------------\\nOutgoing (calls):\\n\\n`;\n\t\tlogString += this.outgoing.displayString();\n\t\tlogString +='\\n\\n------------------------------------------------------------------------------------\\n\\n';\n\n\t\tconsole.log(logString);\n\t};\n\n\trpc.prototype.over = function (socket, type) {\n\t\tvar tasks = [];\n\t\ttasks.push(this.incoming.over(socket, type)\n\t\t\t.as(this.name)\n\t\t\t.initPromise);\n\t\ttasks.push(this.outgoing.over(socket, type)\n\t\t\t.initPromise);\n\t\treturn Promise.all(tasks);\n\t};\n\trpc.prototype.remove = function (socket) {\n\t\tthis.incoming.remove(socket);\n\t\tthis.outgoing.remove(socket);\n\t};\n\n\trpc.prototype.pluginTransports = function (tObj) {\n\t\tthis.incoming.pluginTransports(tObj);\n\t\tthis.outgoing.pluginTransports(tObj);\n\t};\n\trpc.prototype.command = function (name) {\n\t\tvar _self = this;\n\t\tif (!_self.commands[name]) {\n\t\t\tvar iC = _self.incoming.command(name);\n\t\t\tvar oC = _self.outgoing.command(name);\n\t\t\t_self.MESSAGETYPES = iC.MESSAGETYPES || oC.MESSAGETYPES;\n\n\t\t\t_self.commands[name] = {\n\t\t\t\tprovide: function (fn) {\n\t\t\t\t\tiC.provide(fn);\n\t\t\t\t\treturn _self.commands[name];\n\t\t\t\t},\n\t\t\t\tunProvide: function (fn) {\n\t\t\t\t\tiC.unProvide(fn);\n\t\t\t\t\treturn _self.commands[name];\n\t\t\t\t},\n\t\t\t\tonProvide: function (fn) {\n\t\t\t\t\tiC.onProvide(fn);\n\t\t\t\t\treturn _self.commands[name];\n\t\t\t\t},\n\t\t\t\tcall: function (filter, data) {\n\t\t\t\t\t// _self.displayTransports();\n\t\t\t\t\treturn oC.call(filter, data);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t\treturn this.commands[name];\n\t};\n\trpc.prototype.renameTo = function (newName) {\n\t\tthis.incoming.rename(this.name)\n\t\t\t.as(newName);\n\t\tthis.name = newName;\n\t\t// this.outgoing.label = newName;\n\t\treturn this;\n\t};\n\n\n\t/* ----------------  Result parsing & Resolving to Promise resolve/reject -----------*/\n\n\trpc.prototype.parseByStatus = function (res) {\n\t\tvar valids = [],\n\t\t\tinvalids = [],\n\t\t\tcheck;\n\t\tfor (var i = 0; i < res.length; i++) {\n\t\t\tcheck = res[i];\n\t\t\tif (check.sent === true && check.status === true)\n\t\t\t\tvalids.push(check);\n\t\t\telse\n\t\t\t\tinvalids.push(check);\n\t\t}\n\t\treturn {\n\t\t\tvalids: valids,\n\t\t\tinvalids: invalids\n\t\t};\n\t};\n\n\trpc.prototype.resolve = function (p) {\n\t\tif (p.sent === true && p.status === true)\n\t\t\treturn Promise.resolve(p.response);\n\t\telse\n\t\t\treturn Promise.reject(p.response);\n\t};\n\trpc.prototype.resolveAll = function (p) {\n\n\t\tfor (var i = 0; i < p.length; i++) {\n\t\t\tif (p[i].sent === false || p[i].status === false)\n\t\t\t\treturn Promise.reject(p);\n\t\t}\n\n\t\treturn Promise.resolve(p);\n\t};\n\trpc.prototype.resolveAtLeastOne = function (p) {\n\n\t\tfor (var i = 0; i < p.length; i++) {\n\t\t\tif (p[i].sent === true && p[i].status === true)\n\t\t\t\treturn Promise.resolve(p);\n\t\t}\n\n\t\treturn Promise.reject(p);\n\t};\n\n\n\n\n\treturn rpc;\n\n};\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJjb21wb25lbnRzL25hbWVzcGFjZS5qcyIsImNvbXBvbmVudHMvcnBjQ29tbWFuZC5qcyIsImNvbXBvbmVudHMvcnBjRW5kcG9pbnQuanMiLCJjb21wb25lbnRzL3JwY1RyYW5zcG9ydC5qcyIsImNvbXBvbmVudHMvc3RvY2tUcmFuc3BvcnRzLmpzIiwibm9kZV9tb2R1bGVzL2RlYnVnLXBlc3QvaW5kZXguanMiLCJvY3RvcHVzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiKGZ1bmN0aW9uICgpIHtcblxuXHQvKiAtLS0tLS1cblx0XG5cdFx0Q29kZSBiZWxvdyBpcyBhZGFwdGVkIGZyb20gdGhlIGRlYnVnIGxpYnJhcnksIGR1bHkgbGljZW5zZWQgYXMgYmVsb3cuXG5cblx0XHQoVGhlIE1JVCBMaWNlbnNlKVxuXG5cdFx0Q29weXJpZ2h0IChjKSAyMDE0IFRKIEhvbG93YXljaHVrIDx0akB2aXNpb24tbWVkaWEuY2E+XG5cblx0XHRQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5IG9mIHRoaXMgc29mdHdhcmVcblx0XHRhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgJ1NvZnR3YXJlJyksIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sXG5cdFx0aW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSxcblx0XHRhbmQvb3Igc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLFxuXHRcdHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuXG5cdFx0VGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbFxuXHRcdHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cblxuXHRcdFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAnQVMgSVMnLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UXG5cdFx0TElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuXG5cdFx0SU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIgTElBQklMSVRZLFxuXHRcdFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRVxuXHRcdFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLlxuXG5cdC0tLS0tLSAqL1xuXG5cdHZhciBOYW1lc3BhY2UgPSBmdW5jdGlvbiAobmFtZXNwYWNlcykge1xuXG5cdFx0dGhpcy5uYW1lcyA9IFtdO1xuXHRcdHRoaXMuc2tpcHMgPSBbXTtcblxuXHRcdHZhciBpO1xuXHRcdHZhciBzcGxpdCA9ICh0eXBlb2YgbmFtZXNwYWNlcyA9PT0gJ3N0cmluZycgPyBuYW1lc3BhY2VzIDogJycpLnNwbGl0KC9bXFxzLF0rLyk7XG5cdFx0dmFyIGxlbiA9IHNwbGl0Lmxlbmd0aDtcblxuXHRcdGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykge1xuXHRcdFx0aWYgKCFzcGxpdFtpXSkgY29udGludWU7IC8vIGlnbm9yZSBlbXB0eSBzdHJpbmdzXG5cdFx0XHRuYW1lc3BhY2VzID0gc3BsaXRbaV0ucmVwbGFjZSgvXFwqL2csICcuKj8nKTtcblx0XHRcdGlmIChuYW1lc3BhY2VzWzBdID09PSAnLScpIHtcblx0XHRcdFx0dGhpcy5za2lwcy5wdXNoKG5ldyBSZWdFeHAoJ14nICsgbmFtZXNwYWNlcy5zdWJzdHIoMSkgKyAnJCcpKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMubmFtZXMucHVzaChuZXcgUmVnRXhwKCdeJyArIG5hbWVzcGFjZXMgKyAnJCcpKTtcblx0XHRcdH1cblx0XHR9XG5cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9O1xuXG5cblx0TmFtZXNwYWNlLnByb3RvdHlwZS50ZXN0ID0gZnVuY3Rpb24gKHZhbHVlKSB7XG5cdFx0dmFyIGksIGxlbjtcblxuXHRcdGZvciAoaSA9IDAsIGxlbiA9IHRoaXMuc2tpcHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcblx0XHRcdGlmICghdGhpcy5za2lwc1tpXS50ZXN0KHZhbHVlKSlcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdGZvciAoaSA9IDAsIGxlbiA9IHRoaXMubmFtZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcblx0XHRcdGlmICh0aGlzLm5hbWVzW2ldLnRlc3QodmFsdWUpKVxuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH07XG5cblxuXG5cdG1vZHVsZS5leHBvcnRzID0gTmFtZXNwYWNlO1xuXG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcblxuXHRjb25zdCBOYW1lc3BhY2UgPSByZXF1aXJlKCcuL25hbWVzcGFjZS5qcycpO1xuXG5cblxuXHQvKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5cblx0Y29uc3QgTUVTU0FHRVRZUEVTID0ge1xuXHRcdHJlcXVlc3Q6ICdSUScsXG5cdFx0cmVzcG9uc2VBY2NlcHQ6ICdSQScsXG5cdFx0cmVzcG9uc2VGYWlsOiAnUkYnLFxuXHRcdHJlc3BvbnNlQWNjZXB0RXJyb3I6ICdSQUUnLFxuXHRcdHJlc3BvbnNlRmFpbEVycm9yOiAnUkZFJ1xuXHR9O1xuXG5cblx0dmFyIHJwY0NvbW1hbmQgPSBmdW5jdGlvbiAobmFtZSwgZW5kcG9pbnQsIG9wdGlvbnMpIHtcblx0XHRvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblx0XHQvLyBjb25zb2xlLmxvZygnQ3JlYXRpbmcgcnBjIGNvbW1hbmQgWyVzXSBmb3IgZW5kcG9pbnQgWyVzXVslc10nLG5hbWUsIGVuZHBvaW50LmxhYmVsLCBlbmRwb2ludC5kaXIpO1xuXHRcdHRoaXMubmFtZSA9IG5hbWU7XG5cdFx0dGhpcy5lbmRwb2ludCA9IGVuZHBvaW50O1xuXHRcdHRoaXMucmVxdWVzdEhhbmRsZXJzID0gW107XG5cdFx0dGhpcy5yZXNwb25zZUhhbmRsZXJzID0ge307XG5cdFx0dGhpcy5vblByb3ZpZGVGbiA9IG51bGw7XG5cdFx0dGhpcy5lbmRwb2ludC5jb21tYW5kc1tuYW1lXSA9IHRoaXM7XG5cblx0XHR0aGlzLmxvZ2dlciA9IG9wdGlvbnMubG9nZ2VyLmNoaWxkKCdDTUQ6Jyt0aGlzLm5hbWUpO1xuXHRcdHRoaXMuc2VuZExvZ2dlciA9IHRoaXMubG9nZ2VyLmNoaWxkKCdzZW5kJyk7XG5cdFx0dGhpcy5yZWN2TG9nZ2VyID0gdGhpcy5sb2dnZXIuY2hpbGQoJ3JlY3YnKTtcblx0XHR0aGlzLmxvZ2dlci5lbmFibGVkICYmIHRoaXMubG9nZ2VyLmxvZygnQ3JlYXRlZCBuZXcgY29tbWFuZCBhcyAnLCBuYW1lKTtcblxuXHRcdHRoaXMuTUVTU0FHRVRZUEVTID0gTUVTU0FHRVRZUEVTO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9O1xuXG5cblx0cnBjQ29tbWFuZC5wcm90b3R5cGUuYXV0b0lEID0gZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKCkuc3Vic3RyKDgpICsgJy0nICsgRGF0ZS5ub3coKTtcblx0fTtcblxuXHRycGNDb21tYW5kLnByb3RvdHlwZS5zZW5kVG9JRCA9IGZ1bmN0aW9uKHRpZCwgbXNnLCBtb2RlKXtcblx0XHR2YXIgX3NlbGYgPSB0aGlzO1xuXHRcdHZhciB0TmFtZSA9IF9zZWxmLmVuZHBvaW50LnRyYW5zcG9ydHNbdGlkXS50TmFtZTtcblx0XHRtc2cuc291cmNlID0gX3NlbGYuZW5kcG9pbnQubGFiZWw7XG5cdFx0X3NlbGYuc2VuZExvZ2dlci5lbmFibGVkICYmIF9zZWxmLnNlbmRMb2dnZXIubG9nKCdTZW5kaW5nIG9uIHRyYW5zcG9ydCBbJXNdWyVzXSwgbW9kZSA9ICVzLCAgbXNnID0nLCB0aWQsdE5hbWUsbW9kZSxtc2cpO1xuXG5cdFx0aWYgKCFtb2RlIHx8IG1vZGUgIT0gJ3Jlc3BvbmQnKSB7XG5cblx0XHRcdHJldHVybiBuZXcgUHJvbWlzZSgocmVzLCByZWopID0+IHtcblxuXHRcdFx0XHR2YXIgc2VudCA9IGZhbHNlO1xuXG5cdFx0XHRcdC8vIGhhbmRsZXIgZnVuY3Rpb25cblx0XHRcdFx0dmFyIGhhbmRsZXIgPSBmdW5jdGlvbiAocmVzcERhdGEsIG1zZ1R5cGUpIHtcblx0XHRcdFx0XHRfc2VsZi5zZW5kTG9nZ2VyLmVuYWJsZWQgJiYgX3NlbGYuc2VuZExvZ2dlci5sb2coJ1xcblxcblJlc3BvbnNlIGhhbmRsZXIgY2FsbGVkIHdpdGggcmVzcERhdGEgJiBtc2dUeXBlcyBhcyBcXG4nLHJlc3BEYXRhLCBtc2dUeXBlKTtcblxuXHRcdFx0XHRcdGRlbGV0ZSBfc2VsZi5yZXNwb25zZUhhbmRsZXJzW3RpZF1bbXNnLm1zZ0lEXTtcblxuXHRcdFx0XHRcdHN3aXRjaCAobXNnVHlwZSkge1xuXG5cdFx0XHRcdFx0Y2FzZSBNRVNTQUdFVFlQRVMucmVzcG9uc2VBY2NlcHQ6XG5cdFx0XHRcdFx0XHRyZXMoe1xuXHRcdFx0XHRcdFx0XHRzZW50OiBzZW50LFxuXHRcdFx0XHRcdFx0XHRzdGF0dXM6IHRydWUsXG5cdFx0XHRcdFx0XHRcdHRyYW5zcG9ydDogdE5hbWUsXG5cdFx0XHRcdFx0XHRcdGNvbW1hbmQ6IF9zZWxmLm5hbWUsXG5cdFx0XHRcdFx0XHRcdHJlc3BvbnNlOiByZXNwRGF0YVxuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGNhc2UgTUVTU0FHRVRZUEVTLnJlc3BvbnNlRmFpbDpcblx0XHRcdFx0XHRcdHJlcyh7XG5cdFx0XHRcdFx0XHRcdHNlbnQ6IHNlbnQsXG5cdFx0XHRcdFx0XHRcdHN0YXR1czogZmFsc2UsXG5cdFx0XHRcdFx0XHRcdHRyYW5zcG9ydDogdE5hbWUsXG5cdFx0XHRcdFx0XHRcdGNvbW1hbmQ6IF9zZWxmLm5hbWUsXG5cdFx0XHRcdFx0XHRcdHJlc3BvbnNlOiByZXNwRGF0YVxuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fTtcblxuXG5cdFx0XHRcdGlmICghX3NlbGYucmVzcG9uc2VIYW5kbGVyc1t0aWRdKVxuXHRcdFx0XHRcdF9zZWxmLnJlc3BvbnNlSGFuZGxlcnNbdGlkXSA9IHt9O1xuXG5cdFx0XHRcdF9zZWxmLnJlc3BvbnNlSGFuZGxlcnNbdGlkXVttc2cubXNnSURdID0gaGFuZGxlcjtcblxuXG5cdFx0XHRcdHZhciBjb250YWluZXIgPSB7XG5cdFx0XHRcdFx0cnBjX21zZzoge30sXG5cdFx0XHRcdFx0cnBjX2RpcjogX3NlbGYuZW5kcG9pbnQuZGlyXG5cdFx0XHRcdH07XG5cdFx0XHRcdGNvbnRhaW5lci5ycGNfbXNnW19zZWxmLm5hbWVdID0gbXNnO1xuXG5cdFx0XHRcdF9zZWxmLnNlbmRMb2dnZXIuZW5hYmxlZCAmJiBfc2VsZi5zZW5kTG9nZ2VyLmxvZygnXFxuXFxuXFxuU2VuZGluZyAlcyB0byBbJXNdIGFzIFxcbicsbW9kZSA9PSdyZXNwb25kJz8ncmVzcG9uc2UnOidyZXF1ZXN0JywgdE5hbWUsIGNvbnRhaW5lcik7XG5cdFx0XHRcdFByb21pc2UucmVzb2x2ZShfc2VsZi5lbmRwb2ludC50cmFuc3BvcnRzW3RpZF0uc2VuZChjb250YWluZXIpKVxuXHRcdFx0XHRcdC50aGVuKChzKSA9PiBzZW50ID0gdHJ1ZSlcblx0XHRcdFx0XHQuY2F0Y2goKGUpID0+IHtcblx0XHRcdFx0XHRcdHNlbnQgPSBmYWxzZTtcblx0XHRcdFx0XHRcdGhhbmRsZXIoZSwgTUVTU0FHRVRZUEVTLnJlc3BvbnNlRmFpbCk7XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdH0pO1xuXHRcdH1cblx0XHRlbHNle1xuXG5cdFx0XHR2YXIgY29udGFpbmVyID0ge1xuXHRcdFx0XHRycGNfbXNnOiB7fSxcblx0XHRcdFx0cnBjX2RpcjogX3NlbGYuZW5kcG9pbnQuZGlyXG5cdFx0XHR9O1xuXHRcdFx0Y29udGFpbmVyLnJwY19tc2dbX3NlbGYubmFtZV0gPSBtc2c7XG5cblx0XHRcdF9zZWxmLnNlbmRMb2dnZXIuZW5hYmxlZCAmJiBfc2VsZi5zZW5kTG9nZ2VyLmxvZygnXFxuXFxuXFxuU2VuZGluZyAlcyB0byBbJXNdIGFzIFxcbicsbW9kZSA9PSdyZXNwb25kJz8ncmVzcG9uc2UnOidyZXF1ZXN0JywgdE5hbWUsIGNvbnRhaW5lcik7XG5cdFx0XHRyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKF9zZWxmLmVuZHBvaW50LnRyYW5zcG9ydHNbdGlkXS5zZW5kKGNvbnRhaW5lcikpO1xuXHRcdH1cblx0fTtcblxuXHRycGNDb21tYW5kLnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKG5hbWVzcGFjZSwgZGF0YSwgbW9kZSkge1xuXHRcdHZhciBfc2VsZiA9IHRoaXM7XG5cdFx0dmFyIHROYW1lO1xuXHRcdG5hbWVzcGFjZSA9IG5ldyBOYW1lc3BhY2UobmFtZXNwYWNlKTtcblx0XHR2YXIgdGFza3MgPSBbXTtcblxuXHRcdHZhciBtc2cgPSB7XG5cdFx0XHRtc2dJRDogX3NlbGYuYXV0b0lEKCksXG5cdFx0XHRtc2dUeXBlOiBNRVNTQUdFVFlQRVMucmVxdWVzdCxcblx0XHRcdHJlcURhdGE6IGRhdGEsXG5cdFx0fTtcblxuXHRcdE9iamVjdC5rZXlzKF9zZWxmLmVuZHBvaW50LnRyYW5zcG9ydHMpXG5cdFx0XHQuZm9yRWFjaChmdW5jdGlvbih0aWQpe1xuXHRcdFx0XHRfc2VsZi5zZW5kTG9nZ2VyLmVuYWJsZWQgJiYgX3NlbGYuc2VuZExvZ2dlci5sb2coJ1NjYW5uaW5nIGZvciBuYW1lc3BhY2Ugb24gdHJhbnNwb3J0IFslc10gYXMgXFxuJywgdGlkKTtcblxuXHRcdFx0XHR0TmFtZSA9IF9zZWxmLmVuZHBvaW50LnRyYW5zcG9ydHNbdGlkXS50TmFtZTtcblx0XHRcdFx0aWYgKF9zZWxmLmVuZHBvaW50LnRyYW5zcG9ydHNbdGlkXS5pbml0aWFsaXNlZCA9PT0gdHJ1ZSAmJiBuYW1lc3BhY2UudGVzdCh0TmFtZSkpIHtcblx0XHRcdFx0XHRfc2VsZi5zZW5kTG9nZ2VyLmVuYWJsZWQgJiYgX3NlbGYuc2VuZExvZ2dlci5sb2coJ1RyYW5zcG9ydCBbJXNdIGlzIHZhbGlkLiBBdHRlbXB0aW5nIHRvIHNlbmQnLCB0aWQpO1xuXHRcdFx0XHRcdHRhc2tzLnB1c2goX3NlbGYuc2VuZFRvSUQodGlkLCBtc2csIG1vZGUpKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRpZiAodGFza3MubGVuZ3RoID4gMClcblx0XHRcdHJldHVybiBQcm9taXNlLmFsbCh0YXNrcyk7XG5cdFx0ZWxzZVxuXHRcdFx0cmV0dXJuIFByb21pc2UucmVzb2x2ZShbe1xuXHRcdFx0XHRzZW50OiBmYWxzZSxcblx0XHRcdFx0c3RhdHVzOiBmYWxzZSxcblx0XHRcdFx0dHJhbnNwb3J0OiAnJyxcblx0XHRcdFx0Y29tbWFuZDogX3NlbGYubmFtZSxcblx0XHRcdFx0cmVzcG9uc2U6ICdubyB0cmFuc3BvcnRzIGFkZGVkJ1xuXHRcdFx0fV0pO1xuXHR9O1xuXG5cdC8vIHJwY0NvbW1hbmQucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiAobmFtZXNwYWNlU3RyaW5nLCBkYXRhKSB7XG5cdC8vIFx0dmFyIF9zZWxmID0gdGhpcztcblx0Ly9cblx0Ly8gXHR2YXIgbXNnID0ge1xuXHQvLyBcdFx0bXNnSUQ6IF9zZWxmLmF1dG9JRCgpLFxuXHQvLyBcdFx0bXNnVHlwZTogTUVTU0FHRVRZUEVTLnJlcXVlc3QsXG5cdC8vIFx0XHRyZXFEYXRhOiBkYXRhLFxuXHQvLyBcdH07XG5cdC8vXG5cdC8vXG5cdC8vIFx0X3NlbGYuc2VuZExvZ2dlci5lbmFibGVkICYmIF9zZWxmLnNlbmRMb2dnZXIubG9nKCdSZXF1ZXN0aW5nIFJQQyB3aXRoIG1zZyA9ICcsIG1zZyk7XG5cdC8vIFx0cmV0dXJuIF9zZWxmLnNlbmQobmFtZXNwYWNlU3RyaW5nLCBtc2cpO1xuXHQvL1xuXHQvLyB9O1xuXG5cblx0cnBjQ29tbWFuZC5wcm90b3R5cGUucmVjaWV2ZSA9IGZ1bmN0aW9uIChtc2csIHRyYW5zcG9ydCkge1xuXHRcdHZhciBfc2VsZiA9IHRoaXM7XG5cdFx0dmFyIHROYW1lID0gdHJhbnNwb3J0LnROYW1lLCB0aWQgPSB0cmFuc3BvcnQuaWQ7XG5cblx0XHRfc2VsZi5yZWN2TG9nZ2VyLmVuYWJsZWQgJiYgX3NlbGYucmVjdkxvZ2dlci5sb2coJ1xcblxcblxcbkNvbW1hbmQgWyVzXSBEYXRhIHJlY3ZkIG9uIFslc11bJXNdIGFzIFxcbicsX3NlbGYubmFtZSwgX3NlbGYuZW5kcG9pbnQubGFiZWwsX3NlbGYuZW5kcG9pbnQuZGlyLHROYW1lLCBtc2cpO1xuXG5cdFx0c3dpdGNoIChtc2cubXNnVHlwZSkge1xuXHRcdGNhc2UgTUVTU0FHRVRZUEVTLnJlc3BvbnNlQWNjZXB0OlxuXHRcdGNhc2UgTUVTU0FHRVRZUEVTLnJlc3BvbnNlRmFpbDpcblx0XHRcdC8vIGNvbnNvbGUubG9nKCdcXG5cXG5cXG5SZXNwb25zZSByZWN2ZCBvbiBbJXNdIGZyb20gWyVzXSBhc1xcbiAnLHROYW1lLCBtc2cucnROYW1lLCBtc2cpO1xuXHRcdFx0aWYgKF9zZWxmLnJlc3BvbnNlSGFuZGxlcnNbdGlkXSAmJiBfc2VsZi5yZXNwb25zZUhhbmRsZXJzW3RpZF1bbXNnLnJlc3BJRF0pIHtcblx0XHRcdFx0Ly8gY29uc29sZS5sb2coJ2hhbmRsZXIgZm91bmQuIFJlc3BvbmRpbmcgIScpO1xuXHRcdFx0XHRfc2VsZi5yZXNwb25zZUhhbmRsZXJzW3RpZF1bbXNnLnJlc3BJRF0obXNnLnJlc3BEYXRhLCBtc2cubXNnVHlwZSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBjb25zb2xlLmxvZygnaGFuZGxlciBub3QgZm91bmQnKTtcblx0XHRcdH1cblx0XHRcdGJyZWFrO1xuXG5cdFx0Y2FzZSBNRVNTQUdFVFlQRVMucmVxdWVzdDpcblx0XHRcdC8vIGNvbnNvbGUgLmxvZygnXFxuXFxuQ29tbWFuZFslc10gUmVxdWVzdCByZWN2ZCBvbiBbJXNdIGFzXFxuICcsX3NlbGYubmFtZSwgdE5hbWUsbXNnKTtcblxuXHRcdFx0aWYgKF9zZWxmLnJlcXVlc3RIYW5kbGVycy5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdC8vIGNvbnNvbGUubG9nKCdcXG5bJXNdUmVxdWVzdCBoYW5kbGVycyBmb3VuZFxcbiAnLF9zZWxmLnJlcXVlc3RIYW5kbGVycy5sZW5ndGgpO1xuXG5cdFx0XHRcdHZhciBjaGFpbiA9IFByb21pc2UucmVzb2x2ZSgpO1xuXHRcdFx0XHR2YXIgcmVxRGF0YSA9IG1zZy5yZXFEYXRhO1xuXG5cdFx0XHRcdF9zZWxmLnJlcXVlc3RIYW5kbGVycy5mb3JFYWNoKChoKSA9PiB7XG5cdFx0XHRcdFx0LyogRWFjaCBoYW5kbGVyIGlzIGNhbGxlZCB3aXRoICh2LHAsbCxzKSBhcyBmb2xsb3dzXG5cdFx0XHRcdFx0XHR2XHQ9IHJlcURhdGEgXHQtIGRhdGEgc2VudCBieSBjYWxsZXIsXG5cdFx0XHRcdFx0XHRwXHQ9IHByZXZcdFx0LSByZXNwb25zZSBnb3QgZnJvbSB0aGUgcHJldmhhbmRsZXIncyBleGVjdXRpb24gZm9yIHRoaXMgY2FsbCxcblx0XHRcdFx0XHRcdGxcdD0gdE5hbWUgXHRcdC0gbmFtZSBvZiBjdXJyZW50IHRyYW5zcG9ydCAoVE9ETyAtIGJ1Z2d5LCBwb2ludHMgdG8gbG9jYWwgdHJhbnNwb3J0IG5hbWUpXG5cdFx0XHRcdFx0XHRzIFx0PSBtc2cudE5hbWUgXHQtIG5hbWUgb2YgdGhlIGNhbGxpbmcgdHJhbnNwb3J0ICh0aGlzIHdhcyB0aGUgYWN0dWFsIHVzZWNhc2UgZm9yIHROYW1lID8pXG5cdFx0XHRcdFx0Ki9cblx0XHRcdFx0XHRjaGFpbiA9IGNoYWluLnRoZW4oKHByZXYpID0+IGgobXNnLnJlcURhdGEsIHByZXYsIHROYW1lLCBtc2cudE5hbWUpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHRcdHJldHVybiBjaGFpblxuXHRcdFx0XHRcdC50aGVuKChyZXNwRGF0YSkgPT4ge1xuXHRcdFx0XHRcdFx0Ly8gY29uc29sZS5sb2coJ1xcblJlcXVlc3QgaGFuZGxlcnMgU1VDQ0VTU1xcbiBSZXN1bHRzIGFyZScscmVzcERhdGEpO1xuXG5cdFx0XHRcdFx0XHRtc2cucmVzcElEID0gbXNnLm1zZ0lEO1xuXHRcdFx0XHRcdFx0bXNnLnJ0TmFtZSA9IHROYW1lO1xuXHRcdFx0XHRcdFx0bXNnLm1zZ0lEID0gX3NlbGYuYXV0b0lEKCk7XG5cdFx0XHRcdFx0XHRtc2cubXNnVHlwZSA9IE1FU1NBR0VUWVBFUy5yZXNwb25zZUFjY2VwdDtcblx0XHRcdFx0XHRcdG1zZy5yZXNwRGF0YSA9IHJlc3BEYXRhO1xuXHRcdFx0XHRcdFx0ZGVsZXRlIG1zZy5yZXFEYXRhO1xuXHRcdFx0XHRcdFx0cmV0dXJuIF9zZWxmLnNlbmRUb0lEKHRpZCwgbXNnLCAncmVzcG9uZCcpO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0LmNhdGNoKChlKSA9PiB7XG5cdFx0XHRcdFx0XHQvLyBjb25zb2xlLmxvZygnXFxuUmVxdWVzdCBoYW5kbGVycyBGQUlMRURcXG4gUmVzdWx0cyBhcmUnLGUpO1xuXG5cdFx0XHRcdFx0XHRtc2cucmVzcElEID0gbXNnLm1zZ0lEO1xuXHRcdFx0XHRcdFx0bXNnLnJ0TmFtZSA9IHROYW1lO1xuXHRcdFx0XHRcdFx0bXNnLm1zZ0lEID0gX3NlbGYuYXV0b0lEKCk7XG5cdFx0XHRcdFx0XHRtc2cubXNnVHlwZSA9IE1FU1NBR0VUWVBFUy5yZXNwb25zZUZhaWw7XG5cdFx0XHRcdFx0XHRtc2cucmVzcERhdGEgPSBlO1xuXHRcdFx0XHRcdFx0ZGVsZXRlIG1zZy5yZXFEYXRhO1xuXHRcdFx0XHRcdFx0cmV0dXJuIF9zZWxmLnNlbmRUb0lEKHRpZCwgbXNnLCAncmVzcG9uZCcpO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0LnRoZW4oKCkgPT4gX3NlbGYub25Qcm92aWRlRm4gPyBfc2VsZi5vblByb3ZpZGVGbihyZXFEYXRhLCBtc2cucmVzcERhdGEsIHROYW1lLCBtc2cpIDogbnVsbClcblx0XHRcdFx0XHQuY2F0Y2goKGUpID0+IHtcblx0XHRcdFx0XHRcdGNvbnNvbGUuZXJyb3IoJ1VuZXhwZWN0ZWQgRXJyb3Igd2hpbGUgZXhlY3V0aW5nIG9uUHJvdmlkZSBmdW5jdGlvbiAtICcsIGUpO1xuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBfc2VsZi5yZWN2TG9nZ2VyLmVuYWJsZWQgJiYgX3NlbGYucmVjdkxvZ2dlci5lcnJvcignRVJST1IgLSBObyByZXF1ZXN0SGFuZGxlcnMgZm9yIGNvbW1hbmRbJXNdIG9uIFslc11bJXNdIC0gIHROYW1lLCBtc2cgLSAnLCBfc2VsZi5uYW1lLCBfc2VsZi5lbmRwb2ludC5sYWJlbCwgX3NlbGYuZW5kcG9pbnQuZGlyLCB0TmFtZSwgbXNnKTtcblx0XHRcdFx0bXNnLnJlc3BJRCA9IG1zZy5tc2dJRDtcblx0XHRcdFx0bXNnLnJ0TmFtZSA9IHROYW1lO1xuXHRcdFx0XHRtc2cubXNnSUQgPSBfc2VsZi5hdXRvSUQoKTtcblx0XHRcdFx0bXNnLm1zZ1R5cGUgPSBNRVNTQUdFVFlQRVMucmVzcG9uc2VGYWlsO1xuXHRcdFx0XHRtc2cucmVzcERhdGEgPSAnbm8gcHJvdmlkZXJzJztcblx0XHRcdFx0ZGVsZXRlIG1zZy5yZXFEYXRhO1xuXHRcdFx0XHRyZXR1cm4gX3NlbGYuc2VuZFRvSUQodGlkLCBtc2csICdyZXNwb25kJyk7XG5cblx0XHRcdH1cblx0XHRcdGJyZWFrO1xuXHRcdH1cblx0fTtcblxuXHRycGNDb21tYW5kLnByb3RvdHlwZS5wcm92aWRlID0gZnVuY3Rpb24gKGZuKSB7XG5cdFx0aWYgKHR5cGVvZiBmbiA9PSBcImZ1bmN0aW9uXCIpXG5cdFx0XHR0aGlzLnJlcXVlc3RIYW5kbGVycy5wdXNoKGZuKTtcblx0XHRlbHNlIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcignUGFyYW0gcGFzc2VkIHRvIFwicHJvdmlkZVwiIGlzIG5vdCBhIGZ1bmN0aW9uJyk7XG5cdFx0fVxuXHR9O1xuXG5cdHJwY0NvbW1hbmQucHJvdG90eXBlLnVuUHJvdmlkZSA9IGZ1bmN0aW9uIChmbikge1xuXHRcdHZhciBpbmRleCA9IHRoaXMucmVxdWVzdEhhbmRsZXJzLmZpbmRJbmRleCgoeCkgPT4geCA9PT0gZm4pO1xuXHRcdGlmIChpbmRleCA+IC0xKVxuXHRcdFx0dGhpcy5yZXF1ZXN0SGFuZGxlcnMuc3BsaWNlKGhhbmRsZXJJbmRleCwgMSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH07XG5cblx0Lypcblx0XHRFeGVjdXRlcyBwYXNzZWQgZm4gd2hlbiBwcm92aWRlIHJlc3BvbnNlIGlzIHN1Y2Nlc3NmdWxseSByZWNpZXZlZCBieSByZW1vdGUuXG5cdFx0XHRBc3N1bWluZyB0cmFuc3BvcnQgc2VuZCgpIGZ1bmN0aW9uIHJldHVybnMgYSBwcm9taXNlIG9uIHN1Y2Nlc3NmdWxsXG5cdFx0XHR0cmFuc2ZlciBvZiByZXNwb25zZSBtZXNzYWdlXG5cdCovXG5cdHJwY0NvbW1hbmQucHJvdG90eXBlLm9uUHJvdmlkZSA9IGZ1bmN0aW9uIChmbikge1xuXHRcdGlmICh0eXBlb2YgZm4gPT0gXCJmdW5jdGlvblwiKVxuXHRcdFx0dGhpcy5vblByb3ZpZGVGbiA9IGZuO1xuXHRcdGVsc2Uge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCdQYXJhbSBwYXNzZWQgdG8gXCJvblByb3ZpZGVGblwiIGlzIG5vdCBhIGZ1bmN0aW9uJyk7XG5cdFx0fVxuXHR9O1xuXG5cblxuXHQvKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5cblx0bW9kdWxlLmV4cG9ydHMgPSBycGNDb21tYW5kO1xuXG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcblxuXHRjb25zdCBOYW1lc3BhY2UgPSByZXF1aXJlKCcuL25hbWVzcGFjZS5qcycpO1xuXHRjb25zdCBycGNTdG9ja1RyYW5zcG9ydHMgPSByZXF1aXJlKCcuL3N0b2NrVHJhbnNwb3J0cy5qcycpO1xuXHRjb25zdCBycGNUcmFuc3BvcnQgPSByZXF1aXJlKCcuL3JwY1RyYW5zcG9ydC5qcycpO1xuXHRjb25zdCBycGNDb21tYW5kID0gcmVxdWlyZSgnLi9ycGNDb21tYW5kLmpzJyk7XG5cdC8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cblxuXHR2YXIgcnBjRW5kcG9pbnQgPSBmdW5jdGlvbiAobCwgZGlyLCBvcHRpb25zKSB7XG5cdFx0b3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG5cdFx0dGhpcy5sb2dnZXIgPSBvcHRpb25zLmxvZ2dlci5jaGlsZChkaXIgPT0gJ2knPydFUDppbic6J0VQOm91dCcpO1xuXG5cblx0XHR0aGlzLnRyYW5zcG9ydHMgPSB7fTtcblx0XHR0aGlzLmxhYmVsID0gbDtcblx0XHR0aGlzLmRpciA9IGRpcjtcblx0XHR0aGlzLmNvbW1hbmRzID0ge307XG5cdFx0dGhpcy50cmFuc3BvcnRUeXBlcyA9IHJwY1N0b2NrVHJhbnNwb3J0cztcblxuXHRcdHRoaXMubG9nZ2VyLmVuYWJsZWQgJiYgdGhpcy5sb2dnZXIubG9nKCdDcmVhdGVkIG5ldyBlbmRwb2ludCBhcyBbJXNdWyVzXScsIGwsZGlyKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9O1xuXG5cdHJwY0VuZHBvaW50LnByb3RvdHlwZS5wbHVnaW5UcmFuc3BvcnRzID0gZnVuY3Rpb24gKHRDb2xsKSB7XG5cdFx0dGhpcy50cmFuc3BvcnRUeXBlcyA9IE9iamVjdC5hc3NpZ24odHJhbnNwb3J0VHlwZXMsIHRDb2xsKTtcblx0fTtcblxuXHRycGNFbmRwb2ludC5wcm90b3R5cGUub3ZlciA9IGZ1bmN0aW9uIChzb2NrZXQsIHR5cGUpIHtcblx0XHRyZXR1cm4gbmV3IHJwY1RyYW5zcG9ydCh0eXBlLCBzb2NrZXQsIHRoaXMsIHtsb2dnZXI6dGhpcy5sb2dnZXJ9KTtcblx0fTtcblx0cnBjRW5kcG9pbnQucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uIChzb2NrZXQpIHtcblx0XHR2YXIgX3NlbGYgPSB0aGlzO1xuXHRcdE9iamVjdC5rZXlzKF9zZWxmLnRyYW5zcG9ydHMpLmZvckVhY2goKHRpZCk9Pntcblx0XHRcdGlmKF9zZWxmLnRyYW5zcG9ydHNbdGlkXS5zb2NrZXQgPT09IHNvY2tldClcblx0XHRcdFx0ZGVsZXRlIF9zZWxmLnRyYW5zcG9ydHNbdGlkXTtcblx0XHR9KTtcblx0fTtcblxuXHRycGNFbmRwb2ludC5wcm90b3R5cGUucmVuYW1lID0gZnVuY3Rpb24gKG5hbWVzcGFjZSkge1xuXHRcdHZhciBfc2VsZiA9IHRoaXM7XG5cdFx0bmFtZXNwYWNlID0gbmV3IE5hbWVzcGFjZShuYW1lc3BhY2UpO1xuXHRcdHJldHVybiB7XG5cdFx0XHRhczogKG5ld05hbWUpID0+IHtcblx0XHRcdFx0X3NlbGYubGFiZWwgPSBuZXdOYW1lO1xuXHRcdFx0XHRPYmplY3Qua2V5cyhfc2VsZi50cmFuc3BvcnRzKS5mb3JFYWNoKCh0TmFtZSkgPT4ge1xuXHRcdFx0XHRcdGlmIChuYW1lc3BhY2UudGVzdCh0TmFtZSkpIHtcblx0XHRcdFx0XHRcdF9zZWxmLnRyYW5zcG9ydHNbdE5hbWVdLmFzKG5ld05hbWUpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHRcdHJldHVybiB0aGlzO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRycGNFbmRwb2ludC5wcm90b3R5cGUuZGlzcGxheVN0cmluZyA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgX3NlbGYgPSB0aGlzO1xuXHRcdHZhciBsb2dTdHJpbmcgPSAna2V5XFx0XFx0XFx0bmFtZVxcdFxcdFxcdHR5cGU6aWRcXHRcXHRcXHRpbml0YWxpc2VkXFxuJztcblx0XHRPYmplY3Qua2V5cyhfc2VsZi50cmFuc3BvcnRzKS5mb3JFYWNoKCh0S2V5KSA9PiB7XG5cdFx0XHRsb2dTdHJpbmcrPWAke3RLZXl9XFx0XFx0JHtfc2VsZi50cmFuc3BvcnRzW3RLZXldLnROYW1lfVxcdFxcdCR7X3NlbGYudHJhbnNwb3J0c1t0S2V5XS50eXBlICsnOicrX3NlbGYudHJhbnNwb3J0c1t0S2V5XS5pZH1cXHRcXHQke19zZWxmLnRyYW5zcG9ydHNbdEtleV0uaW5pdGlhbGlzZWR9XFxuYDtcblx0XHR9KTtcblx0XHRyZXR1cm4gbG9nU3RyaW5nO1xuXHR9O1xuXG5cdHJwY0VuZHBvaW50LnByb3RvdHlwZS5jb21tYW5kID0gZnVuY3Rpb24gKG5hbWUpIHtcblx0XHRyZXR1cm4gbmV3IHJwY0NvbW1hbmQobmFtZSwgdGhpcywge2xvZ2dlcjp0aGlzLmxvZ2dlcn0pO1xuXHR9O1xuXG5cblx0LyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuXG5cdG1vZHVsZS5leHBvcnRzID0gcnBjRW5kcG9pbnQ7XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuXHR2YXIgaWRDb3VudCA9IDA7XG5cdHZhciBhdXRvSUQgPSBmdW5jdGlvbigpe1xuXHRcdHJldHVybiAnVCcrICgrK2lkQ291bnQpO1xuXHR9O1xuXG5cdHZhciBycGNUcmFuc3BvcnQgPSBmdW5jdGlvbiAodHlwZSwgc29ja2V0LCBlbmRwb2ludCwgb3B0aW9ucykge1xuXHRcdC8vIGNvbnNvbGUubG9nKCdDcmVhdGluZyBycGMgdHJhbnNwb3J0IFslc10gZm9yIGVuZHBvaW50IFslc11bJXNdJyx0eXBlLCBlbmRwb2ludC5sYWJlbCwgZW5kcG9pbnQuZGlyKTtcblx0XHRvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblx0XHR2YXIgX3NlbGYgPSB0aGlzO1xuXG5cdFx0X3NlbGYuaWQgPSBhdXRvSUQoKTtcblx0XHRfc2VsZi5sb2dnZXIgPSBvcHRpb25zLmxvZ2dlci5jaGlsZCgnVDonK3R5cGUrJzonK19zZWxmLmlkKTtcblxuXHRcdF9zZWxmLmVuZHBvaW50ID0gZW5kcG9pbnQ7XG5cdFx0X3NlbGYudHlwZSA9IHR5cGU7XG5cdFx0X3NlbGYuc29ja2V0ID0gc29ja2V0O1x0Ly8gQWxzbyB1c2VkIGZvciBtYXRjaGluZyAmIHJlbW92YWwsIGJlc2lkZXMgaW50ZXJuYWwgc29ja2V0IGFjY2Vzcy5cblx0XHRfc2VsZi50TmFtZSA9ICdub25uYW1lJztcblx0XHRfc2VsZi5pbml0aWFsaXNlZCA9IGZhbHNlO1xuXHRcdF9zZWxmLm5hbWVDbG9jayA9IDA7XG5cdFx0X3NlbGYuZGlyRmxpcCA9IHtcblx0XHRcdGk6ICdvJyxcblx0XHRcdG86ICdpJ1xuXHRcdH07XG5cblx0XHQvLyBBZGQgdHJhc3BvcnQgdHlwZSBzcGVjaWZpYyBtZXRob2RzIHRvIHNlbGZcblx0XHRPYmplY3QuYXNzaWduKF9zZWxmLCBfc2VsZi5lbmRwb2ludC50cmFuc3BvcnRUeXBlc1t0eXBlXSh0eXBlLCBzb2NrZXQpKTtcblxuXHRcdF9zZWxmLmluaXRQcm9taXNlID0gbmV3IFByb21pc2UoKHJlcyxyZWopPT57XG5cdFx0XHRfc2VsZi5vblJlY3YoKGRhdGEpID0+IHtcblx0XHRcdFx0Ly8gY29uc29sZS5sb2coJ1tvblJlY3ZdIERhdGEgcmVjdmQgb24gWyVzXVslc10nLF9zZWxmLnROYW1lLF9zZWxmLmVuZHBvaW50LmRpciwgZGF0YSk7XG5cdFx0XHRcdGlmIChkYXRhLnJwY19kaXIgPT0gX3NlbGYuZGlyRmxpcFtfc2VsZi5lbmRwb2ludC5kaXJdKSB7XG5cdFx0XHRcdFx0Ly8gY29uc29sZS5sb2coJ1tvblJlY3ZdIERhdGEgYWNjZXB0ZWQgb24gWyVzXVslc10nLF9zZWxmLnROYW1lLF9zZWxmLmVuZHBvaW50LmRpciwgZGF0YSk7XG5cblx0XHRcdFx0XHRpZiAoZGF0YS5ycGNfdE5hbWVfY2hhbmdlKSB7XG5cdFx0XHRcdFx0XHQvKlxuXHRcdFx0XHRcdFx0XHROT1RFIC0gSW1wbGVtZW50aW5nIFwiTGF0ZXN0ICYgbGFzdCB3cml0ZSB3aW5zXCIgY29uc2Vuc3VzIHBvbGljeSA6XG5cdFx0XHRcdFx0XHRcdFx0V0hZID8gLSBSZXF1aXJlZCB0byBzb2x2ZSBkaXNwdXRlcyB3aGVuIGJvdGgob3IgbW9yZSkgZW5kcG9pbnRzIHJlcXVlc3QgYSBuYW1lIGNoYW5nZSBhdCB0aGUgc2FtZSB0aW1lLlxuXHRcdFx0XHRcdFx0XHRcdFdpdGhvdXQgdGhpcywgYSBzaW11bHRhbmVvdXMgcmVxdWVzdCBjYXVzZXMgZWFjaCBvbmUgdG8gc2VuZHMgaGlzIG5hbWUgY2hhbmdlIG92ZXIgd2hpbGUgaW1wbGVtZW50aW5nIHRoZSBvdGhlcidzIG5hbWUgY2hhbmdlIHJlcXVlc3QuXG5cdFx0XHRcdFx0XHRcdFx0IFx0Y29uc2VxdWVuY2UgLSBhIG5hbWUgc3dhcCwgaW5zdGVhZCBvZiBjb25zZW5zdXMgb24gYSBzaW5nbGUgbmFtZSB2YWx1ZS5cblx0XHRcdFx0XHRcdCovXG5cdFx0XHRcdFx0XHRpZiAoZGF0YS5ycGNfdE5hbWVfY2hhbmdlLmZvcmNlIHx8IGRhdGEucnBjX3ROYW1lX2NoYW5nZS5jbG9jayA+PSBfc2VsZi5uYW1lQ2xvY2spIHtcblx0XHRcdFx0XHRcdFx0X3NlbGYubG9nZ2VyLmVuYWJsZWQgJiYgX3NlbGYubG9nZ2VyLmxvZygnWyVzLCBjbG9jayAlc10gWyVzXSBDaGFuZ2luZyBuYW1lIG9mIHRyYW5zcG9ydCBbJXNdWyVzXSB0byBbJXNdIGF0IGNsb2NrID0nLCBfc2VsZi5lbmRwb2ludC5sYWJlbCwgX3NlbGYubmFtZUNsb2NrLCBkYXRhLnJwY190TmFtZV9jaGFuZ2UuZm9yY2UgPyAnZm9yY2VkJyA6ICcnLCBfc2VsZi50TmFtZSxfc2VsZi5pZCwgZGF0YS5ycGNfdE5hbWVfY2hhbmdlLnROYW1lLCBkYXRhLnJwY190TmFtZV9jaGFuZ2UuY2xvY2spO1xuXHRcdFx0XHRcdFx0XHQvLyBkZWxldGUgX3NlbGYuZW5kcG9pbnQudHJhbnNwb3J0c1tfc2VsZi50TmFtZV07XG5cdFx0XHRcdFx0XHRcdF9zZWxmLnROYW1lID0gZGF0YS5ycGNfdE5hbWVfY2hhbmdlLnROYW1lO1xuXHRcdFx0XHRcdFx0XHRfc2VsZi5uYW1lQ2xvY2sgPSBkYXRhLnJwY190TmFtZV9jaGFuZ2UuY2xvY2s7XG5cdFx0XHRcdFx0XHRcdC8vIF9zZWxmLmVuZHBvaW50LnRyYW5zcG9ydHNbX3NlbGYudE5hbWVdID0gX3NlbGY7XG5cdFx0XHRcdFx0XHRcdGlmKCFfc2VsZi5pbml0aWFsaXNlZCkge1xuXHRcdFx0XHRcdFx0XHRcdF9zZWxmLmluaXRpYWxpc2VkID0gdHJ1ZTtcblx0XHRcdFx0XHRcdFx0XHRyZXMoKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0X3NlbGYubG9nZ2VyLmVuYWJsZWQgJiYgX3NlbGYubG9nZ2VyLmxvZygnWyVzLCBjbG9jayAlc10gWyVzXSBSZWplY3RpbmcgbmFtZSBjaGFuZ2Ugb2YgdHJhbnNwb3J0IFslc11bJXNdIGFzIFslc10gYXQgY2xvY2sgPScsX3NlbGYuZW5kcG9pbnQubGFiZWwsX3NlbGYubmFtZUNsb2NrLGRhdGEucnBjX3ROYW1lX2NoYW5nZS5mb3JjZT8nZm9yY2VkJzonJywgX3NlbGYudE5hbWUsX3NlbGYuaWQsIGRhdGEucnBjX3ROYW1lX2NoYW5nZS50TmFtZSxkYXRhLnJwY190TmFtZV9jaGFuZ2UuY2xvY2spO1xuXHRcdFx0XHRcdFx0XHRfc2VsZi5zZW5kKHtcblx0XHRcdFx0XHRcdFx0XHRycGNfdE5hbWVfY2hhbmdlOiB7XG5cdFx0XHRcdFx0XHRcdFx0XHR0TmFtZTogX3NlbGYudE5hbWUsXG5cdFx0XHRcdFx0XHRcdFx0XHRjbG9jazogX3NlbGYubmFtZUNsb2NrLFxuXHRcdFx0XHRcdFx0XHRcdFx0Zm9yY2U6IHRydWVcblx0XHRcdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0XHRcdHJwY19kaXI6IF9zZWxmLmVuZHBvaW50LmRpclxuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoZGF0YS5ycGNfbXNnKSB7XG5cdFx0XHRcdFx0XHRPYmplY3Qua2V5cyhkYXRhLnJwY19tc2cpLmZvckVhY2goKGNLZXkpID0+IHtcblx0XHRcdFx0XHRcdFx0aWYgKF9zZWxmLmVuZHBvaW50LmNvbW1hbmRzW2NLZXldKVxuXHRcdFx0XHRcdFx0XHRcdF9zZWxmLmVuZHBvaW50LmNvbW1hbmRzW2NLZXldLnJlY2lldmUoZGF0YS5ycGNfbXNnW2NLZXldLCBfc2VsZik7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRfc2VsZi5hcyA9IGZ1bmN0aW9uICh0TmFtZSkge1xuXHRcdFx0XHQvLyBkZWxldGUgX3NlbGYuZW5kcG9pbnQudHJhbnNwb3J0c1tfc2VsZi50TmFtZV07XG5cdFx0XHRcdHZhciBwcmV2TmFtZSA9IF9zZWxmLnROYW1lO1xuXHRcdFx0XHRfc2VsZi50TmFtZSA9IHROYW1lO1xuXHRcdFx0XHRfc2VsZi5uYW1lQ2xvY2srKztcblx0XHRcdFx0X3NlbGYubG9nZ2VyLmVuYWJsZWQgJiYgX3NlbGYubG9nZ2VyLmxvZygnWyVzXSBTZW5kaW5nIG5hbWVjaGFuZ2Ugb2YgdHJhbnNwb3J0IFslc11bJXNdIHRvIFslc10gYXQgY2xvY2sgPScsX3NlbGYuZW5kcG9pbnQubGFiZWwsIHByZXZOYW1lLHROYW1lLF9zZWxmLmlkLCBfc2VsZi5uYW1lQ2xvY2spO1xuXHRcdFx0XHRfc2VsZi5zZW5kKHtcblx0XHRcdFx0XHRycGNfdE5hbWVfY2hhbmdlOiB7XG5cdFx0XHRcdFx0XHR0TmFtZTogX3NlbGYudE5hbWUsXG5cdFx0XHRcdFx0XHRjbG9jazogX3NlbGYubmFtZUNsb2NrXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRycGNfZGlyOiBfc2VsZi5lbmRwb2ludC5kaXJcblx0XHRcdFx0fSk7XG5cdFx0XHRcdC8vIF9zZWxmLmVuZHBvaW50LnRyYW5zcG9ydHNbdE5hbWVdID0gX3NlbGY7XG5cdFx0XHRcdGlmKCFfc2VsZi5pbml0aWFsaXNlZCkge1xuXHRcdFx0XHRcdF9zZWxmLmluaXRpYWxpc2VkID0gdHJ1ZTtcblx0XHRcdFx0XHRyZXMoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gX3NlbGY7XG5cdFx0XHR9O1xuXHRcdH0pO1xuXG5cdFx0X3NlbGYuZW5kcG9pbnQudHJhbnNwb3J0c1tfc2VsZi5pZF0gPSBfc2VsZjtcblx0XHRfc2VsZi5sb2dnZXIuZW5hYmxlZCAmJiBfc2VsZi5sb2dnZXIubG9nKCdBZGRlZCB0cmFuc3BvcnQgWyVzXVslc10gZm9yIGVuZHBvaW50IFslc11bJXNdJyx0eXBlLF9zZWxmLmlkLCBlbmRwb2ludC5sYWJlbCwgZW5kcG9pbnQuZGlyKTtcblx0XHRyZXR1cm4gX3NlbGY7XG5cdH07XG5cblx0LyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuXG5cdG1vZHVsZS5leHBvcnRzID0gcnBjVHJhbnNwb3J0O1xuXG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcblxuXHR2YXIgdHJhbnNwb3J0VHlwZXMgPSB7fTtcblxuXHR0cmFuc3BvcnRUeXBlc1snc29ja2V0aW8nXSA9IGZ1bmN0aW9uICh0eXBlLCBzb2NrZXQpIHtcblx0XHRyZXR1cm4ge1xuXHRcdFx0c2VuZDogKGRhdGEpID0+IHNvY2tldC5zZW5kKEpTT04uc3RyaW5naWZ5KGRhdGEpKSxcblx0XHRcdG9uUmVjdjogKGZuKSA9PiBzb2NrZXQub24oJ21lc3NhZ2UnLCAoZGF0YSkgPT4gZm4oSlNPTi5wYXJzZShkYXRhKSkpXG5cdFx0fVxuXHR9O1xuXHR0cmFuc3BvcnRUeXBlc1snd2Vic29ja2V0J10gPSBmdW5jdGlvbiAodHlwZSwgc29ja2V0KSB7XG5cdFx0cmV0dXJuIHtcblx0XHRcdHNlbmQ6IChkYXRhKSA9PiB7XG5cdFx0XHRcdHJldHVybiBuZXcgUHJvbWlzZSgocmVzLCByZWopID0+IHtcblx0XHRcdFx0XHRzb2NrZXQuc2VuZChcblx0XHRcdFx0XHRcdEpTT04uc3RyaW5naWZ5KGRhdGEpLFxuXHRcdFx0XHRcdFx0KGUpID0+IGUgPyByZWooZSkgOiByZXMoKVxuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSxcblx0XHRcdG9uUmVjdjogKGZuKSA9PiBzb2NrZXQub24oJ21lc3NhZ2UnLCAoZGF0YSkgPT4gZm4oSlNPTi5wYXJzZShkYXRhKSkpXG5cdFx0fVxuXHR9O1xuXHR0cmFuc3BvcnRUeXBlc1sncHJvY2Vzc0xvY2FsJ10gPSBmdW5jdGlvbiAodHlwZSwgc29ja2V0KSB7XG5cdFx0cmV0dXJuIHtcblx0XHRcdHNlbmQ6IChkYXRhKSA9PiBzb2NrZXQuZW1pdCgnbWVzc2FnZScsIEpTT04uc3RyaW5naWZ5KGRhdGEpKSxcblx0XHRcdG9uUmVjdjogKGZuKSA9PiBzb2NrZXQub24oJ21lc3NhZ2UnLCAoZGF0YSkgPT4gZm4oSlNPTi5wYXJzZShkYXRhKSkpXG5cdFx0fVxuXHR9O1xuXHR0cmFuc3BvcnRUeXBlc1snbm9kZUVFTG9jYWwnXSA9IGZ1bmN0aW9uICh0eXBlLCBzb2NrZXQpIHtcblx0XHRyZXR1cm4ge1xuXHRcdFx0c2VuZDogKGRhdGEpID0+IHNvY2tldC5lbWl0KCdtZXNzYWdlJywgSlNPTi5zdHJpbmdpZnkoZGF0YSkpLFxuXHRcdFx0b25SZWN2OiAoZm4pID0+IHNvY2tldC5vbignbWVzc2FnZScsIChkYXRhKSA9PiBmbihKU09OLnBhcnNlKGRhdGEpKSlcblx0XHR9XG5cdH07XG5cdHRyYW5zcG9ydFR5cGVzWydwcm9jZXNzUmVtb3RlJ10gPSBmdW5jdGlvbiAodHlwZSwgc29ja2V0KSB7XG5cdFx0cmV0dXJuIHtcblx0XHRcdHNlbmQ6IChkYXRhKSA9PiBzb2NrZXQuc2VuZChKU09OLnN0cmluZ2lmeShkYXRhKSksXG5cdFx0XHRzZW5kOiAoZGF0YSkgPT4ge1xuXHRcdFx0XHRyZXR1cm4gbmV3IFByb21pc2UoKHJlcywgcmVqKSA9PiB7XG5cdFx0XHRcdFx0dmFyIHMgPSBzb2NrZXQuc2VuZChcblx0XHRcdFx0XHRcdEpTT04uc3RyaW5naWZ5KGRhdGEpLFxuXHRcdFx0XHRcdFx0KGUpID0+IGUgaW5zdGFuY2VvZiBFcnJvciA/IHJlaihlKSA6IChzID09PSB0cnVlPyByZXMocyk6cmVqKHMpKVxuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSxcblx0XHRcdG9uUmVjdjogKGZuKSA9PiBzb2NrZXQub24oJ21lc3NhZ2UnLCAoZGF0YSkgPT4gZm4oSlNPTi5wYXJzZShkYXRhKSkpXG5cdFx0fVxuXHR9O1xuXHR0cmFuc3BvcnRUeXBlc1snbm9kZUVFUmVtb3RlJ10gPSBmdW5jdGlvbiAodHlwZSwgc29ja2V0KSB7XG5cdFx0cmV0dXJuIHtcblx0XHRcdHNlbmQ6IChkYXRhKSA9PiBzb2NrZXQuc2VuZCgnbWVzc2FnZScsIEpTT04uc3RyaW5naWZ5KGRhdGEpKSxcblx0XHRcdG9uUmVjdjogKGZuKSA9PiBzb2NrZXQub24oJ21lc3NhZ2UnLCAoZGF0YSkgPT4gZm4oSlNPTi5wYXJzZShkYXRhKSkpXG5cdFx0fVxuXHR9O1xuXG5cdG1vZHVsZS5leHBvcnRzID0gdHJhbnNwb3J0VHlwZXM7XG5cbn0pKCk7XG4iLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGRlYnVnKXtcblxuXHR2YXIgbG9nZ2VyID0gZnVuY3Rpb24gKHN1ZmZpeCkge1xuXHRcdHRoaXMuZW5hYmxlZCA9IGZhbHNlO1xuXHRcdHRoaXMucHJlZml4ID0gc3VmZml4IHx8ICcnO1xuXG5cdFx0aWYodHlwZW9mIGRlYnVnID09ICdmdW5jdGlvbicpe1xuXHRcdFx0dGhpcy5sb2cgPSBkZWJ1ZyhgbG9nczpgICsgdGhpcy5wcmVmaXgpO1xuXHRcdFx0dGhpcy53YXJuID0gZGVidWcoYHdhcm5pbmdzOmAgKyB0aGlzLnByZWZpeCk7XG5cdFx0XHR0aGlzLmVycm9yID0gZGVidWcoYGVycm9yczpgICsgdGhpcy5wcmVmaXgpO1xuXHRcdFx0dGhpcy5lbmFibGVkID0gdHJ1ZTtcblx0XHR9XG5cdFx0ZWxzZXtcblx0XHRcdHRoaXMubG9nID0gKCk9Pnt9O1xuXHRcdFx0dGhpcy53YXJuID0gKCk9Pnt9O1xuXHRcdFx0dGhpcy5lcnJvciA9ICgpPT57fTtcblx0XHRcdHRoaXMuZW5hYmxlZCA9IGZhbHNlO1xuXHRcdH1cblx0fTtcblxuXHRsb2dnZXIucHJvdG90eXBlLmNoaWxkID0gZnVuY3Rpb24gKHN1ZmZpeCkge1xuXHRcdHJldHVybiBuZXcgbG9nZ2VyKHRoaXMucHJlZml4ICsgJzonICsgc3VmZml4KTtcblx0fTtcblxuXHRyZXR1cm4gbG9nZ2VyO1xufTtcbiIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGRlYnVnKSB7XG5cblx0Y29uc3QgTmFtZXNwYWNlID0gcmVxdWlyZSgnLi9jb21wb25lbnRzL25hbWVzcGFjZS5qcycpO1xuXHRjb25zdCBycGNFbmRwb2ludCA9IHJlcXVpcmUoJy4vY29tcG9uZW50cy9ycGNFbmRwb2ludC5qcycpO1xuXHRjb25zdCBkZWJ1Z3IgPSByZXF1aXJlKCdkZWJ1Zy1wZXN0JykoZGVidWcpO1xuXHR2YXIgYXBwTG9nZ2VyID0gbmV3IGRlYnVncignb2N0b3B1cycpO1xuXG5cdC8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cblx0dmFyIHJwY3MgPSB7fTtcblxuXHR2YXIgcnBjID0gZnVuY3Rpb24gKG5hbWUsIG9wdGlvbnMpIHtcblx0XHRvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuXG5cdFx0aWYgKG9wdGlvbnMuY3JlYXRlID09PSB0cnVlKSB7XG5cdFx0XHR0aGlzLm5hbWUgPSBuYW1lO1xuXHRcdFx0dGhpcy5jb21tYW5kcyA9IHt9O1xuXHRcdFx0dGhpcy5sb2dnZXIgPSBhcHBMb2dnZXIuY2hpbGQodGhpcy5uYW1lKTtcblxuXHRcdFx0dGhpcy5pbmNvbWluZyA9IG5ldyBycGNFbmRwb2ludChuYW1lLCAnaScsIHsgbG9nZ2VyOiB0aGlzLmxvZ2dlcn0pO1xuXHRcdFx0dGhpcy5vdXRnb2luZyA9IG5ldyBycGNFbmRwb2ludChuYW1lLCAnbycsIHsgbG9nZ2VyOiB0aGlzLmxvZ2dlcn0pO1xuXG5cdFx0XHR0aGlzLmxvZ2dlci5lbmFibGVkICYmIHRoaXMubG9nZ2VyLmxvZygnQ3JlYXRlZCBuZXcgT2N0b3B1cyBSUEMgYXMgJywgdGhpcy5uYW1lKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdGlmICghcnBjc1tuYW1lXSkge1xuXHRcdFx0b3B0aW9ucy5jcmVhdGUgPSB0cnVlO1xuXHRcdFx0cnBjc1tuYW1lXSA9IG5ldyBycGMobmFtZSwgb3B0aW9ucyk7XG5cdFx0fVxuXG5cblx0XHRyZXR1cm4gcnBjc1tuYW1lXTtcblxuXHR9O1xuXHRycGMucHJvdG90eXBlLmRpc3BsYXlUcmFuc3BvcnRzID0gZnVuY3Rpb24gKCkge1xuXHRcdC8vIGNvbnNvbGUubG9nKCdcXG5cXG5cXG4tLS0tLS0gVHJhbnNwb3J0cyBmb3IgWyVzXSBhcmU6XFxuJywgdGhpcy5uYW1lKTtcblx0XHQvLyBjb25zb2xlLmxvZygnaW5jb21pbmc6XFxuJyk7XG5cdFx0Ly8gdGhpcy5pbmNvbWluZy5kaXNwbGF5VHJhbnNwb3J0cygpO1xuXHRcdC8vIGNvbnNvbGUubG9nKCdcXG5cXG5vdXRnb2luZzpcXG4nKTtcblx0XHQvLyB0aGlzLm91dGdvaW5nLmRpc3BsYXlUcmFuc3BvcnRzKCk7XG5cdFx0Ly8gY29uc29sZS5sb2coJ1xcbi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXFxuXFxuJyk7XG5cblx0XHR2YXIgbG9nU3RyaW5nID0gYFxuXG4tLS0tLS0tLS0tLS0tLS0tLS0tLSBUUkFOU1BPUlRTIGZvciBbJHt0aGlzLm5hbWV9XSBhcmUgOiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuSW5jb21pbmcgKHByb3ZpZGVzKTpcblxuYDtcblxuXHRcdGxvZ1N0cmluZyArPSB0aGlzLmluY29taW5nLmRpc3BsYXlTdHJpbmcoKTtcblx0XHRsb2dTdHJpbmcgKz1gXFxuXFxuLS0tLS0tLS0tLS0tLVxcbk91dGdvaW5nIChjYWxscyk6XFxuXFxuYDtcblx0XHRsb2dTdHJpbmcgKz0gdGhpcy5vdXRnb2luZy5kaXNwbGF5U3RyaW5nKCk7XG5cdFx0bG9nU3RyaW5nICs9J1xcblxcbi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxcblxcbic7XG5cblx0XHRjb25zb2xlLmxvZyhsb2dTdHJpbmcpO1xuXHR9O1xuXG5cdHJwYy5wcm90b3R5cGUub3ZlciA9IGZ1bmN0aW9uIChzb2NrZXQsIHR5cGUpIHtcblx0XHR2YXIgdGFza3MgPSBbXTtcblx0XHR0YXNrcy5wdXNoKHRoaXMuaW5jb21pbmcub3Zlcihzb2NrZXQsIHR5cGUpXG5cdFx0XHQuYXModGhpcy5uYW1lKVxuXHRcdFx0LmluaXRQcm9taXNlKTtcblx0XHR0YXNrcy5wdXNoKHRoaXMub3V0Z29pbmcub3Zlcihzb2NrZXQsIHR5cGUpXG5cdFx0XHQuaW5pdFByb21pc2UpO1xuXHRcdHJldHVybiBQcm9taXNlLmFsbCh0YXNrcyk7XG5cdH07XG5cdHJwYy5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gKHNvY2tldCkge1xuXHRcdHRoaXMuaW5jb21pbmcucmVtb3ZlKHNvY2tldCk7XG5cdFx0dGhpcy5vdXRnb2luZy5yZW1vdmUoc29ja2V0KTtcblx0fTtcblxuXHRycGMucHJvdG90eXBlLnBsdWdpblRyYW5zcG9ydHMgPSBmdW5jdGlvbiAodE9iaikge1xuXHRcdHRoaXMuaW5jb21pbmcucGx1Z2luVHJhbnNwb3J0cyh0T2JqKTtcblx0XHR0aGlzLm91dGdvaW5nLnBsdWdpblRyYW5zcG9ydHModE9iaik7XG5cdH07XG5cdHJwYy5wcm90b3R5cGUuY29tbWFuZCA9IGZ1bmN0aW9uIChuYW1lKSB7XG5cdFx0dmFyIF9zZWxmID0gdGhpcztcblx0XHRpZiAoIV9zZWxmLmNvbW1hbmRzW25hbWVdKSB7XG5cdFx0XHR2YXIgaUMgPSBfc2VsZi5pbmNvbWluZy5jb21tYW5kKG5hbWUpO1xuXHRcdFx0dmFyIG9DID0gX3NlbGYub3V0Z29pbmcuY29tbWFuZChuYW1lKTtcblx0XHRcdF9zZWxmLk1FU1NBR0VUWVBFUyA9IGlDLk1FU1NBR0VUWVBFUyB8fCBvQy5NRVNTQUdFVFlQRVM7XG5cblx0XHRcdF9zZWxmLmNvbW1hbmRzW25hbWVdID0ge1xuXHRcdFx0XHRwcm92aWRlOiBmdW5jdGlvbiAoZm4pIHtcblx0XHRcdFx0XHRpQy5wcm92aWRlKGZuKTtcblx0XHRcdFx0XHRyZXR1cm4gX3NlbGYuY29tbWFuZHNbbmFtZV07XG5cdFx0XHRcdH0sXG5cdFx0XHRcdHVuUHJvdmlkZTogZnVuY3Rpb24gKGZuKSB7XG5cdFx0XHRcdFx0aUMudW5Qcm92aWRlKGZuKTtcblx0XHRcdFx0XHRyZXR1cm4gX3NlbGYuY29tbWFuZHNbbmFtZV07XG5cdFx0XHRcdH0sXG5cdFx0XHRcdG9uUHJvdmlkZTogZnVuY3Rpb24gKGZuKSB7XG5cdFx0XHRcdFx0aUMub25Qcm92aWRlKGZuKTtcblx0XHRcdFx0XHRyZXR1cm4gX3NlbGYuY29tbWFuZHNbbmFtZV07XG5cdFx0XHRcdH0sXG5cdFx0XHRcdGNhbGw6IGZ1bmN0aW9uIChmaWx0ZXIsIGRhdGEpIHtcblx0XHRcdFx0XHQvLyBfc2VsZi5kaXNwbGF5VHJhbnNwb3J0cygpO1xuXHRcdFx0XHRcdHJldHVybiBvQy5jYWxsKGZpbHRlciwgZGF0YSk7XG5cdFx0XHRcdH1cblx0XHRcdH07XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLmNvbW1hbmRzW25hbWVdO1xuXHR9O1xuXHRycGMucHJvdG90eXBlLnJlbmFtZVRvID0gZnVuY3Rpb24gKG5ld05hbWUpIHtcblx0XHR0aGlzLmluY29taW5nLnJlbmFtZSh0aGlzLm5hbWUpXG5cdFx0XHQuYXMobmV3TmFtZSk7XG5cdFx0dGhpcy5uYW1lID0gbmV3TmFtZTtcblx0XHQvLyB0aGlzLm91dGdvaW5nLmxhYmVsID0gbmV3TmFtZTtcblx0XHRyZXR1cm4gdGhpcztcblx0fTtcblxuXG5cdC8qIC0tLS0tLS0tLS0tLS0tLS0gIFJlc3VsdCBwYXJzaW5nICYgUmVzb2x2aW5nIHRvIFByb21pc2UgcmVzb2x2ZS9yZWplY3QgLS0tLS0tLS0tLS0qL1xuXG5cdHJwYy5wcm90b3R5cGUucGFyc2VCeVN0YXR1cyA9IGZ1bmN0aW9uIChyZXMpIHtcblx0XHR2YXIgdmFsaWRzID0gW10sXG5cdFx0XHRpbnZhbGlkcyA9IFtdLFxuXHRcdFx0Y2hlY2s7XG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCByZXMubGVuZ3RoOyBpKyspIHtcblx0XHRcdGNoZWNrID0gcmVzW2ldO1xuXHRcdFx0aWYgKGNoZWNrLnNlbnQgPT09IHRydWUgJiYgY2hlY2suc3RhdHVzID09PSB0cnVlKVxuXHRcdFx0XHR2YWxpZHMucHVzaChjaGVjayk7XG5cdFx0XHRlbHNlXG5cdFx0XHRcdGludmFsaWRzLnB1c2goY2hlY2spO1xuXHRcdH1cblx0XHRyZXR1cm4ge1xuXHRcdFx0dmFsaWRzOiB2YWxpZHMsXG5cdFx0XHRpbnZhbGlkczogaW52YWxpZHNcblx0XHR9O1xuXHR9O1xuXG5cdHJwYy5wcm90b3R5cGUucmVzb2x2ZSA9IGZ1bmN0aW9uIChwKSB7XG5cdFx0aWYgKHAuc2VudCA9PT0gdHJ1ZSAmJiBwLnN0YXR1cyA9PT0gdHJ1ZSlcblx0XHRcdHJldHVybiBQcm9taXNlLnJlc29sdmUocC5yZXNwb25zZSk7XG5cdFx0ZWxzZVxuXHRcdFx0cmV0dXJuIFByb21pc2UucmVqZWN0KHAucmVzcG9uc2UpO1xuXHR9O1xuXHRycGMucHJvdG90eXBlLnJlc29sdmVBbGwgPSBmdW5jdGlvbiAocCkge1xuXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBwLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRpZiAocFtpXS5zZW50ID09PSBmYWxzZSB8fCBwW2ldLnN0YXR1cyA9PT0gZmFsc2UpXG5cdFx0XHRcdHJldHVybiBQcm9taXNlLnJlamVjdChwKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHApO1xuXHR9O1xuXHRycGMucHJvdG90eXBlLnJlc29sdmVBdExlYXN0T25lID0gZnVuY3Rpb24gKHApIHtcblxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgcC5sZW5ndGg7IGkrKykge1xuXHRcdFx0aWYgKHBbaV0uc2VudCA9PT0gdHJ1ZSAmJiBwW2ldLnN0YXR1cyA9PT0gdHJ1ZSlcblx0XHRcdFx0cmV0dXJuIFByb21pc2UucmVzb2x2ZShwKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gUHJvbWlzZS5yZWplY3QocCk7XG5cdH07XG5cblxuXG5cblx0cmV0dXJuIHJwYztcblxufTtcbiJdfQ=="}